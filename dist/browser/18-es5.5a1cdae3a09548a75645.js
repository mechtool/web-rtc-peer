function _defineProperty(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function _defineProperties(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),t&&_defineProperties(n,t),n}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{z6Qy:function(n,e,t){"use strict";t.r(e);var o=t("8Y7J"),l=function n(){_classCallCheck(this,n)},a=t("pMnS"),i=t("NvT6"),c=t("W5yJ"),u=t("/HVE"),s=t("SVse"),r=t("omvX"),b=t("Mr+X"),d=t("Gi4r"),p=t("KPQW"),m=t("5GAg"),v=t("bujt"),f=t("Fwaw"),h=t("FbN9"),g=t("BzsH"),C=t("2/pp"),x=t("xQwi"),w=t("VYsW"),k=function(){function n(e,t,o){_classCallCheck(this,n),this.appContext=e,this.webRtcService=t,this.changeRef=o,this.localBadge="",this.subscriptions=[],this.bottomVideo="video",this.bottomAudio="audio",this.topPeerVideoImg="video",this.topPeerAudioImg="audio",this.buttons=[["video-off","video"],["audio-off","audio"]]}return _createClass(n,[{key:"ngOnInit",value:function(){var n=this;this.videoContext.local&&this.subscriptions.push(this.appContext.announcements.subscribe((function(e){var t=e.filter((function(n){return n.active})).length;n.localBadge=0==t?"":t+""}))),this.subscriptions.push(this.videoContext.dataChannel.data.subscribe((function(e){var t=JSON.parse(e.data);if("settings"===t.type)"video"in t&&(n.topPeerVideoImg=n.buttons[0][t.video]),"audio"in t&&(n.topPeerAudioImg=n.buttons[1][t.audio]);else if("status"===t.type){var o=n.videoContext.contact.value;o.statusColor=t.statusColor,n.videoContext.contact.next(o),n.webRtcService.checkConnectionState({state:t.statusText,contact:o,videoContext:n.videoContext})}n.changeRef.detectChanges()})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(n){return n.unsubscribe()}))}},{key:"clickIcon",value:function(n){var e;switch(n){case 0:var t=this.videoContext.stream.value.getVideoTracks()[0];t&&(t.enabled=!("video"==this.bottomVideo)),e={type:"settings",video:Number(t.enabled)},this.bottomVideo=this.buttons[0][+t.enabled];break;case 1:var o=this.videoContext.stream.value.getAudioTracks()[0];o&&(o.enabled=!("audio"===this.bottomAudio)),e={type:"settings",audio:Number(o.enabled)},this.bottomAudio=this.buttons[1][+o.enabled];break;case 2:this.webRtcService.stopVideoChannel(this.videoContext)}this.sendDataMessages(e)}},{key:"sendDataMessages",value:function(n){var e=this,t=this.appContext.webRtcContexts.getContext(this.videoContext.webRtcUid),o=this.videoContext.contact.value.uid===this.appContext.appUser.uid;t&&t.videoCollection.forEach((function(t){(o&&t.contact.value.uid!==e.videoContext.contact.value.uid||!o&&t.contact.value.uid===e.videoContext.contact.value.uid)&&t.dataChannel.channel&&"open"===t.dataChannel.channel.readyState&&t.dataChannel.channel.send(JSON.stringify(n))}))}},{key:"onLoadedData",value:function(){this.videoContext.className.active=!0,this.webRtcService.checkVideoContexts(this.videoContext)}},{key:"onEnded",value:function(){this.videoContext.className.active=!1,this.webRtcService.checkVideoContexts(this.videoContext)}}]),n}(),y=t("hoN+"),A=o.ob({encapsulation:0,styles:[[".video-container[_ngcontent-%COMP%]{position:relative;height:100%}.top-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;background:0 0;display:flex;align-items:center;justify-content:space-between;z-index:2}.top-local-block[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.bottom-peer-block[_ngcontent-%COMP%]{width:160px;display:flex;justify-content:space-between;align-items:center}.bottom-peer-audio[_ngcontent-%COMP%], .bottom-peer-video[_ngcontent-%COMP%]{background-color:transparent!important}.main-video-container[_ngcontent-%COMP%]{height:100%}video.video-element[_ngcontent-%COMP%]{position:relative;z-index:0;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:50% 50%;object-position:50% 50%;border:0 solid #cecece}.phone-hangup[_ngcontent-%COMP%]{background-color:#c60000!important}mat-icon[_ngcontent-%COMP%]{color:#fff!important}.bottom-toolbar[_ngcontent-%COMP%]{background:0 0;position:absolute;bottom:0;display:flex;justify-content:center}.img-pulse[_ngcontent-%COMP%]{position:absolute;transform:scale(.9) rotate(-45deg);transform-origin:13px 88px;display:none}div.video-container.active.pulse[_ngcontent-%COMP%]{display:initial}.video-container.local.active[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;transition:.5s}.video-container.local.active.fixed[_ngcontent-%COMP%]{bottom:0;left:0;width:200px;height:200px;top:unset}"]],data:{}});function I(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,3,"div",[["class","top-local-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,2,"mat-icon",[["class","mat-icon notranslate mat-badge"],["matBadgeSize","small"],["role","img"],["svgIcon","notifications"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null],[2,"mat-badge-overlap",null],[2,"mat-badge-above",null],[2,"mat-badge-below",null],[2,"mat-badge-before",null],[2,"mat-badge-after",null],[2,"mat-badge-small",null],[2,"mat-badge-medium",null],[2,"mat-badge-large",null],[2,"mat-badge-hidden",null],[2,"mat-badge-disabled",null]],null,null,b.b,b.a)),o.pb(2,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),o.pb(3,671744,null,0,p.a,[o.x,o.k,m.c,o.C,[2,r.a]],{color:[0,"color"],content:[1,"content"],size:[2,"size"]},null)],(function(n,e){var t=e.component;n(e,2,0,"notifications"),n(e,3,0,"accent",t.localBadge,"small")}),(function(n,e){n(e,1,1,[o.Cb(e,2).inline,"primary"!==o.Cb(e,2).color&&"accent"!==o.Cb(e,2).color&&"warn"!==o.Cb(e,2).color,o.Cb(e,3).overlap,o.Cb(e,3).isAbove(),!o.Cb(e,3).isAbove(),!o.Cb(e,3).isAfter(),o.Cb(e,3).isAfter(),"small"===o.Cb(e,3).size,"medium"===o.Cb(e,3).size,"large"===o.Cb(e,3).size,o.Cb(e,3).hidden||!o.Cb(e,3)._hasContent,o.Cb(e,3).disabled])}))}function _(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,4,"div",[["class","top-peer-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,1,"mat-icon",[["class","video-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(2,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(3,0,null,null,1,"mat-icon",[["class","microphone-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(4,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,e){var t=e.component;n(e,2,0,t.topPeerVideoImg),n(e,4,0,t.topPeerAudioImg)}),(function(n,e){n(e,1,0,o.Cb(e,2).inline,"primary"!==o.Cb(e,2).color&&"accent"!==o.Cb(e,2).color&&"warn"!==o.Cb(e,2).color),n(e,3,0,o.Cb(e,4).inline,"primary"!==o.Cb(e,4).color&&"accent"!==o.Cb(e,4).color&&"warn"!==o.Cb(e,4).color)}))}function O(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,4,"div",[["class","bottom-local-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,3,"button",[["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],null,null,v.b,v.a)),o.pb(2,180224,null,0,f.b,[o.k,m.f,[2,r.a]],null,null),(n()(),o.qb(3,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(4,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,e){n(e,4,0,"phone-hangup")}),(function(n,e){n(e,1,0,o.Cb(e,2).disabled||null,"NoopAnimations"===o.Cb(e,2)._animationMode),n(e,3,0,o.Cb(e,4).inline,"primary"!==o.Cb(e,4).color&&"accent"!==o.Cb(e,4).color&&"warn"!==o.Cb(e,4).color)}))}function P(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,13,"div",[["class","bottom-peer-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,0,"img",[["class","img-pulse"],["src","/assets/app-shell/Radio-1s-200px.svg"]],null,null,null,null,null)),(n()(),o.qb(2,0,null,null,3,"button",[["class","bottom-peer-video"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,e,t){var o=!0;return"click"===e&&(o=!1!==n.component.clickIcon(0)&&o),o}),v.b,v.a)),o.pb(3,180224,null,0,f.b,[o.k,m.f,[2,r.a]],null,null),(n()(),o.qb(4,0,null,0,1,"mat-icon",[["class","video-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(5,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(6,0,null,null,3,"button",[["class","phone-hangup"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,e,t){var o=!0;return"click"===e&&(o=!1!==n.component.clickIcon(2)&&o),o}),v.b,v.a)),o.pb(7,180224,null,0,f.b,[o.k,m.f,[2,r.a]],null,null),(n()(),o.qb(8,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(9,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(10,0,null,null,3,"button",[["class","bottom-peer-audio"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,e,t){var o=!0;return"click"===e&&(o=!1!==n.component.clickIcon(1)&&o),o}),v.b,v.a)),o.pb(11,180224,null,0,f.b,[o.k,m.f,[2,r.a]],null,null),(n()(),o.qb(12,0,null,0,1,"mat-icon",[["class","microphone-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),o.pb(13,9158656,null,0,d.b,[o.k,d.d,[8,null],[2,d.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,e){var t=e.component;n(e,5,0,t.bottomVideo),n(e,9,0,"phone-hangup"),n(e,13,0,t.bottomAudio)}),(function(n,e){n(e,2,0,o.Cb(e,3).disabled||null,"NoopAnimations"===o.Cb(e,3)._animationMode),n(e,4,0,o.Cb(e,5).inline,"primary"!==o.Cb(e,5).color&&"accent"!==o.Cb(e,5).color&&"warn"!==o.Cb(e,5).color),n(e,6,0,o.Cb(e,7).disabled||null,"NoopAnimations"===o.Cb(e,7)._animationMode),n(e,8,0,o.Cb(e,9).inline,"primary"!==o.Cb(e,9).color&&"accent"!==o.Cb(e,9).color&&"warn"!==o.Cb(e,9).color),n(e,10,0,o.Cb(e,11).disabled||null,"NoopAnimations"===o.Cb(e,11)._animationMode),n(e,12,0,o.Cb(e,13).inline,"primary"!==o.Cb(e,13).color&&"accent"!==o.Cb(e,13).color&&"warn"!==o.Cb(e,13).color)}))}function N(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,26,"div",[["class","video-container"]],null,null,null,null,null)),o.Gb(512,null,s.y,s.z,[o.q,o.r,o.k,o.C]),o.pb(2,278528,null,0,s.j,[s.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(n()(),o.qb(3,0,null,null,9,"mat-toolbar",[["class","top-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,h.b,h.a)),o.pb(4,4243456,null,1,g.a,[o.k,u.a,s.d],null,null),o.Hb(603979776,1,{_toolbarRows:1}),(n()(),o.qb(6,0,null,0,2,"app-contact",[],null,null,null,C.b,C.a)),o.pb(7,114688,null,0,x.a,[o.h,w.a,o.z],{context:[0,"context"]},null),o.Db(131072,s.b,[o.h]),(n()(),o.gb(16777216,null,0,1,null,I)),o.pb(10,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,0,1,null,_)),o.pb(12,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.qb(13,0,null,null,4,"div",[["class","main-video-container"]],null,null,null,null,null)),(n()(),o.qb(14,0,[["videoElement",1]],null,3,"video",[["autoplay",""],["class","video-element"],["playsinline",""]],[[8,"srcObject",0]],[[null,"loadeddata"],[null,"ended"]],(function(n,e,t){var o=!0,l=n.component;return"loadeddata"===e&&(o=!1!==l.onLoadedData()&&o),"ended"===e&&(o=!1!==l.onEnded()&&o),o}),null,null)),o.Gb(512,null,s.y,s.z,[o.q,o.r,o.k,o.C]),o.pb(16,278528,null,0,s.j,[s.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),o.Db(131072,s.b,[o.h]),(n()(),o.qb(18,0,null,null,8,"mat-toolbar",[["class","bottom-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,h.b,h.a)),o.Gb(512,null,s.y,s.z,[o.q,o.r,o.k,o.C]),o.pb(20,278528,null,0,s.j,[s.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),o.pb(21,4243456,null,1,g.a,[o.k,u.a,s.d],null,null),o.Hb(603979776,2,{_toolbarRows:1}),(n()(),o.gb(16777216,null,0,1,null,O)),o.pb(24,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,0,1,null,P)),o.pb(26,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,2,0,"video-container",t.videoContext.className),n(e,7,0,o.Kb(e,7,0,o.Cb(e,8).transform(t.videoContext.contact))),n(e,10,0,t.videoContext.local),n(e,12,0,!t.videoContext.local),n(e,16,0,"video-element",t.videoContext.className),n(e,20,0,"bottom-toolbar",t.videoContext.className),n(e,24,0,!t.videoContext.local),n(e,26,0,t.videoContext.local)}),(function(n,e){var t=e.component;n(e,3,0,o.Cb(e,4)._toolbarRows.length>0,0===o.Cb(e,4)._toolbarRows.length),n(e,14,0,o.Kb(e,14,0,o.Cb(e,17).transform(t.videoContext.stream))),n(e,18,0,o.Cb(e,21)._toolbarRows.length>0,0===o.Cb(e,21)._toolbarRows.length)}))}var R=function(){function n(){_classCallCheck(this,n)}return _createClass(n,[{key:"ngOnInit",value:function(){}}]),n}(),S=o.ob({encapsulation:0,styles:[[".web-rtc-context-container[_ngcontent-%COMP%]{height:100%}"]],data:{}});function q(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-video-channel",[],null,null,null,N,A)),o.pb(1,245760,null,0,k,[w.a,y.a,o.h],{videoContext:[0,"videoContext"]},null)],(function(n,e){n(e,1,0,e.context.$implicit)}),null)}function z(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,2,"div",[["class","web-rtc-context-container"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,null,1,null,q)),o.pb(2,278528,null,0,s.k,[o.N,o.K,o.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,2,0,e.component.context.videoCollection)}),null)}var M=t("mrSG"),j=t("iInd"),L=t("pLZG"),D=t("fvN4"),J=t("2Vo4"),V=t("XNiG"),E=function(){function n(e,t,o,l,a){_classCallCheck(this,n),this.router=e,this.webRtcService=t,this.appContext=o,this.database=l,this.statusColor=a,this.progress=!0,this.subscriptions=[],this.duplicateCall=JSON.parse(window.localStorage.getItem("duplicateCall")),this.optimizeCall=JSON.parse(window.localStorage.getItem("optimizeCall")),this.video=JSON.parse(window.localStorage.getItem("videoinput")),this.micro=JSON.parse(window.localStorage.getItem("audioinput")),this.audio=JSON.parse(window.localStorage.getItem("audiooutput")),this.constraints={audio:{deviceId:!(!this.audio||!this.audio.deviceId)&&this.audio.deviceId,volume:1},video:{deviceId:!(!this.video||!this.video.deviceId)&&this.video.deviceId}}}return _createClass(n,[{key:"ngOnInit",value:function(){this.router.events.pipe(Object(L.a)((function(n){return n instanceof j.g}))).subscribe((function(n){})),this.startConnections()}},{key:"ngAfterViewInit",value:function(){this.progress=!1}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(n){return n.unsubscribe()}))}},{key:"handleDescriptor",value:function(n){}},{key:"startConnections",value:function(){return M.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e,t,o,l,a=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e=this.appContext.webRtcContexts.getContext(this.appContext.contextId)){n.next=3;break}return n.abrupt("return");case 3:return t=e.uid===this.appContext.appUser.uid,n.next=6,navigator.mediaDevices.getUserMedia(this.constraints);case 6:e.localStream=n.sent,(o=[e.sender].concat(e.receivers.value))&&(l=o.findIndex((function(n){return n.uid===a.appContext.user.value.uid})),o.forEach((function(n,o){var i,c,u=a.appContext.appUser.uid===n.uid,s=e.webRtcConnections[n.uid]=new D.g({uid:n.uid});s.webRtcContext=e,s.uid=n.uid,s.videoContext=new D.f({webRtcUid:e.uid,contact:new J.a(u?a.appContext.appUser:n),className:u?(i={},_defineProperty(i,n.uid+" local video-context",!0),_defineProperty(i,"active",!1),_defineProperty(i,"fixed",!1),_defineProperty(i,"pulse",t),i):(c={},_defineProperty(c,n.uid+" remote video-context",!0),_defineProperty(c,"active",!1),_defineProperty(c,"pulse",!1),c),stream:new J.a(u?e.localStream:void 0),local:u,dataChannel:{data:new V.a,channel:void 0}}),e.videoCollection.push(s.videoContext),u||(s.pcConnection=new SimplePeer({initiator:t||n.uid===e.uid||l<o,channelName:n.uid,config:a.appContext.stunTurnConfig[t?window.localStorage.getItem("stunTurn"):e.desc.stun],stream:e.localStream}),s.videoContext.dataChannel.channel=s.pcConnection._channel,s.pcConnection.on("signal",(function(o){return M.__awaiter(a,void 0,void 0,regeneratorRuntime.mark((function l(){var a,i;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(!o.type){l.next=14;break}if("offer"!==o.type){l.next=5;break}s.offer=new D.d({type:t?"offers/explicit":"offers/implicit",action:"offered",contact:n,uid:this.appContext.appUser.uid,webRtcUid:e.uid,receivers:t?e.receivers.value:[n],sender:this.appContext.appUser,stun:t?window.localStorage.getItem("stunTurn"):e.desc.stun,desc:JSON.stringify(o),optimize:t?JSON.parse(window.localStorage.getItem("optimizeCall")):e.desc.optimize}),s.offer.optimize||this.webRtcService.sendOffer(s),l.next=12;break;case 5:if(l.t0="answer"===o.type,!l.t0){l.next=12;break}if(s.answer=new D.a({type:"answer",active:!0,contact:n,uid:e.desc.uid,webRtcUid:e.uid,receivers:[e.sender],sender:this.appContext.appUser,desc:JSON.stringify(o),optimize:e.desc.optimize}),l.t1=s.answer.optimize,l.t1){l.next=12;break}return l.next=12,this.database.sendDescriptor(s.answer);case 12:l.next=15;break;case 14:o.candidate&&(a=s.offer||s.answer,i=new D.b({webRtcUid:a.webRtcUid,contact:n,date:Date.now(),sender:this.appContext.user.value,descId:a.messId,type:"candidates",desc:JSON.stringify(o.candidate),active:!0,optimize:a.optimize}),a.optimize?a.candidates.push(i):this.database.sendDescriptor(i).catch(this.onError));case 15:case"end":return l.stop()}}),l,this)})))})),s.pcConnection._pc.addEventListener("icegatheringstatechange",(function(n){if("complete"===n.target.iceGatheringState){var e=s.offer||s.answer;e.optimize&&(e.candidates.length?(/answer|offers\/implicit/.test(e.type)&&a.database.sendDescriptor(e).then((function(){console.log("\u0421\u0431\u043e\u0440\u043a\u0430 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430. \u041a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b.")})).catch(a.onError),/offers\/explicit/.test(e.type)&&a.webRtcService.sendOffer(s)):(a.onError("\u0421\u0431\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0438 icegatheringstatechange."),a.setAnnouncement({type:"incompatibilityFailure",desc:{text:"\u0421\u0431\u043e\u0439 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438."}})))}})),s.pcConnection._pc.addEventListener("connectionstatechange",(function(n){var e=s.videoContext.contact.value;e.statusColor=a.statusColor.statusColors.webrtc.perConnectionStates[n.type],s.videoContext.contact.next(e)})),s.pcConnection.on("connect",(function(){s.pcConnection.send({type:"settings",video:!0,audio:!0})})),s.pcConnection.on("data",(function(n){s.videoContext.dataChannel.data.next(n)})),s.pcConnection.on("stream",(function(n){s.videoContext.stream.next(n)})),s.pcConnection.on("close",(function(){})),s.pcConnection.on("error",(function(n){})),t||0!==o||a.setDescriptor(s.pcConnection,e.desc))}))),t||this.setImplicitListeners(),this.appContext.appChangeRef.markForCheck();case 10:case"end":return n.stop()}}),n,this)})))}},{key:"setDescriptor",value:function(n,e){var t=this;n.signal(JSON.parse(e.desc)),"candidates"!==e.type&&M.__awaiter(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.checkCandidates(e,n);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"requestCandidates",value:function(n,e){var t=this;this.database.database.ref("/web-rtc/candidates/".concat(this.appContext.user.value.uid)).orderByChild("descId").equalTo(n.messId).once("value").then((function(n){var o=n.val();o&&e.bind(t,o)()})).catch(this.onError)}},{key:"checkCandidates",value:function(n,e){var t=this;return new Promise((function(e,l){n.optimize?o.bind(t,n.candidates,e,l)():t.requestCandidates(n,(function(n){n&&o.bind(t,Object.values(n),e,l)()}))}));function o(n,t,o){var l=this;n.forEach((function(n){return M.__awaiter(l,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.signal(JSON.parse(n.desc)),this.database.setDescriptorOptions({descriptor:n,data:{active:!1}}).catch((function(n){console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043d\u044f\u0442\u0438\u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u0432 \u0431\u0430\u0437\u0435.")}));case 1:case"end":return t.stop()}}),t,this)})))})).catch((function(n){return o(n)})),t()}}},{key:"setImplicitListeners",value:function(){}},{key:"setAnnouncement",value:function(n){this.appContext.announcements.next([n].concat(this.appContext.announcements.value)),this.appContext.appChangeRef.markForCheck()}},{key:"onError",value:function(n){console.log(n)}}]),n}(),U=t("ZJFI"),F=t("tX6c"),K=o.ob({encapsulation:0,styles:[[".web-rtc-component-container[_ngcontent-%COMP%]{height:100%}.startScreen[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}"]],data:{}});function T(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,2,"div",[["class","startScreen"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["color","primary"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,i.b,i.a)),o.pb(2,114688,null,0,c.b,[o.k,u.a,[2,s.d],[2,r.a],c.a],{color:[0,"color"],mode:[1,"mode"]},null)],(function(n,e){n(e,2,0,"primary","indeterminate")}),(function(n,e){n(e,1,0,o.Cb(e,2)._noopAnimations,o.Cb(e,2).diameter,o.Cb(e,2).diameter,"determinate"===o.Cb(e,2).mode?0:null,"determinate"===o.Cb(e,2).mode?100:null,"determinate"===o.Cb(e,2).mode?o.Cb(e,2).value:null,o.Cb(e,2).mode)}))}function G(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-web-rtc-context",[],null,null,null,z,S)),o.pb(1,114688,null,0,R,[],{context:[0,"context"]},null)],(function(n,e){n(e,1,0,e.context.$implicit)}),null)}function B(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,3,"div",[["class","web-rtc-component-container"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,null,2,null,G)),o.pb(2,278528,null,0,s.k,[o.N,o.K,o.q],{ngForOf:[0,"ngForOf"]},null),o.Db(131072,s.b,[o.h])],(function(n,e){var t=e.component;n(e,2,0,o.Kb(e,2,0,o.Cb(e,3).transform(t.appContext.webRtcContexts.contexts)))}),null)}function W(n){return o.Lb(0,[(n()(),o.gb(16777216,null,null,1,null,T)),o.pb(1,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,null,1,null,B)),o.pb(3,16384,null,0,s.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,1,0,t.progress),n(e,3,0,!t.progress)}),null)}var Z=o.mb("app-web-rtc",E,(function(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-web-rtc",[],null,null,null,W,K)),o.pb(1,4440064,null,0,E,[j.o,y.a,w.a,U.a,F.a],null,null)],(function(n,e){n(e,1,0)}),null)}),{},{},[]),H=t("NcP4"),Q=t("POq0"),X=t("QQfA"),Y=t("IP0z"),$=t("JjoW"),nn=t("Mz6y"),en=t("cUpR"),tn=t("Xd0L"),on=t("gavF"),ln=t("/Co4"),an=t("s7LF"),cn=t("/q54"),un=function n(){_classCallCheck(this,n)},sn=t("igqZ"),rn=t("HsOI"),bn=t("zMNK"),dn=t("hOhj"),pn=t("oapL"),mn=t("ZwOa"),vn=t("8P0U"),fn=t("elxJ"),hn=t("rWV4"),gn=t("mkRZ"),Cn=t("pBi1"),xn=t("lT8R"),wn=t("7of8"),kn=t("VDRc"),yn=t("ura0"),An=t("Nhcz"),In=t("u9T3"),_n=t("Gcy5");t.d(e,"WebRtcModuleNgFactory",(function(){return On}));var On=o.nb(l,[],(function(n){return o.zb([o.Ab(512,o.j,o.Z,[[8,[a.a,Z,H.a]],[3,o.j],o.v]),o.Ab(4608,s.n,s.m,[o.s,[2,s.D]]),o.Ab(4608,Q.c,Q.c,[]),o.Ab(4608,X.c,X.c,[X.i,X.e,o.j,X.h,X.f,o.p,o.x,s.d,Y.b,[2,s.h]]),o.Ab(5120,X.j,X.k,[X.c]),o.Ab(5120,$.a,$.b,[X.c]),o.Ab(5120,nn.b,nn.c,[X.c]),o.Ab(4608,en.e,tn.c,[[2,tn.g],[2,tn.l]]),o.Ab(4608,tn.b,tn.b,[]),o.Ab(5120,on.a,on.d,[X.c]),o.Ab(5120,ln.b,ln.c,[X.c]),o.Ab(4608,an.e,an.e,[]),o.Ab(4608,an.w,an.w,[]),o.Ab(5120,o.b,(function(n,e){return[cn.j(n,e)]}),[s.d,o.z]),o.Ab(1073742336,s.c,s.c,[]),o.Ab(1073742336,j.s,j.s,[[2,j.x],[2,j.o]]),o.Ab(1073742336,un,un,[]),o.Ab(1073742336,Y.a,Y.a,[]),o.Ab(1073742336,tn.l,tn.l,[[2,tn.d],[2,en.f]]),o.Ab(1073742336,g.b,g.b,[]),o.Ab(1073742336,d.c,d.c,[]),o.Ab(1073742336,sn.c,sn.c,[]),o.Ab(1073742336,Q.d,Q.d,[]),o.Ab(1073742336,rn.e,rn.e,[]),o.Ab(1073742336,bn.e,bn.e,[]),o.Ab(1073742336,u.b,u.b,[]),o.Ab(1073742336,dn.b,dn.b,[]),o.Ab(1073742336,X.g,X.g,[]),o.Ab(1073742336,tn.v,tn.v,[]),o.Ab(1073742336,tn.t,tn.t,[]),o.Ab(1073742336,tn.q,tn.q,[]),o.Ab(1073742336,$.d,$.d,[]),o.Ab(1073742336,m.a,m.a,[]),o.Ab(1073742336,nn.e,nn.e,[]),o.Ab(1073742336,f.c,f.c,[]),o.Ab(1073742336,pn.c,pn.c,[]),o.Ab(1073742336,mn.b,mn.b,[]),o.Ab(1073742336,vn.c,vn.c,[]),o.Ab(1073742336,c.c,c.c,[]),o.Ab(1073742336,fn.d,fn.d,[]),o.Ab(1073742336,hn.j,hn.j,[]),o.Ab(1073742336,p.b,p.b,[]),o.Ab(1073742336,on.c,on.c,[]),o.Ab(1073742336,on.b,on.b,[]),o.Ab(1073742336,ln.e,ln.e,[]),o.Ab(1073742336,gn.a,gn.a,[]),o.Ab(1073742336,Cn.d,Cn.d,[]),o.Ab(1073742336,Cn.c,Cn.c,[]),o.Ab(1073742336,xn.a,xn.a,[]),o.Ab(1073742336,wn.a,wn.a,[]),o.Ab(1073742336,an.v,an.v,[]),o.Ab(1073742336,an.s,an.s,[]),o.Ab(1073742336,cn.c,cn.c,[]),o.Ab(1073742336,kn.a,kn.a,[]),o.Ab(1073742336,yn.c,yn.c,[]),o.Ab(1073742336,An.a,An.a,[]),o.Ab(1073742336,In.a,In.a,[[2,cn.g],o.z]),o.Ab(1073742336,_n.a,_n.a,[]),o.Ab(1073742336,l,l,[]),o.Ab(1024,j.m,(function(){return[[{path:"",component:E}]]}),[])])}))}}]);
//# sourceMappingURL=18-es5.5a1cdae3a09548a75645.js.map