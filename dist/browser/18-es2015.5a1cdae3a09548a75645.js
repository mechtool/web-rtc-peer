(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{z6Qy:function(n,t,e){"use strict";e.r(t);var l=e("8Y7J");class o{}var i=e("pMnS"),a=e("NvT6"),c=e("W5yJ"),s=e("/HVE"),u=e("SVse"),r=e("omvX"),b=e("Mr+X"),d=e("Gi4r"),p=e("KPQW"),m=e("5GAg"),h=e("bujt"),g=e("Fwaw"),v=e("FbN9"),C=e("BzsH"),f=e("2/pp"),x=e("xQwi"),w=e("VYsW");class A{constructor(n,t,e){this.appContext=n,this.webRtcService=t,this.changeRef=e,this.localBadge="",this.subscriptions=[],this.bottomVideo="video",this.bottomAudio="audio",this.topPeerVideoImg="video",this.topPeerAudioImg="audio",this.buttons=[["video-off","video"],["audio-off","audio"]]}ngOnInit(){this.videoContext.local&&this.subscriptions.push(this.appContext.announcements.subscribe(n=>{let t=n.filter(n=>n.active).length;this.localBadge=0==t?"":t+""})),this.subscriptions.push(this.videoContext.dataChannel.data.subscribe(n=>{let t=JSON.parse(n.data);if("settings"===t.type)"video"in t&&(this.topPeerVideoImg=this.buttons[0][t.video]),"audio"in t&&(this.topPeerAudioImg=this.buttons[1][t.audio]);else if("status"===t.type){let n=this.videoContext.contact.value;n.statusColor=t.statusColor,this.videoContext.contact.next(n),this.webRtcService.checkConnectionState({state:t.statusText,contact:n,videoContext:this.videoContext})}this.changeRef.detectChanges()}))}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}clickIcon(n){let t;switch(n){case 0:let n=this.videoContext.stream.value.getVideoTracks()[0];n&&(n.enabled=!("video"==this.bottomVideo)),t={type:"settings",video:Number(n.enabled)},this.bottomVideo=this.buttons[0][+n.enabled];break;case 1:let e=this.videoContext.stream.value.getAudioTracks()[0];e&&(e.enabled=!("audio"===this.bottomAudio)),t={type:"settings",audio:Number(e.enabled)},this.bottomAudio=this.buttons[1][+e.enabled];break;case 2:this.webRtcService.stopVideoChannel(this.videoContext)}this.sendDataMessages(t)}sendDataMessages(n){let t=this.appContext.webRtcContexts.getContext(this.videoContext.webRtcUid),e=this.videoContext.contact.value.uid===this.appContext.appUser.uid;t&&t.videoCollection.forEach(t=>{(e&&t.contact.value.uid!==this.videoContext.contact.value.uid||!e&&t.contact.value.uid===this.videoContext.contact.value.uid)&&t.dataChannel.channel&&"open"===t.dataChannel.channel.readyState&&t.dataChannel.channel.send(JSON.stringify(n))})}onLoadedData(){this.videoContext.className.active=!0,this.webRtcService.checkVideoContexts(this.videoContext)}onEnded(){this.videoContext.className.active=!1,this.webRtcService.checkVideoContexts(this.videoContext)}}var I=e("hoN+"),y=l.ob({encapsulation:0,styles:[[".video-container[_ngcontent-%COMP%]{position:relative;height:100%}.top-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;background:0 0;display:flex;align-items:center;justify-content:space-between;z-index:2}.top-local-block[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.bottom-peer-block[_ngcontent-%COMP%]{width:160px;display:flex;justify-content:space-between;align-items:center}.bottom-peer-audio[_ngcontent-%COMP%], .bottom-peer-video[_ngcontent-%COMP%]{background-color:transparent!important}.main-video-container[_ngcontent-%COMP%]{height:100%}video.video-element[_ngcontent-%COMP%]{position:relative;z-index:0;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:50% 50%;object-position:50% 50%;border:0 solid #cecece}.phone-hangup[_ngcontent-%COMP%]{background-color:#c60000!important}mat-icon[_ngcontent-%COMP%]{color:#fff!important}.bottom-toolbar[_ngcontent-%COMP%]{background:0 0;position:absolute;bottom:0;display:flex;justify-content:center}.img-pulse[_ngcontent-%COMP%]{position:absolute;transform:scale(.9) rotate(-45deg);transform-origin:13px 88px;display:none}div.video-container.active.pulse[_ngcontent-%COMP%]{display:initial}.video-container.local.active[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;transition:.5s}.video-container.local.active.fixed[_ngcontent-%COMP%]{bottom:0;left:0;width:200px;height:200px;top:unset}"]],data:{}});function k(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,3,"div",[["class","top-local-block"]],null,null,null,null,null)),(n()(),l.qb(1,0,null,null,2,"mat-icon",[["class","mat-icon notranslate mat-badge"],["matBadgeSize","small"],["role","img"],["svgIcon","notifications"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null],[2,"mat-badge-overlap",null],[2,"mat-badge-above",null],[2,"mat-badge-below",null],[2,"mat-badge-before",null],[2,"mat-badge-after",null],[2,"mat-badge-small",null],[2,"mat-badge-medium",null],[2,"mat-badge-large",null],[2,"mat-badge-hidden",null],[2,"mat-badge-disabled",null]],null,null,b.b,b.a)),l.pb(2,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null),l.pb(3,671744,null,0,p.a,[l.x,l.k,m.c,l.C,[2,r.a]],{color:[0,"color"],content:[1,"content"],size:[2,"size"]},null)],(function(n,t){var e=t.component;n(t,2,0,"notifications"),n(t,3,0,"accent",e.localBadge,"small")}),(function(n,t){n(t,1,1,[l.Cb(t,2).inline,"primary"!==l.Cb(t,2).color&&"accent"!==l.Cb(t,2).color&&"warn"!==l.Cb(t,2).color,l.Cb(t,3).overlap,l.Cb(t,3).isAbove(),!l.Cb(t,3).isAbove(),!l.Cb(t,3).isAfter(),l.Cb(t,3).isAfter(),"small"===l.Cb(t,3).size,"medium"===l.Cb(t,3).size,"large"===l.Cb(t,3).size,l.Cb(t,3).hidden||!l.Cb(t,3)._hasContent,l.Cb(t,3).disabled])}))}function O(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,4,"div",[["class","top-peer-block"]],null,null,null,null,null)),(n()(),l.qb(1,0,null,null,1,"mat-icon",[["class","video-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(2,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),l.qb(3,0,null,null,1,"mat-icon",[["class","microphone-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(4,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){var e=t.component;n(t,2,0,e.topPeerVideoImg),n(t,4,0,e.topPeerAudioImg)}),(function(n,t){n(t,1,0,l.Cb(t,2).inline,"primary"!==l.Cb(t,2).color&&"accent"!==l.Cb(t,2).color&&"warn"!==l.Cb(t,2).color),n(t,3,0,l.Cb(t,4).inline,"primary"!==l.Cb(t,4).color&&"accent"!==l.Cb(t,4).color&&"warn"!==l.Cb(t,4).color)}))}function _(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,4,"div",[["class","bottom-local-block"]],null,null,null,null,null)),(n()(),l.qb(1,0,null,null,3,"button",[["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],null,null,h.b,h.a)),l.pb(2,180224,null,0,g.b,[l.k,m.f,[2,r.a]],null,null),(n()(),l.qb(3,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(4,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){n(t,4,0,"phone-hangup")}),(function(n,t){n(t,1,0,l.Cb(t,2).disabled||null,"NoopAnimations"===l.Cb(t,2)._animationMode),n(t,3,0,l.Cb(t,4).inline,"primary"!==l.Cb(t,4).color&&"accent"!==l.Cb(t,4).color&&"warn"!==l.Cb(t,4).color)}))}function N(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,13,"div",[["class","bottom-peer-block"]],null,null,null,null,null)),(n()(),l.qb(1,0,null,null,0,"img",[["class","img-pulse"],["src","/assets/app-shell/Radio-1s-200px.svg"]],null,null,null,null,null)),(n()(),l.qb(2,0,null,null,3,"button",[["class","bottom-peer-video"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var l=!0;return"click"===t&&(l=!1!==n.component.clickIcon(0)&&l),l}),h.b,h.a)),l.pb(3,180224,null,0,g.b,[l.k,m.f,[2,r.a]],null,null),(n()(),l.qb(4,0,null,0,1,"mat-icon",[["class","video-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(5,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),l.qb(6,0,null,null,3,"button",[["class","phone-hangup"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var l=!0;return"click"===t&&(l=!1!==n.component.clickIcon(2)&&l),l}),h.b,h.a)),l.pb(7,180224,null,0,g.b,[l.k,m.f,[2,r.a]],null,null),(n()(),l.qb(8,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(9,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),l.qb(10,0,null,null,3,"button",[["class","bottom-peer-audio"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var l=!0;return"click"===t&&(l=!1!==n.component.clickIcon(1)&&l),l}),h.b,h.a)),l.pb(11,180224,null,0,g.b,[l.k,m.f,[2,r.a]],null,null),(n()(),l.qb(12,0,null,0,1,"mat-icon",[["class","microphone-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,b.b,b.a)),l.pb(13,9158656,null,0,d.b,[l.k,d.d,[8,null],[2,d.a],[2,l.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){var e=t.component;n(t,5,0,e.bottomVideo),n(t,9,0,"phone-hangup"),n(t,13,0,e.bottomAudio)}),(function(n,t){n(t,2,0,l.Cb(t,3).disabled||null,"NoopAnimations"===l.Cb(t,3)._animationMode),n(t,4,0,l.Cb(t,5).inline,"primary"!==l.Cb(t,5).color&&"accent"!==l.Cb(t,5).color&&"warn"!==l.Cb(t,5).color),n(t,6,0,l.Cb(t,7).disabled||null,"NoopAnimations"===l.Cb(t,7)._animationMode),n(t,8,0,l.Cb(t,9).inline,"primary"!==l.Cb(t,9).color&&"accent"!==l.Cb(t,9).color&&"warn"!==l.Cb(t,9).color),n(t,10,0,l.Cb(t,11).disabled||null,"NoopAnimations"===l.Cb(t,11)._animationMode),n(t,12,0,l.Cb(t,13).inline,"primary"!==l.Cb(t,13).color&&"accent"!==l.Cb(t,13).color&&"warn"!==l.Cb(t,13).color)}))}function S(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,26,"div",[["class","video-container"]],null,null,null,null,null)),l.Gb(512,null,u.y,u.z,[l.q,l.r,l.k,l.C]),l.pb(2,278528,null,0,u.j,[u.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(n()(),l.qb(3,0,null,null,9,"mat-toolbar",[["class","top-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,v.b,v.a)),l.pb(4,4243456,null,1,C.a,[l.k,s.a,u.d],null,null),l.Hb(603979776,1,{_toolbarRows:1}),(n()(),l.qb(6,0,null,0,2,"app-contact",[],null,null,null,f.b,f.a)),l.pb(7,114688,null,0,x.a,[l.h,w.a,l.z],{context:[0,"context"]},null),l.Db(131072,u.b,[l.h]),(n()(),l.gb(16777216,null,0,1,null,k)),l.pb(10,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null),(n()(),l.gb(16777216,null,0,1,null,O)),l.pb(12,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null),(n()(),l.qb(13,0,null,null,4,"div",[["class","main-video-container"]],null,null,null,null,null)),(n()(),l.qb(14,0,[["videoElement",1]],null,3,"video",[["autoplay",""],["class","video-element"],["playsinline",""]],[[8,"srcObject",0]],[[null,"loadeddata"],[null,"ended"]],(function(n,t,e){var l=!0,o=n.component;return"loadeddata"===t&&(l=!1!==o.onLoadedData()&&l),"ended"===t&&(l=!1!==o.onEnded()&&l),l}),null,null)),l.Gb(512,null,u.y,u.z,[l.q,l.r,l.k,l.C]),l.pb(16,278528,null,0,u.j,[u.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),l.Db(131072,u.b,[l.h]),(n()(),l.qb(18,0,null,null,8,"mat-toolbar",[["class","bottom-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,v.b,v.a)),l.Gb(512,null,u.y,u.z,[l.q,l.r,l.k,l.C]),l.pb(20,278528,null,0,u.j,[u.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),l.pb(21,4243456,null,1,C.a,[l.k,s.a,u.d],null,null),l.Hb(603979776,2,{_toolbarRows:1}),(n()(),l.gb(16777216,null,0,1,null,_)),l.pb(24,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null),(n()(),l.gb(16777216,null,0,1,null,N)),l.pb(26,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,2,0,"video-container",e.videoContext.className),n(t,7,0,l.Kb(t,7,0,l.Cb(t,8).transform(e.videoContext.contact))),n(t,10,0,e.videoContext.local),n(t,12,0,!e.videoContext.local),n(t,16,0,"video-element",e.videoContext.className),n(t,20,0,"bottom-toolbar",e.videoContext.className),n(t,24,0,!e.videoContext.local),n(t,26,0,e.videoContext.local)}),(function(n,t){var e=t.component;n(t,3,0,l.Cb(t,4)._toolbarRows.length>0,0===l.Cb(t,4)._toolbarRows.length),n(t,14,0,l.Kb(t,14,0,l.Cb(t,17).transform(e.videoContext.stream))),n(t,18,0,l.Cb(t,21)._toolbarRows.length>0,0===l.Cb(t,21)._toolbarRows.length)}))}class q{constructor(){}ngOnInit(){}}var z=l.ob({encapsulation:0,styles:[[".web-rtc-context-container[_ngcontent-%COMP%]{height:100%}"]],data:{}});function R(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,1,"app-video-channel",[],null,null,null,S,y)),l.pb(1,245760,null,0,A,[w.a,I.a,l.h],{videoContext:[0,"videoContext"]},null)],(function(n,t){n(t,1,0,t.context.$implicit)}),null)}function P(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,2,"div",[["class","web-rtc-context-container"]],null,null,null,null,null)),(n()(),l.gb(16777216,null,null,1,null,R)),l.pb(2,278528,null,0,u.k,[l.N,l.K,l.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,t){n(t,2,0,t.component.context.videoCollection)}),null)}var M=e("mrSG"),j=e("iInd"),L=e("pLZG"),D=e("fvN4"),J=e("2Vo4"),V=e("XNiG");class E{constructor(n,t,e,l,o){this.router=n,this.webRtcService=t,this.appContext=e,this.database=l,this.statusColor=o,this.progress=!0,this.subscriptions=[],this.duplicateCall=JSON.parse(window.localStorage.getItem("duplicateCall")),this.optimizeCall=JSON.parse(window.localStorage.getItem("optimizeCall")),this.video=JSON.parse(window.localStorage.getItem("videoinput")),this.micro=JSON.parse(window.localStorage.getItem("audioinput")),this.audio=JSON.parse(window.localStorage.getItem("audiooutput")),this.constraints={audio:{deviceId:!(!this.audio||!this.audio.deviceId)&&this.audio.deviceId,volume:1},video:{deviceId:!(!this.video||!this.video.deviceId)&&this.video.deviceId}}}ngOnInit(){this.router.events.pipe(Object(L.a)(n=>n instanceof j.g)).subscribe(n=>{}),this.startConnections()}ngAfterViewInit(){this.progress=!1}ngOnDestroy(){this.subscriptions.forEach(n=>n.unsubscribe())}handleDescriptor(n){}startConnections(){return M.__awaiter(this,void 0,void 0,(function*(){let n=this.appContext.webRtcContexts.getContext(this.appContext.contextId);if(!n)return;let t=n.uid===this.appContext.appUser.uid;n.localStream=yield navigator.mediaDevices.getUserMedia(this.constraints);let e=[n.sender].concat(n.receivers.value);if(e){let l=e.findIndex(n=>n.uid===this.appContext.user.value.uid);e.forEach((e,o)=>{let i=this.appContext.appUser.uid===e.uid,a=n.webRtcConnections[e.uid]=new D.g({uid:e.uid});a.webRtcContext=n,a.uid=e.uid,a.videoContext=new D.f({webRtcUid:n.uid,contact:new J.a(i?this.appContext.appUser:e),className:i?{[e.uid+" local video-context"]:!0,active:!1,fixed:!1,pulse:t}:{[e.uid+" remote video-context"]:!0,active:!1,pulse:!1},stream:new J.a(i?n.localStream:void 0),local:i,dataChannel:{data:new V.a,channel:void 0}}),n.videoCollection.push(a.videoContext),i||(a.pcConnection=new SimplePeer({initiator:t||e.uid===n.uid||l<o,channelName:e.uid,config:this.appContext.stunTurnConfig[t?window.localStorage.getItem("stunTurn"):n.desc.stun],stream:n.localStream}),a.videoContext.dataChannel.channel=a.pcConnection._channel,a.pcConnection.on("signal",l=>M.__awaiter(this,void 0,void 0,(function*(){if(l.type)"offer"===l.type?(a.offer=new D.d({type:t?"offers/explicit":"offers/implicit",action:"offered",contact:e,uid:this.appContext.appUser.uid,webRtcUid:n.uid,receivers:t?n.receivers.value:[e],sender:this.appContext.appUser,stun:t?window.localStorage.getItem("stunTurn"):n.desc.stun,desc:JSON.stringify(l),optimize:t?JSON.parse(window.localStorage.getItem("optimizeCall")):n.desc.optimize}),a.offer.optimize||this.webRtcService.sendOffer(a)):"answer"===l.type&&(a.answer=new D.a({type:"answer",active:!0,contact:e,uid:n.desc.uid,webRtcUid:n.uid,receivers:[n.sender],sender:this.appContext.appUser,desc:JSON.stringify(l),optimize:n.desc.optimize}),a.answer.optimize||(yield this.database.sendDescriptor(a.answer)));else if(l.candidate){let n=a.offer||a.answer,t=new D.b({webRtcUid:n.webRtcUid,contact:e,date:Date.now(),sender:this.appContext.user.value,descId:n.messId,type:"candidates",desc:JSON.stringify(l.candidate),active:!0,optimize:n.optimize});n.optimize?n.candidates.push(t):this.database.sendDescriptor(t).catch(this.onError)}}))),a.pcConnection._pc.addEventListener("icegatheringstatechange",n=>{if("complete"===n.target.iceGatheringState){let n=a.offer||a.answer;n.optimize&&(n.candidates.length?(/answer|offers\/implicit/.test(n.type)&&this.database.sendDescriptor(n).then(()=>{console.log("\u0421\u0431\u043e\u0440\u043a\u0430 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430. \u041a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b.")}).catch(this.onError),/offers\/explicit/.test(n.type)&&this.webRtcService.sendOffer(a)):(this.onError("\u0421\u0431\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0438 icegatheringstatechange."),this.setAnnouncement({type:"incompatibilityFailure",desc:{text:"\u0421\u0431\u043e\u0439 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438."}})))}}),a.pcConnection._pc.addEventListener("connectionstatechange",n=>{let t=a.videoContext.contact.value;t.statusColor=this.statusColor.statusColors.webrtc.perConnectionStates[n.type],a.videoContext.contact.next(t)}),a.pcConnection.on("connect",()=>{a.pcConnection.send({type:"settings",video:!0,audio:!0})}),a.pcConnection.on("data",n=>{a.videoContext.dataChannel.data.next(n)}),a.pcConnection.on("stream",n=>{a.videoContext.stream.next(n)}),a.pcConnection.on("close",()=>{}),a.pcConnection.on("error",n=>{}),t||0!==o||this.setDescriptor(a.pcConnection,n.desc))})}t||this.setImplicitListeners(),this.appContext.appChangeRef.markForCheck()}))}setDescriptor(n,t){n.signal(JSON.parse(t.desc)),"candidates"!==t.type&&(()=>M.__awaiter(this,void 0,void 0,(function*(){yield this.checkCandidates(t,n)})))()}requestCandidates(n,t){this.database.database.ref(`/web-rtc/candidates/${this.appContext.user.value.uid}`).orderByChild("descId").equalTo(n.messId).once("value").then(n=>{let e=n.val();e&&t.bind(this,e)()}).catch(this.onError)}checkCandidates(n,t){return new Promise((t,l)=>{n.optimize?e.bind(this,n.candidates,t,l)():this.requestCandidates(n,n=>{n&&e.bind(this,Object.values(n),t,l)()})});function e(n,e,l){n.forEach(n=>M.__awaiter(this,void 0,void 0,(function*(){t.signal(JSON.parse(n.desc)),this.database.setDescriptorOptions({descriptor:n,data:{active:!1}}).catch(n=>{console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0441\u043d\u044f\u0442\u0438\u0438 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u0438 \u0434\u0435\u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0440\u0430 \u0432 \u0431\u0430\u0437\u0435.")})}))).catch(n=>l(n)),e()}}setImplicitListeners(){}setAnnouncement(n){this.appContext.announcements.next([n].concat(this.appContext.announcements.value)),this.appContext.appChangeRef.markForCheck()}onError(n){console.log(n)}}var U=e("ZJFI"),F=e("tX6c"),K=l.ob({encapsulation:0,styles:[[".web-rtc-component-container[_ngcontent-%COMP%]{height:100%}.startScreen[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}"]],data:{}});function G(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,2,"div",[["class","startScreen"]],null,null,null,null,null)),(n()(),l.qb(1,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["color","primary"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,a.b,a.a)),l.pb(2,114688,null,0,c.b,[l.k,s.a,[2,u.d],[2,r.a],c.a],{color:[0,"color"],mode:[1,"mode"]},null)],(function(n,t){n(t,2,0,"primary","indeterminate")}),(function(n,t){n(t,1,0,l.Cb(t,2)._noopAnimations,l.Cb(t,2).diameter,l.Cb(t,2).diameter,"determinate"===l.Cb(t,2).mode?0:null,"determinate"===l.Cb(t,2).mode?100:null,"determinate"===l.Cb(t,2).mode?l.Cb(t,2).value:null,l.Cb(t,2).mode)}))}function T(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,1,"app-web-rtc-context",[],null,null,null,P,z)),l.pb(1,114688,null,0,q,[],{context:[0,"context"]},null)],(function(n,t){n(t,1,0,t.context.$implicit)}),null)}function B(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,3,"div",[["class","web-rtc-component-container"]],null,null,null,null,null)),(n()(),l.gb(16777216,null,null,2,null,T)),l.pb(2,278528,null,0,u.k,[l.N,l.K,l.q],{ngForOf:[0,"ngForOf"]},null),l.Db(131072,u.b,[l.h])],(function(n,t){var e=t.component;n(t,2,0,l.Kb(t,2,0,l.Cb(t,3).transform(e.appContext.webRtcContexts.contexts)))}),null)}function W(n){return l.Lb(0,[(n()(),l.gb(16777216,null,null,1,null,G)),l.pb(1,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null),(n()(),l.gb(16777216,null,null,1,null,B)),l.pb(3,16384,null,0,u.l,[l.N,l.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,1,0,e.progress),n(t,3,0,!e.progress)}),null)}function Z(n){return l.Lb(0,[(n()(),l.qb(0,0,null,null,1,"app-web-rtc",[],null,null,null,W,K)),l.pb(1,4440064,null,0,E,[j.o,I.a,w.a,U.a,F.a],null,null)],(function(n,t){n(t,1,0)}),null)}var H=l.mb("app-web-rtc",E,Z,{},{},[]),Q=e("NcP4"),X=e("POq0"),$=e("QQfA"),Y=e("IP0z"),nn=e("JjoW"),tn=e("Mz6y"),en=e("cUpR"),ln=e("Xd0L"),on=e("gavF"),an=e("/Co4"),cn=e("s7LF"),sn=e("/q54");class un{}var rn=e("igqZ"),bn=e("HsOI"),dn=e("zMNK"),pn=e("hOhj"),mn=e("oapL"),hn=e("ZwOa"),gn=e("8P0U"),vn=e("elxJ"),Cn=e("rWV4"),fn=e("mkRZ"),xn=e("pBi1"),wn=e("lT8R"),An=e("7of8"),In=e("VDRc"),yn=e("ura0"),kn=e("Nhcz"),On=e("u9T3"),_n=e("Gcy5");e.d(t,"WebRtcModuleNgFactory",(function(){return Nn}));var Nn=l.nb(o,[],(function(n){return l.zb([l.Ab(512,l.j,l.Z,[[8,[i.a,H,Q.a]],[3,l.j],l.v]),l.Ab(4608,u.n,u.m,[l.s,[2,u.D]]),l.Ab(4608,X.c,X.c,[]),l.Ab(4608,$.c,$.c,[$.i,$.e,l.j,$.h,$.f,l.p,l.x,u.d,Y.b,[2,u.h]]),l.Ab(5120,$.j,$.k,[$.c]),l.Ab(5120,nn.a,nn.b,[$.c]),l.Ab(5120,tn.b,tn.c,[$.c]),l.Ab(4608,en.e,ln.c,[[2,ln.g],[2,ln.l]]),l.Ab(4608,ln.b,ln.b,[]),l.Ab(5120,on.a,on.d,[$.c]),l.Ab(5120,an.b,an.c,[$.c]),l.Ab(4608,cn.e,cn.e,[]),l.Ab(4608,cn.w,cn.w,[]),l.Ab(5120,l.b,(function(n,t){return[sn.j(n,t)]}),[u.d,l.z]),l.Ab(1073742336,u.c,u.c,[]),l.Ab(1073742336,j.s,j.s,[[2,j.x],[2,j.o]]),l.Ab(1073742336,un,un,[]),l.Ab(1073742336,Y.a,Y.a,[]),l.Ab(1073742336,ln.l,ln.l,[[2,ln.d],[2,en.f]]),l.Ab(1073742336,C.b,C.b,[]),l.Ab(1073742336,d.c,d.c,[]),l.Ab(1073742336,rn.c,rn.c,[]),l.Ab(1073742336,X.d,X.d,[]),l.Ab(1073742336,bn.e,bn.e,[]),l.Ab(1073742336,dn.e,dn.e,[]),l.Ab(1073742336,s.b,s.b,[]),l.Ab(1073742336,pn.b,pn.b,[]),l.Ab(1073742336,$.g,$.g,[]),l.Ab(1073742336,ln.v,ln.v,[]),l.Ab(1073742336,ln.t,ln.t,[]),l.Ab(1073742336,ln.q,ln.q,[]),l.Ab(1073742336,nn.d,nn.d,[]),l.Ab(1073742336,m.a,m.a,[]),l.Ab(1073742336,tn.e,tn.e,[]),l.Ab(1073742336,g.c,g.c,[]),l.Ab(1073742336,mn.c,mn.c,[]),l.Ab(1073742336,hn.b,hn.b,[]),l.Ab(1073742336,gn.c,gn.c,[]),l.Ab(1073742336,c.c,c.c,[]),l.Ab(1073742336,vn.d,vn.d,[]),l.Ab(1073742336,Cn.j,Cn.j,[]),l.Ab(1073742336,p.b,p.b,[]),l.Ab(1073742336,on.c,on.c,[]),l.Ab(1073742336,on.b,on.b,[]),l.Ab(1073742336,an.e,an.e,[]),l.Ab(1073742336,fn.a,fn.a,[]),l.Ab(1073742336,xn.d,xn.d,[]),l.Ab(1073742336,xn.c,xn.c,[]),l.Ab(1073742336,wn.a,wn.a,[]),l.Ab(1073742336,An.a,An.a,[]),l.Ab(1073742336,cn.v,cn.v,[]),l.Ab(1073742336,cn.s,cn.s,[]),l.Ab(1073742336,sn.c,sn.c,[]),l.Ab(1073742336,In.a,In.a,[]),l.Ab(1073742336,yn.c,yn.c,[]),l.Ab(1073742336,kn.a,kn.a,[]),l.Ab(1073742336,On.a,On.a,[[2,sn.g],l.z]),l.Ab(1073742336,_n.a,_n.a,[]),l.Ab(1073742336,o,o,[]),l.Ab(1024,j.m,(function(){return[[{path:"",component:E}]]}),[])])}))}}]);
//# sourceMappingURL=18-es2015.5a1cdae3a09548a75645.js.map