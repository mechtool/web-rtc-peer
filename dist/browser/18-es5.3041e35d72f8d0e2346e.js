function _defineProperty(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function _defineProperties(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function _createClass(n,t,e){return t&&_defineProperties(n.prototype,t),e&&_defineProperties(n,e),n}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{z6Qy:function(n,t,e){"use strict";e.r(t);var o=e("8Y7J"),l=function n(){_classCallCheck(this,n)},a=e("pMnS"),i=e("W5yJ"),r=e("SVse"),s=e("IP0z"),c=e("Xd0L"),u=e("cUpR"),d=e("/HVE"),p=e("omvX"),b=o.ob({encapsulation:2,styles:[".mat-progress-spinner{display:block;position:relative}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{animation:mat-progress-spinner-linear-rotate 2s linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4s;animation-timing-function:cubic-bezier(.35,0,.25,1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{animation:mat-progress-spinner-stroke-rotate-fallback 10s cubic-bezier(.87,.03,.33,1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.60617px;transform:rotate(0)}12.5%{stroke-dashoffset:56.54867px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.60617px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.54867px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.60617px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.54867px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.60617px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.54867px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}"],data:{}});function m(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"animation-name",null],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(n,t){var e=t.component;n(t,0,0,e._circleRadius,"mat-progress-spinner-stroke-rotate-"+e.diameter,e._strokeDashOffset,e._strokeCircumference,e._circleStrokeWidth)}))}function f(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(n,t){var e=t.component;n(t,0,0,e._circleRadius,e._strokeDashOffset,e._strokeCircumference,e._circleStrokeWidth)}))}function g(n){return o.Lb(2,[(n()(),o.qb(0,0,null,null,5,":svg:svg",[["focusable","false"],["preserveAspectRatio","xMidYMid meet"]],[[4,"width","px"],[4,"height","px"],[1,"viewBox",0]],null,null,null,null)),o.pb(1,16384,null,0,r.p,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),o.gb(16777216,null,null,1,null,m)),o.pb(3,278528,null,0,r.q,[o.N,o.K,r.p],{ngSwitchCase:[0,"ngSwitchCase"]},null),(n()(),o.gb(16777216,null,null,1,null,f)),o.pb(5,278528,null,0,r.q,[o.N,o.K,r.p],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,t){n(t,1,0,"indeterminate"===t.component.mode),n(t,3,0,!0),n(t,5,0,!1)}),(function(n,t){var e=t.component;n(t,0,0,e.diameter,e.diameter,e._viewBox)}))}var h=o.ob({encapsulation:2,styles:[".mat-progress-spinner{display:block;position:relative}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{animation:mat-progress-spinner-linear-rotate 2s linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4s;animation-timing-function:cubic-bezier(.35,0,.25,1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{animation:mat-progress-spinner-stroke-rotate-fallback 10s cubic-bezier(.87,.03,.33,1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.60617px;transform:rotate(0)}12.5%{stroke-dashoffset:56.54867px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.60617px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.54867px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.60617px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.54867px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.60617px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.54867px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}"],data:{}});function v(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"animation-name",null],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(n,t){var e=t.component;n(t,0,0,e._circleRadius,"mat-progress-spinner-stroke-rotate-"+e.diameter,e._strokeDashOffset,e._strokeCircumference,e._circleStrokeWidth)}))}function C(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(n,t){var e=t.component;n(t,0,0,e._circleRadius,e._strokeDashOffset,e._strokeCircumference,e._circleStrokeWidth)}))}function x(n){return o.Lb(2,[(n()(),o.qb(0,0,null,null,5,":svg:svg",[["focusable","false"],["preserveAspectRatio","xMidYMid meet"]],[[4,"width","px"],[4,"height","px"],[1,"viewBox",0]],null,null,null,null)),o.pb(1,16384,null,0,r.p,[],{ngSwitch:[0,"ngSwitch"]},null),(n()(),o.gb(16777216,null,null,1,null,v)),o.pb(3,278528,null,0,r.q,[o.N,o.K,r.p],{ngSwitchCase:[0,"ngSwitchCase"]},null),(n()(),o.gb(16777216,null,null,1,null,C)),o.pb(5,278528,null,0,r.q,[o.N,o.K,r.p],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(n,t){n(t,1,0,"indeterminate"===t.component.mode),n(t,3,0,!0),n(t,5,0,!1)}),(function(n,t){var e=t.component;n(t,0,0,e.diameter,e.diameter,e._viewBox)}))}var k=e("bujt"),w=e("Fwaw"),y=e("5GAg"),_=e("Mr+X"),I=e("Gi4r"),A=e("KPQW"),O=e("FbN9"),q=e("BzsH"),S=e("2/pp"),R=e("xQwi"),N=e("VYsW"),P=e("ZJFI"),z=function(){function n(t,e,o,l,a){_classCallCheck(this,n),this.appContext=t,this.webRtcService=e,this.statusColor=o,this.changeRef=l,this.webRtcContext=a,this.localBadge="",this.toolbarVisibility=!1,this.subscriptions=[],this.buttons=[["video-off","video"],["audio-off","audio"]],this.t=void 0}return _createClass(n,[{key:"ngOnInit",value:function(){var n=this;this.videoContext.local&&this.subscriptions.push(this.appContext.announcements.subscribe((function(t){var e=t.filter((function(n){return n.active})).length;n.localBadge=0==e?"":e+""}))),this.subscriptions.push(this.videoContext.dataChannel.data.subscribe((function(t){if("settings"===t.type)"video"in t&&(n.videoContext.settings.video=t.video),"audio"in t&&(n.videoContext.settings.audio=t.audio);else if("status"===t.type){var e=n.videoContext.contact.value;e.statusColor=t.statusColor,n.videoContext.contact.next(e),n.webRtcService.checkConnectionState({state:t.statusText,contact:e,videoContext:n.videoContext})}n.changeRef.detectChanges()})))}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(n){return n.unsubscribe()}))}},{key:"clickIcon",value:function(n,t){var e;switch(t.stopImmediatePropagation(),n){case 0:var o=this.videoContext.stream.value.getVideoTracks()[0];o&&(o.enabled=!!(this.videoContext.settings.video=0==this.videoContext.settings.video?1:0)),e=this.videoContext.settings;break;case 1:var l=this.videoContext.stream.value.getAudioTracks()[0];l&&(l.enabled=!!(this.videoContext.settings.audio=0==this.videoContext.settings.audio?1:0)),e=this.videoContext.settings;break;case 2:this.webRtcService.stopVideoChannel(this.videoContext)}e&&(this.appContext.localVideoAudio=e,this.webRtcService.sendDataMessages(this.videoContext.wid,this.appContext.appUser.uid,e))}},{key:"onMoveElementVideo",value:function(n){var t=this;n.stopImmediatePropagation(),this.toolbarVisibility=!0,this.t&&clearTimeout(this.t),this.t=setTimeout((function(){t.toolbarVisibility=!1,clearTimeout(t.t),t.t=void 0,t.changeRef.detectChanges()}),4e3)}},{key:"onCloseView",value:function(n){this.webRtcContext.handleView(!0),n.stopImmediatePropagation()}},{key:"onLoadedData",value:function(){this.videoContext.className.active=!0,this.videoContext.local||this.webRtcService.checkVideoContexts(this.videoContext)}},{key:"onEnded",value:function(){this.videoContext.className.active=!1,this.webRtcService.checkVideoContexts(this.videoContext)}}]),n}(),M=e("hoN+"),L=e("tX6c"),D=function(){function n(){_classCallCheck(this,n),this.localToolbar=!1}return _createClass(n,[{key:"ngOnInit",value:function(){}},{key:"handleView",value:function(n){this.context.videoCollection.find((function(n){return n.local})).className.closed=this.localToolbar=n}}]),n}(),j=o.ob({encapsulation:0,styles:[[".video-container[_ngcontent-%COMP%]{position:relative;flex:1 1 0;height:100%;display:flex;justify-content:center;align-items:center;overflow:hidden}.main-video-container[_ngcontent-%COMP%]{top:0;position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}.top-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;background:0 0;display:flex;align-items:center;justify-content:center;z-index:2}.bottom-local-block[_ngcontent-%COMP%]{width:160px;display:flex;justify-content:space-between;align-items:center}.bottom-peer-audio[_ngcontent-%COMP%], .bottom-peer-video[_ngcontent-%COMP%], .close-view[_ngcontent-%COMP%]{background-color:transparent!important}video.video-element[_ngcontent-%COMP%]{position:absolute;z-index:0;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:50% 50%;object-position:50% 50%;border:0 solid #cecece}.phone-hangup[_ngcontent-%COMP%]{background-color:#c60000!important}mat-icon[_ngcontent-%COMP%]{color:#fff!important}.bottom-toolbar.local[_ngcontent-%COMP%]{background:0 0;position:absolute;display:flex;justify-content:center;bottom:0}.bottom-toolbar.remote[_ngcontent-%COMP%]{position:absolute;background:0 0;display:flex;justify-content:center}.img-pulse[_ngcontent-%COMP%]{position:absolute;transform:scale(.9) rotate(-45deg);transform-origin:13px 88px;display:none}div.video-container.active.pulse[_ngcontent-%COMP%]   .img-pulse[_ngcontent-%COMP%]{display:initial}div.video-container.local.active[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;transition:.5s}div.video-container.local.active.fixed[_ngcontent-%COMP%]{bottom:0;left:0;width:200px;height:200px;top:unset}div.video-container.local.active.fixed.closed[_ngcontent-%COMP%]{width:0;height:0}"]],data:{}});function V(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,3,"button",[["class","close-view"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.onCloseView(e)&&o),o}),k.b,k.a)),o.pb(1,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(2,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","close-view"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(3,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){n(t,3,0,"close-view")}),(function(n,t){n(t,0,0,o.Cb(t,1).disabled||null,"NoopAnimations"===o.Cb(t,1)._animationMode),n(t,2,0,o.Cb(t,3).inline,"primary"!==o.Cb(t,3).color&&"accent"!==o.Cb(t,3).color&&"warn"!==o.Cb(t,3).color)}))}function E(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,5,null,null,null,null,null,null,null)),(n()(),o.qb(1,0,null,null,2,"mat-icon",[["class","mat-icon notranslate mat-badge"],["matBadgeSize","small"],["role","img"],["svgIcon","notifications"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null],[2,"mat-badge-overlap",null],[2,"mat-badge-above",null],[2,"mat-badge-below",null],[2,"mat-badge-before",null],[2,"mat-badge-after",null],[2,"mat-badge-small",null],[2,"mat-badge-medium",null],[2,"mat-badge-large",null],[2,"mat-badge-hidden",null],[2,"mat-badge-disabled",null]],null,null,_.b,_.a)),o.pb(2,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),o.pb(3,671744,null,0,A.a,[o.x,o.k,y.c,o.C,[2,p.a]],{color:[0,"color"],content:[1,"content"],size:[2,"size"]},null),(n()(),o.gb(16777216,null,null,1,null,V)),o.pb(5,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(0,null,null,0))],(function(n,t){var e=t.component;n(t,2,0,"notifications"),n(t,3,0,"accent",e.localBadge,"small"),n(t,5,0,e.videoContext.className.fixed)}),(function(n,t){n(t,1,1,[o.Cb(t,2).inline,"primary"!==o.Cb(t,2).color&&"accent"!==o.Cb(t,2).color&&"warn"!==o.Cb(t,2).color,o.Cb(t,3).overlap,o.Cb(t,3).isAbove(),!o.Cb(t,3).isAbove(),!o.Cb(t,3).isAfter(),o.Cb(t,3).isAfter(),"small"===o.Cb(t,3).size,"medium"===o.Cb(t,3).size,"large"===o.Cb(t,3).size,o.Cb(t,3).hidden||!o.Cb(t,3)._hasContent,o.Cb(t,3).disabled])}))}function K(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,4,null,null,null,null,null,null,null)),(n()(),o.qb(1,0,null,null,1,"mat-icon",[["class","video-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(2,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(3,0,null,null,1,"mat-icon",[["class","microphone-peer-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(4,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){var e=t.component;n(t,2,0,e.buttons[0][e.videoContext.settings.video]),n(t,4,0,e.buttons[1][e.videoContext.settings.audio])}),(function(n,t){n(t,1,0,o.Cb(t,2).inline,"primary"!==o.Cb(t,2).color&&"accent"!==o.Cb(t,2).color&&"warn"!==o.Cb(t,2).color),n(t,3,0,o.Cb(t,4).inline,"primary"!==o.Cb(t,4).color&&"accent"!==o.Cb(t,4).color&&"warn"!==o.Cb(t,4).color)}))}function X(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,10,"mat-toolbar",[["class","top-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,O.b,O.a)),o.pb(1,4243456,null,1,q.a,[o.k,d.a,r.d],null,null),o.Hb(603979776,1,{_toolbarRows:1}),(n()(),o.qb(3,0,null,0,2,"app-contact",[],null,null,null,S.b,S.a)),o.pb(4,114688,null,0,R.a,[o.h,N.a,P.a,o.z],{context:[0,"context"]},null),o.Db(131072,r.b,[o.h]),(n()(),o.qb(6,0,null,0,0,"div",[["class","example-spacer"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,0,1,null,E)),o.pb(8,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,0,1,null,K)),o.pb(10,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,4,0,o.Kb(t,4,0,o.Cb(t,5).transform(e.videoContext.contact))),n(t,8,0,e.videoContext.local),n(t,10,0,!e.videoContext.local)}),(function(n,t){n(t,0,0,o.Cb(t,1)._toolbarRows.length>0,0===o.Cb(t,1)._toolbarRows.length)}))}function T(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"mat-spinner",[["class","mat-spinner mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"]],null,null,x,h)),o.pb(1,114688,null,0,i.d,[o.k,d.a,[2,r.d],[2,p.a],i.a],null,null)],(function(n,t){n(t,1,0)}),(function(n,t){n(t,0,0,o.Cb(t,1)._noopAnimations,o.Cb(t,1).diameter,o.Cb(t,1).diameter)}))}function B(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,4,"div",[["class","bottom-peer-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,3,"button",[["class","phone-hangup"],["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.clickIcon(2,e)&&o),o}),k.b,k.a)),o.pb(2,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(3,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(4,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){n(t,4,0,"phone-hangup")}),(function(n,t){n(t,1,0,o.Cb(t,2).disabled||null,"NoopAnimations"===o.Cb(t,2)._animationMode),n(t,3,0,o.Cb(t,4).inline,"primary"!==o.Cb(t,4).color&&"accent"!==o.Cb(t,4).color&&"warn"!==o.Cb(t,4).color)}))}function J(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,0,"img",[["class","img-pulse"],["src","/assets/app-shell/Radio-1s-200px.svg"]],null,null,null,null,null))],null,null)}function F(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,14,"div",[["class","bottom-local-block"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,null,1,null,J)),o.pb(2,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.qb(3,0,null,null,3,"button",[["class","bottom-peer-video"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.clickIcon(0,e)&&o),o}),k.b,k.a)),o.pb(4,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(5,0,null,0,1,"mat-icon",[["class","video-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(6,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(7,0,null,null,3,"button",[["class","phone-hangup"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.clickIcon(2,e)&&o),o}),k.b,k.a)),o.pb(8,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(9,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","phone-hangup"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(10,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null),(n()(),o.qb(11,0,null,null,3,"button",[["class","bottom-peer-audio"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.clickIcon(1,e)&&o),o}),k.b,k.a)),o.pb(12,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(13,0,null,0,1,"mat-icon",[["class","microphone-img mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(14,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){var e=t.component;n(t,2,0,e.videoContext.className.pulse),n(t,6,0,e.buttons[0][e.videoContext.settings.video]),n(t,10,0,"phone-hangup"),n(t,14,0,e.buttons[1][e.videoContext.settings.audio])}),(function(n,t){n(t,3,0,o.Cb(t,4).disabled||null,"NoopAnimations"===o.Cb(t,4)._animationMode),n(t,5,0,o.Cb(t,6).inline,"primary"!==o.Cb(t,6).color&&"accent"!==o.Cb(t,6).color&&"warn"!==o.Cb(t,6).color),n(t,7,0,o.Cb(t,8).disabled||null,"NoopAnimations"===o.Cb(t,8)._animationMode),n(t,9,0,o.Cb(t,10).inline,"primary"!==o.Cb(t,10).color&&"accent"!==o.Cb(t,10).color&&"warn"!==o.Cb(t,10).color),n(t,11,0,o.Cb(t,12).disabled||null,"NoopAnimations"===o.Cb(t,12)._animationMode),n(t,13,0,o.Cb(t,14).inline,"primary"!==o.Cb(t,14).color&&"accent"!==o.Cb(t,14).color&&"warn"!==o.Cb(t,14).color)}))}function U(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,8,"mat-toolbar",[["class","bottom-toolbar mat-toolbar"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,O.b,O.a)),o.Gb(512,null,r.y,r.z,[o.q,o.r,o.k,o.C]),o.pb(2,278528,null,0,r.j,[r.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),o.pb(3,4243456,null,1,q.a,[o.k,d.a,r.d],null,null),o.Hb(603979776,2,{_toolbarRows:1}),(n()(),o.gb(16777216,null,0,1,null,B)),o.pb(6,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,0,1,null,F)),o.pb(8,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,2,0,"bottom-toolbar",e.videoContext.className),n(t,6,0,!e.videoContext.local),n(t,8,0,e.videoContext.local)}),(function(n,t){n(t,0,0,o.Cb(t,3)._toolbarRows.length>0,0===o.Cb(t,3)._toolbarRows.length)}))}function G(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,13,"div",[["class","video-container"]],null,[[null,"mousemove"]],(function(n,t,e){var o=!0;return"mousemove"===t&&(o=!1!==n.component.onMoveElementVideo(e)&&o),o}),null,null)),o.Gb(512,null,r.y,r.z,[o.q,o.r,o.k,o.C]),o.pb(2,278528,null,0,r.j,[r.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(n()(),o.gb(16777216,null,null,1,null,X)),o.pb(4,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.qb(5,0,null,null,6,"div",[["class","main-video-container"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,null,1,null,T)),o.pb(7,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.qb(8,0,[["videoElement",1]],null,3,"video",[["autoplay",""],["class","video-element"],["playsinline",""]],[[8,"srcObject",0]],[[null,"loadeddata"],[null,"ended"]],(function(n,t,e){var o=!0,l=n.component;return"loadeddata"===t&&(o=!1!==l.onLoadedData()&&o),"ended"===t&&(o=!1!==l.onEnded()&&o),o}),null,null)),o.Gb(512,null,r.y,r.z,[o.q,o.r,o.k,o.C]),o.pb(10,278528,null,0,r.j,[r.y],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),o.Db(131072,r.b,[o.h]),(n()(),o.gb(16777216,null,null,1,null,U)),o.pb(13,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,2,0,"video-container",e.videoContext.className),n(t,4,0,e.toolbarVisibility),n(t,7,0,!e.videoContext.className.active),n(t,10,0,"video-element",e.videoContext.className),n(t,13,0,e.toolbarVisibility)}),(function(n,t){var e=t.component;n(t,8,0,o.Kb(t,8,0,o.Cb(t,11).transform(e.videoContext.stream)))}))}var W=function(){function n(t,e){_classCallCheck(this,n),this.appContext=t,this.webRtcContext=e,this.localBadge="",this.subscriptions=[]}return _createClass(n,[{key:"ngOnInit",value:function(){var n=this;this.subscriptions.push(this.appContext.announcements.subscribe((function(t){var e=t.filter((function(n){return n.active})).length;n.localBadge=0==e?"":e+""})))}},{key:"onOpenView",value:function(){this.webRtcContext.handleView(!1)}}]),n}(),Z=o.ob({encapsulation:0,styles:[["[_nghost-%COMP%]{position:absolute;z-index:8;left:10px;bottom:10px}.main-block[_ngcontent-%COMP%]{width:80px;display:flex;justify-content:center;align-items:center}button[_ngcontent-%COMP%]{background-color:transparent!important;color:#fff!important}"]],data:{}});function H(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,9,"div",[["class","outer-toolbar-block"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,8,"div",[["class","main-block"]],null,null,null,null,null)),(n()(),o.qb(2,0,null,null,2,"app-contact",[],null,null,null,S.b,S.a)),o.pb(3,114688,null,0,R.a,[o.h,N.a,P.a,o.z],{context:[0,"context"]},null),o.Db(131072,r.b,[o.h]),(n()(),o.qb(5,0,null,null,0,"span",[["class","example-spacer"]],null,null,null,null,null)),(n()(),o.qb(6,0,null,null,3,"button",[["class","close-view"],["mat-mini-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(n,t,e){var o=!0;return"click"===t&&(o=!1!==n.component.onOpenView()&&o),o}),k.b,k.a)),o.pb(7,180224,null,0,w.b,[o.k,y.f,[2,p.a]],null,null),(n()(),o.qb(8,0,null,0,1,"mat-icon",[["class","mat-icon notranslate"],["role","img"],["svgIcon","close-view"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,_.b,_.a)),o.pb(9,9158656,null,0,I.b,[o.k,I.d,[8,null],[2,I.a],[2,o.l]],{svgIcon:[0,"svgIcon"]},null)],(function(n,t){var e=t.component;n(t,3,0,o.Kb(t,3,0,o.Cb(t,4).transform(e.appContext.user))),n(t,9,0,"close-view")}),(function(n,t){n(t,6,0,o.Cb(t,7).disabled||null,"NoopAnimations"===o.Cb(t,7)._animationMode),n(t,8,0,o.Cb(t,9).inline,"primary"!==o.Cb(t,9).color&&"accent"!==o.Cb(t,9).color&&"warn"!==o.Cb(t,9).color)}))}var Q=o.ob({encapsulation:0,styles:[[".web-rtc-context-container[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:stretch;align-items:stretch}app-video-channel[_ngcontent-%COMP%]{flex:1 1 0}app-video-channel.local[_ngcontent-%COMP%]{flex:0 0 0}@media (orientation:landscape){.web-rtc-context-container[_ngcontent-%COMP%]{flex-direction:row}}@media (orientation:portrait){.web-rtc-context-container[_ngcontent-%COMP%]{flex-direction:column}}"]],data:{}});function Y(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,3,"app-video-channel",[],null,null,null,G,j)),o.Gb(512,null,r.y,r.z,[o.q,o.r,o.k,o.C]),o.pb(2,278528,null,0,r.j,[r.y],{ngClass:[0,"ngClass"]},null),o.pb(3,245760,null,0,z,[N.a,M.a,L.a,o.h,D],{videoContext:[0,"videoContext"]},null)],(function(n,t){n(t,2,0,t.context.$implicit.channelClass),n(t,3,0,t.context.$implicit)}),null)}function $(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-outer-toolbar",[],null,null,null,H,Z)),o.pb(1,114688,null,0,W,[N.a,D],null,null)],(function(n,t){n(t,1,0)}),null)}function nn(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,2,"div",[["class","web-rtc-context-container"]],null,null,null,null,null)),(n()(),o.gb(16777216,null,null,1,null,Y)),o.pb(2,278528,null,0,r.k,[o.N,o.K,o.q],{ngForOf:[0,"ngForOf"]},null),(n()(),o.gb(16777216,null,null,1,null,$)),o.pb(4,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,2,0,e.context.videoCollection),n(t,4,0,e.localToolbar)}),null)}var tn=e("mrSG"),en=e("iInd"),on=e("pLZG"),ln=e("fvN4"),an=e("2Vo4"),rn=e("XNiG"),sn=function(){function n(t,e,o,l,a){_classCallCheck(this,n),this.router=t,this.webRtcService=e,this.appContext=o,this.database=l,this.statusColor=a,this.progress=!0,this.subscriptions=[],this.duplicateCall=JSON.parse(window.localStorage.getItem("duplicateCall")),this.optimizeCall=JSON.parse(window.localStorage.getItem("optimizeCall")),this.video=JSON.parse(window.localStorage.getItem("videoinput")),this.micro=JSON.parse(window.localStorage.getItem("audioinput")),this.audio=JSON.parse(window.localStorage.getItem("audiooutput")),this.flexDirection="column",this.constraints={audio:{deviceId:!(!this.audio||!this.audio.deviceId)&&this.audio.deviceId,echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0},video:{deviceId:!(!this.video||!this.video.deviceId)&&this.video.deviceId}}}return _createClass(n,[{key:"ngOnInit",value:function(){this.router.events.pipe(Object(on.a)((function(n){return n instanceof en.g}))).subscribe((function(n){})),this.startConnections()}},{key:"ngAfterViewInit",value:function(){this.progress=!1}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach((function(n){return n.unsubscribe()}))}},{key:"handleDescriptor",value:function(n,t){var e=t.val();e.type.indexOf("answers")>-1&&this.setDescriptor(n.pcConnection,e),e.type.indexOf("offers")>-1&&this.startConnections(e)}},{key:"dispatchDescriptor",value:function(n){var t=this,e=this,o=n.descriptor,l=n.candidates;function a(t){/answers|offers\/implicit/.test(t.type)?e.database.sendDescriptor(t):e.webRtcService.sendOffer(n),t.type.indexOf("offers")>-1&&e.setAnswerListener(n)}o.optimize&&l.length?(o.candidates=this.setCandidates(o,l),a(o)):o.optimize||(a(o),l.length&&this.setCandidates(o,l).forEach((function(n){t.database.sendDescriptor(n).catch(t.onError)})))}},{key:"setCandidates",value:function(n,t){var e=this,o=[];return t.forEach((function(t){o.push(new ln.b({wid:n.wid,contact:n.contact,date:Date.now(),sender:e.appContext.user.value,descId:n.messId,type:"candidates",desc:t,active:!0,optimize:n.optimize,uid:n.uid}))})),o}},{key:"setAnswerListener",value:function(n){this.database.getRef("/web-rtc/answers/"+this.appContext.appUser.uid).orderByChild("descId").equalTo(n.descriptor.messId).once("child_added",this.handleDescriptor.bind(this,n))}},{key:"setImplicitListener",value:function(n){this.database.getRef("/web-rtc/offers/implicit/"+this.appContext.appUser.uid).orderByChild("descId").equalTo(n).once("child_added",this.handleDescriptor.bind(this,n))}},{key:"startConnections",value:function(n){return tn.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,o,l,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.appContext.webRtcContexts.getContext(this.appContext.contextId)){t.next=3;break}return t.abrupt("return");case 3:if(t.t0=e.localStream,t.t0){t.next=8;break}return t.next=7,navigator.mediaDevices.getUserMedia(this.constraints);case 7:e.localStream=t.sent;case 8:o=n?n.sender:e.sender,(l=n?[o]:[o].concat(e.receivers.value))&&(a=l.findIndex((function(n){return n.uid===i.appContext.user.value.uid})),l.forEach((function(t,o){var l,r,s,c=i.appContext.appUser.uid===t.uid,u=!n&&(e.uid===i.appContext.appUser.uid||a<o);(a<=o||!u&&0==o)&&((s=e.webRtcConnections[t.uid]=new ln.g({uid:t.uid})).webRtcContext=e,s.uid=t.uid,s.videoContext=new ln.f({wid:e.wid,contact:new an.a(c?i.appContext.appUser:t),channelClass:c?"local":"remote",className:c?(l={},_defineProperty(l,t.uid+" local video-context",!0),_defineProperty(l,"active",!1),_defineProperty(l,"fixed",!1),_defineProperty(l,"closed",!1),_defineProperty(l,"pulse",u),l):(r={},_defineProperty(r,t.uid+" remote video-context",!0),_defineProperty(r,"active",!1),r),stream:new an.a(c?e.localStream:void 0),local:c,settings:{type:"settings",video:1,audio:1},dataChannel:{data:new rn.a,channel:void 0}}),c&&e.videoCollection.push(s.videoContext)),a<o||!u&&0==o?(s.pcConnection=new SimplePeer({initiator:u,channelName:t.uid,config:i.appContext.stunTurnConfig[u?window.localStorage.getItem("stunTurn"):e.desc.stun],stream:e.localStream}),s.pcConnection._debug=console.log,u&&(s.videoContext.dataChannel.channel=s.pcConnection._channel),s.pcConnection.on("signal",(function(o){return tn.__awaiter(i,void 0,void 0,regeneratorRuntime.mark((function l(){var a,i;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:o.type?("offer"===o.type?s.descriptor=new ln.d({type:e.uid===this.appContext.appUser.uid?"offers/explicit":"offers/implicit",action:"offered",contact:this.checkContact(t),uid:this.appContext.appUser.uid,wid:e.wid,receivers:u?e.receivers.value:[t],sender:this.appContext.appUser,stun:u?window.localStorage.getItem("stunTurn"):e.desc.stun,desc:o,descId:e.wid+this.appContext.appUser.uid,optimize:u?JSON.parse(window.localStorage.getItem("optimizeCall")):e.desc.optimize,candidates:!!JSON.parse(window.localStorage.getItem("optimizeCall"))&&[]}):"answer"===o.type&&(s.descriptor=new ln.a({type:"answers",active:!0,contact:this.checkContact(t),uid:e.desc.uid,descId:n?n.messId:e.desc.messId,wid:e.wid,receivers:[n?n.sender:e.sender],sender:this.appContext.appUser,desc:o,optimize:e.desc.optimize,candidates:!!e.desc.optimize&&[]})),this.dispatchDescriptor(s)):o.candidate&&((a=s.descriptor)?(i=new ln.b({wid:a.wid,contact:this.checkContact(t),date:Date.now(),sender:this.appContext.user.value,descId:a.messId,type:"candidates",desc:o.candidate,active:!0,optimize:a.optimize,uid:a.uid}),a.optimize?a.candidates.push(i):this.database.sendDescriptor(i).catch(this.onError)):s.candidates.push(o.candidate));case 1:case"end":return l.stop()}}),l,this)})))})),s.pcConnection._pc.addEventListener("icegatheringstatechange",(function(n){if("complete"===n.target.iceGatheringState){var t=s.descriptor;t&&t.optimize&&(t.candidates.length?(/answers|offers\/implicit/.test(t.type)&&i.database.sendDescriptor(t).then((function(){console.log("\u0421\u0431\u043e\u0440\u043a\u0430 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0430. \u041a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u044b.")})).catch(i.onError),/offers\/explicit/.test(t.type)&&i.webRtcService.sendOffer(s),t.type.indexOf("offers")>-1&&i.setAnswerListener(s)):(i.onError("\u0421\u0431\u043e\u0439 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432 \u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0438 icegatheringstatechange."),i.setAnnouncement({type:"incompatibilityFailure",desc:{text:"\u0421\u0431\u043e\u0439 \u043d\u0435\u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438."}})))}})),s.pcConnection._pc.addEventListener("connectionstatechange",(function(n){var t=s.videoContext.contact.value;t.statusColor=i.statusColor.statusColors.webrtc.perConnectionStates[n.target.connectionState],s.videoContext.contact.next(t)})),s.pcConnection.on("connect",(function(){u||(s.videoContext.dataChannel.channel=s.pcConnection._channel),s.pcConnection.send(JSON.stringify(i.appContext.localVideoAudio))})),s.pcConnection.on("data",(function(n){s.videoContext.dataChannel.data.next(JSON.parse(n))})),s.pcConnection.on("stream",(function(n){s.videoContext.stream.next(n),e.videoCollection.push(s.videoContext),i.appContext.appChangeRef.markForCheck()})),s.pcConnection.on("close",(function(n){})),s.pcConnection.on("error",(function(n){})),u||0!==o||i.setDescriptor(s.pcConnection,n||e.desc)):a>o&&i.setImplicitListener(e.wid+t.uid)}))),this.appContext.appChangeRef.markForCheck();case 11:case"end":return t.stop()}}),t,this)})))}},{key:"checkContact",value:function(n){return n.statusColor=n.statusColor||"",n}},{key:"setDescriptor",value:function(n,t){var e=this;n.signal(t.desc),this.database.setDescriptorOptions({descriptor:t,data:/answers/.test(t.type)?{active:!1}:{active:!1,action:"accepted"}}).then((function(n){})).catch((function(n){return e.onError(n)})),tn.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.checkCandidates(t,n);case 2:case"end":return e.stop()}}),e,this)})))}},{key:"requestCandidates",value:function(n){return tn.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.database.database.ref("/web-rtc/candidates/".concat(this.appContext.user.value.uid)).orderByChild("descId").equalTo(n.messId).once("value"));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"checkCandidates",value:function(n,t){var e=this;return new Promise((function(t,l){n.optimize?o.bind(e,n.candidates,t)():e.requestCandidates(n).then((function(n){var l=n.val();l&&o.bind(e,Object.values(l),t)()})).catch(e.onError)}));function o(n,e){var o=this,l=this;n.forEach((function(n){t.signal({candidate:n.desc}),l.database.setDescriptorOptions({descriptor:n,data:{active:!1}}).then((function(t){return tn.__awaiter(o,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.database.deleteDescriptor({descriptor:n});case 2:case"end":return t.stop()}}),t)})))})).catch((function(n){return l.onError(n)}))})),e()}}},{key:"setAnnouncement",value:function(n){this.appContext.announcements.next([n].concat(this.appContext.announcements.value)),this.appContext.appChangeRef.markForCheck()}},{key:"onError",value:function(n){console.log(n)}}]),n}(),cn=o.ob({encapsulation:0,styles:[[".web-rtc-component-container[_ngcontent-%COMP%]{height:100%}.startScreen[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}"]],data:{}});function un(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,2,"div",[["class","startScreen"]],null,null,null,null,null)),(n()(),o.qb(1,0,null,null,1,"mat-progress-spinner",[["class","mat-progress-spinner"],["color","primary"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"],[1,"aria-valuemin",0],[1,"aria-valuemax",0],[1,"aria-valuenow",0],[1,"mode",0]],null,null,g,b)),o.pb(2,114688,null,0,i.b,[o.k,d.a,[2,r.d],[2,p.a],i.a],{color:[0,"color"],mode:[1,"mode"]},null)],(function(n,t){n(t,2,0,"primary","indeterminate")}),(function(n,t){n(t,1,0,o.Cb(t,2)._noopAnimations,o.Cb(t,2).diameter,o.Cb(t,2).diameter,"determinate"===o.Cb(t,2).mode?0:null,"determinate"===o.Cb(t,2).mode?100:null,"determinate"===o.Cb(t,2).mode?o.Cb(t,2).value:null,o.Cb(t,2).mode)}))}function dn(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-web-rtc-context",[],null,null,null,nn,Q)),o.pb(1,114688,null,0,D,[],{context:[0,"context"]},null)],(function(n,t){n(t,1,0,t.context.$implicit)}),null)}function pn(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,6,"div",[["class","web-rtc-component-container"]],null,null,null,null,null)),o.Gb(512,null,r.A,r.B,[o.k,o.r,o.C]),o.pb(2,278528,null,0,r.o,[r.A],{ngStyle:[0,"ngStyle"]},null),o.Eb(3,{"flex-direction":0}),(n()(),o.gb(16777216,null,null,2,null,dn)),o.pb(5,278528,null,0,r.k,[o.N,o.K,o.q],{ngForOf:[0,"ngForOf"]},null),o.Db(131072,r.b,[o.h])],(function(n,t){var e=t.component,l=n(t,3,0,e.flexDirection);n(t,2,0,l),n(t,5,0,o.Kb(t,5,0,o.Cb(t,6).transform(e.appContext.webRtcContexts.contexts)))}),null)}function bn(n){return o.Lb(0,[(n()(),o.gb(16777216,null,null,1,null,un)),o.pb(1,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null),(n()(),o.gb(16777216,null,null,1,null,pn)),o.pb(3,16384,null,0,r.l,[o.N,o.K],{ngIf:[0,"ngIf"]},null)],(function(n,t){var e=t.component;n(t,1,0,e.progress),n(t,3,0,!e.progress)}),null)}var mn=o.mb("app-web-rtc",sn,(function(n){return o.Lb(0,[(n()(),o.qb(0,0,null,null,1,"app-web-rtc",[],null,null,null,bn,cn)),o.pb(1,4440064,null,0,sn,[en.o,M.a,N.a,P.a,L.a],null,null)],(function(n,t){n(t,1,0)}),null)}),{},{},[]),fn=e("NcP4"),gn=e("POq0"),hn=e("QQfA"),vn=e("JjoW"),Cn=e("Mz6y"),xn=e("gavF"),kn=e("/Co4"),wn=e("s7LF"),yn=e("/q54"),_n=function n(){_classCallCheck(this,n)},In=e("igqZ"),An=e("HsOI"),On=e("zMNK"),qn=e("hOhj"),Sn=e("oapL"),Rn=e("ZwOa"),Nn=e("8P0U"),Pn=e("elxJ"),zn=e("rWV4"),Mn=e("mkRZ"),Ln=e("pBi1"),Dn=e("lT8R"),jn=e("7of8"),Vn=e("VDRc"),En=e("ura0"),Kn=e("Nhcz"),Xn=e("u9T3"),Tn=e("Gcy5");e.d(t,"WebRtcModuleNgFactory",(function(){return Bn}));var Bn=o.nb(l,[],(function(n){return o.zb([o.Ab(512,o.j,o.Z,[[8,[a.a,mn,fn.a]],[3,o.j],o.v]),o.Ab(4608,r.n,r.m,[o.s,[2,r.D]]),o.Ab(4608,gn.c,gn.c,[]),o.Ab(4608,hn.c,hn.c,[hn.i,hn.e,o.j,hn.h,hn.f,o.p,o.x,r.d,s.b,[2,r.h]]),o.Ab(5120,hn.j,hn.k,[hn.c]),o.Ab(5120,vn.a,vn.b,[hn.c]),o.Ab(5120,Cn.b,Cn.c,[hn.c]),o.Ab(4608,u.e,c.c,[[2,c.g],[2,c.l]]),o.Ab(4608,c.b,c.b,[]),o.Ab(5120,xn.a,xn.d,[hn.c]),o.Ab(5120,kn.b,kn.c,[hn.c]),o.Ab(4608,wn.e,wn.e,[]),o.Ab(4608,wn.w,wn.w,[]),o.Ab(5120,o.b,(function(n,t){return[yn.j(n,t)]}),[r.d,o.z]),o.Ab(1073742336,r.c,r.c,[]),o.Ab(1073742336,en.s,en.s,[[2,en.x],[2,en.o]]),o.Ab(1073742336,_n,_n,[]),o.Ab(1073742336,s.a,s.a,[]),o.Ab(1073742336,c.l,c.l,[[2,c.d],[2,u.f]]),o.Ab(1073742336,q.b,q.b,[]),o.Ab(1073742336,I.c,I.c,[]),o.Ab(1073742336,In.c,In.c,[]),o.Ab(1073742336,gn.d,gn.d,[]),o.Ab(1073742336,An.e,An.e,[]),o.Ab(1073742336,On.e,On.e,[]),o.Ab(1073742336,d.b,d.b,[]),o.Ab(1073742336,qn.b,qn.b,[]),o.Ab(1073742336,hn.g,hn.g,[]),o.Ab(1073742336,c.v,c.v,[]),o.Ab(1073742336,c.t,c.t,[]),o.Ab(1073742336,c.q,c.q,[]),o.Ab(1073742336,vn.d,vn.d,[]),o.Ab(1073742336,y.a,y.a,[]),o.Ab(1073742336,Cn.e,Cn.e,[]),o.Ab(1073742336,w.c,w.c,[]),o.Ab(1073742336,Sn.c,Sn.c,[]),o.Ab(1073742336,Rn.b,Rn.b,[]),o.Ab(1073742336,Nn.c,Nn.c,[]),o.Ab(1073742336,i.c,i.c,[]),o.Ab(1073742336,Pn.d,Pn.d,[]),o.Ab(1073742336,zn.j,zn.j,[]),o.Ab(1073742336,A.b,A.b,[]),o.Ab(1073742336,xn.c,xn.c,[]),o.Ab(1073742336,xn.b,xn.b,[]),o.Ab(1073742336,kn.e,kn.e,[]),o.Ab(1073742336,Mn.a,Mn.a,[]),o.Ab(1073742336,Ln.d,Ln.d,[]),o.Ab(1073742336,Ln.c,Ln.c,[]),o.Ab(1073742336,Dn.a,Dn.a,[]),o.Ab(1073742336,jn.a,jn.a,[]),o.Ab(1073742336,wn.v,wn.v,[]),o.Ab(1073742336,wn.s,wn.s,[]),o.Ab(1073742336,yn.c,yn.c,[]),o.Ab(1073742336,Vn.a,Vn.a,[]),o.Ab(1073742336,En.c,En.c,[]),o.Ab(1073742336,Kn.a,Kn.a,[]),o.Ab(1073742336,Xn.a,Xn.a,[[2,yn.g],o.z]),o.Ab(1073742336,Tn.a,Tn.a,[]),o.Ab(1073742336,l,l,[]),o.Ab(1024,en.m,(function(){return[[{path:"",component:sn}]]}),[])])}))}}]);
//# sourceMappingURL=18-es5.js.map