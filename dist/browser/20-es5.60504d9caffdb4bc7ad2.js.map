{"version":3,"sources":["webpack:///src/app/modules/application/web-rtc/web-rtc.module.ts","webpack:///src/app/modules/application/web-rtc/video-channel/video-channel.component.ts","webpack:///src/app/modules/application/web-rtc/web-rtc-context/web-rtc-context.component.ts","webpack:///src/app/modules/application/web-rtc/video-channel/video-channel.component.ngfactory.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/video-channel/video-channel.component.css.shim.ngstyle.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/video-channel/video-channel.component.html","webpack:///src/app/modules/general/outer-toolbar/outer-toolbar.component.ts","webpack:///src/app/modules/general/outer-toolbar/outer-toolbar.component.ngfactory.js.pre-build-optimizer.js","webpack:///src/app/modules/general/outer-toolbar/outer-toolbar.component.css.shim.ngstyle.js.pre-build-optimizer.js","webpack:///src/app/modules/general/outer-toolbar/outer-toolbar.component.html","webpack:///src/app/modules/application/web-rtc/web-rtc-context/web-rtc-context.component.ngfactory.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/web-rtc-context/web-rtc-context.component.css.shim.ngstyle.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/web-rtc-context/web-rtc-context.component.html","webpack:///src/app/modules/application/web-rtc/web-rtc.component.ts","webpack:///src/app/modules/application/web-rtc/web-rtc.component.ts.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/web-rtc.component.ngfactory.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/web-rtc.component.css.shim.ngstyle.js.pre-build-optimizer.js","webpack:///src/app/modules/application/web-rtc/web-rtc.component.html","webpack:///src/app/modules/application/web-rtc/web-rtc-routing.module.ts","webpack:///src/app/modules/application/web-rtc/web-rtc.module.ngfactory.js.pre-build-optimizer.js"],"names":["WebRtcModule","VideoChannelComponent","appContext","webRtcService","statusColor","database","changeRef","streamRecorderService","webRtcContext","this","localBadge","toolbarVisibility","subscriptions","buttons","t","_this","videoContext","local","push","announcements","subscribe","length","filter","ann","active","dataChannel","data","message","type","settings","video","audio","sendVisualData","contact","value","next","checkConnectionState","state","statusText","detectChanges","forEach","sub","unsubscribe","stopRecording","inx","$event","stopImmediatePropagation","videoTrack","stream","getVideoTracks","enabled","audioTrack","getAudioTracks","stopVideoChannel","localVideoAudio","sendDataMessages","wid","appUser","uid","window","localStorage","getItem","changeMessage","messageUrl","Date","now","clearTimeout","setTimeout","handleView","videoElement","className","startRecodeStream","mediaRecorders","checkVideoContexts","recorderStream","mediaRecorder","stop","WebRtcContextComponent","platformId","localToolbar","context","videoCollection","find","view","closed","RenderType_VideoChannelComponent","core","ob","encapsulation","styles","View_VideoChannelComponent_3","_l","Lb","qb","_v","en","ad","component","onCloseView","typings_index_ngfactory","b","a","pb","esm2015_button","k","a11y","f","animations","icon_typings_index_ngfactory","icon","d","l","svgIcon","_ck","Cb","disabled","_animationMode","inline","color","View_VideoChannelComponent_2","badge","x","c","C","content","size","gb","common","N","K","ngIf","_co","fixed","overlap","isAbove","isAfter","hidden","_hasContent","View_VideoChannelComponent_4","View_VideoChannelComponent_1","toolbar_typings_index_ngfactory","toolbar","platform","Hb","_toolbarRows","contact_component_ngfactory","contact_component","h","app_context_service","database_service","z","Db","Kb","transform","View_VideoChannelComponent_5","index_ngfactory","progress_spinner","_noopAnimations","diameter","View_VideoChannelComponent_7","clickIcon","View_VideoChannelComponent_9","View_VideoChannelComponent_8","pulse","View_VideoChannelComponent_6","Gb","y","q","r","j","klass","ngClass","View_VideoChannelComponent_0","onMoveElementVideo","onLoadedData","onEnded","OuterToolbarComponent","_this3","RenderType_OuterToolbarComponent","View_OuterToolbarComponent_0","onOpenView","user","RenderType_WebRtcContextComponent","View_WebRtcContextComponent_1","web_rtc_service","status_colors_service","stream_recorder_service","$implicit","channelClass","View_WebRtcContextComponent_2","View_WebRtcContextComponent_0","ngForOf","web_rtc_component_WebRtcComponent","router","progress","offerChangedUrls","duplicateCall","JSON","parse","optimizeCall","micro","flexDirection","constraints","deviceId","echoCancellation","autoGainControl","noiseSuppression","events","pipe","Object","event","g","startConnections","_this4","url","getRef","off","webRtcConnectionContext","snap","desc","val","indexOf","setDescriptor","pcConnection","that","descriptor","cans","candidates","sendAnswerOffer","test","sendDescriptor","sendOffer","then","res","setOfferContactListener","setAnswerListener","optimize","setCandidates","candidate","catch","onError","newCandidates","cand","Classes","date","sender","descId","messId","orderByChild","equalTo","on","extra","actions","action","values","bind","once","handleDescriptor","id","tslib_es6","__awaiter","regeneratorRuntime","mark","_callee2","messageContacts","localIndex","_this7","wrap","_context2","prev","webRtcContexts","getContext","contextId","abrupt","t0","localStream","navigator","mediaDevices","getUserMedia","sent","concat","receivers","findIndex","contactIndex","initiator","webRtcConnections","BehaviorSubject","Subject","channel","SimplePeer","channelName","config","stunTurnConfig","stun","_debug","console","log","_channel","_callee","_context","dispatchDescriptor","_pc","addEventListener","target","iceGatheringState","setAnnouncement","text","statusColors","webrtc","perConnectionStates","connectionState","send","stringify","appChangeRef","markForCheck","err","setImplicitListener","deleteDesc","deleteDescriptor","signal","setDescriptorOptions","path","mess","_this8","_callee3","_context3","checkCandidates","_callee4","_context4","ref","Promise","rej","requestCandidates","popup","error","RenderType_WebRtcComponent","View_WebRtcComponent_1","mode","View_WebRtcComponent_3","View_WebRtcComponent_2","A","B","o","ngStyle","Eb","flex-direction","currVal_0","contexts","View_WebRtcComponent_0","WebRtcComponentNgFactory","mb","WebRtcRoutingModule","__webpack_require__","__webpack_exports__","WebRtcModuleNgFactory","nb","zb","Ab","Z","router_ngfactory","tooltip_typings_index_ngfactory","v","n","m","s","D","observers","overlay","i","e","p","bidi","esm2015_select","tooltip","platform_browser","esm2015_core","menu","autocomplete","fesm2015_forms","w","p0_0","p0_1","flex_layout_esm2015_core","card","form_field","portal","scrolling","text_field","input","progress_bar","esm2015_radio","tabs","button_toggle","slide_toggle","slider","material_module","flex","extended","grid","flex_layout","general_module"],"mappings":"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","file":"20-es5.60504d9caffdb4bc7ad2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WebRtcRoutingModule } from './web-rtc-routing.module';\nimport { WebRtcComponent } from './web-rtc.component';\nimport {MaterialModule} from \"../../material/material.module\";\nimport { VideoChannelComponent } from './video-channel/video-channel.component';\nimport { WebRtcContextComponent } from './web-rtc-context/web-rtc-context.component';\nimport {GeneralModule} from \"../../general/general.module\";\n\n\n@NgModule({\n  declarations: [\n      WebRtcComponent,\n      VideoChannelComponent,\n      WebRtcContextComponent,\n  ],\n  imports: [\n    CommonModule,\n    WebRtcRoutingModule,\n      MaterialModule,\n      GeneralModule,\n  ]\n})\nexport class WebRtcModule { }\n","import {ChangeDetectorRef, Component, Input, OnDestroy, OnInit} from '@angular/core';\nimport {VideoContext} from \"../../../../Classes/Classes\";\nimport {AppContextService} from \"../../../../services/app-context.service\";\nimport {WebRtcService} from \"../../../../services/web-rtc.service\";\nimport {StatusColorsService} from \"../../../../services/status-colors.service\";\nimport {WebRtcContextComponent} from \"../web-rtc-context/web-rtc-context.component\";\nimport {StreamRecorderService} from \"../../../../services/stream-recorder.service\";\nimport {DatabaseService} from \"../../../../services/database.service\";\n\n@Component({\n  selector: 'app-video-channel',\n  templateUrl: './video-channel.component.html',\n  styleUrls: ['./video-channel.component.css']\n})\nexport class VideoChannelComponent implements OnInit, OnDestroy {\n    \n    public localBadge = '';\n    public toolbarVisibility = false;\n    public subscriptions = [];\n    public buttons = [['video-off', 'video'], ['audio-off', 'audio']];\n    public t = undefined;\n    @Input() public videoContext : VideoContext;\n  constructor(\n      public appContext : AppContextService,\n      public webRtcService : WebRtcService,\n      public statusColor : StatusColorsService,\n      public database : DatabaseService,\n      public changeRef : ChangeDetectorRef,\n      public streamRecorderService : StreamRecorderService,\n      public webRtcContext : WebRtcContextComponent) {\n  }\n\n  ngOnInit() {\n      //Подписка на получение уведомлений и отображение их количества в бейждике\n      this.videoContext.local && this.subscriptions.push(this.appContext.announcements.subscribe(announcements => {\n          let length = announcements.filter(ann => ann.active).length;\n\t  this.localBadge = length == 0 ? '' : length + '' ;\n      })) ;\n      //Подписка на получение данных по каналу данных\n      this.subscriptions.push(this.videoContext.dataChannel.data.subscribe(message => {\n            //Прилетели данные по каналу данных\n\t  //message : {type : settings, video : number, audio : number}\n\t  //  {type : status, status : StatusColorsService}\n\t  //Получено удаленное сообщение о данных удаленного пользователя\n\t  if(message.type === \"settings\"){\n\t      //Изменились состояния видеоизображения или ацдио\n\t      'video' in message && (this.videoContext.settings.video = message.video);\n\t      'audio' in message && (this.videoContext.settings.audio = message.audio);\n\t      //Если включена настройка сохраниния видеоданных,\n\t      // то нужно это изменение сохранить для последующего воспроизведения\n\t      this.sendVisualData(message);\n\t  }else if(message.type === \"status\"){\n\t      let contact = this.videoContext.contact.value;\n\t      contact.statusColor = message.statusColor;\n\t      this.videoContext.contact.next(contact);\n\t      //если статус - один из статусов невозможности продолжения соединения\n\t      this.webRtcService.checkConnectionState({state : message.statusText, contact : contact, videoContext : this.videoContext});\n\t  }\n\t  this.changeRef.detectChanges();\n      }));\n  }\n   ngOnDestroy(): void {\n       this.subscriptions.forEach(sub => sub.unsubscribe());\n       //Остановка записи активного потока, если она производилась\n       this.stopRecording()  ;\n       \n   }\n    \n    clickIcon(inx, $event){\n      let message;\n      $event.stopImmediatePropagation();\n        switch (inx) { //Изменение видеорежима\n\t    case 0 :\n\t\tlet videoTrack = this.videoContext.stream.value.getVideoTracks()[0];\n\t\tvideoTrack && (videoTrack.enabled = !!(this.videoContext.settings.video = this.videoContext.settings.video == 0 ? 1 : 0));\n\t\tmessage = this.videoContext.settings ;\n\t\tbreak;    //Изменение аудиорежима\n\t    case 1 :\n\t\tlet audioTrack = this.videoContext.stream.value.getAudioTracks()[0];\n\t\taudioTrack && (audioTrack.enabled = !!(this.videoContext.settings.audio = this.videoContext.settings.audio == 0 ? 1 : 0));\n\t\tmessage = this.videoContext.settings ;\n\t\tbreak;\n\t    case 2 :\n\t\tthis.webRtcService.stopVideoChannel(this.videoContext);\n\t}\n\t//Отправить данные об изменении значений настроек всем удаленным каналам\n\tif(message) {\n\t    this.appContext.localVideoAudio = message;\n\t    this.webRtcService.sendDataMessages(this.videoContext.wid, this.appContext.appUser.uid, message) ;\n\t    //Сохраниние измениния статуса видео и аудио\n\t    this.sendVisualData(message);\n\t}\n    }\n    \n    sendVisualData(message){\n\tif(window.localStorage.getItem('callSave') === '1'){\n\t    this.database.changeMessage(this.videoContext.messageUrl + '/metadata/' + this.videoContext.contact.value.uid + '/visual', {[Date.now()] : {video : message.video, audio : message.audio}})\n\t}\n    }\n    \n    onMoveElementVideo($event){\n\t$event.stopImmediatePropagation();\n\t    this.toolbarVisibility = true;\n\t    this.t && clearTimeout(this.t);\n\t    this.t = setTimeout(()=>{\n\t\tthis.toolbarVisibility = false;\n\t\tclearTimeout(this.t);\n\t\tthis.t = undefined;\n\t\tthis.changeRef.detectChanges();\n\t    },5000)\n    }\n    \n    onCloseView($event){\n        this.webRtcContext.handleView(true);\n\t$event.stopImmediatePropagation();\n    }\n    \n    onLoadedData(videoElement){\n      //Делаем текущий контекст активным\n\tthis.videoContext.className.active = true;\n\tthis.videoContext.videoElement = videoElement ;\n\t//Старт записи активного потока, если установлены настройки сохранения вызова\n\twindow.localStorage.getItem('callSave') === '1' && this.streamRecorderService.startRecodeStream(\n\t    {uid : this.videoContext.contact.value.uid, wid : this.videoContext.wid,  mediaRecorders : this.webRtcContext.mediaRecorders, stream : this.videoContext.stream.value, local : this.videoContext.local, messageUrl : this.videoContext.messageUrl});\n\t//Если запущен не локальный видеоконтекст - установить классы локальному контексту, для принятия локальных размеров\n\tthis.videoContext.local || this.webRtcService.checkVideoContexts(this.videoContext);\n    }\n    \n    stopRecording(){\n\t//Остановка записи активного потока, если она производилась\n\tlet recorderStream = this.webRtcContext.mediaRecorders[this.videoContext.contact.value.uid];\n\tif(recorderStream){\n\t    recorderStream.mediaRecorder.stop();\n\t    delete this.webRtcContext.mediaRecorders[this.videoContext.contact.value.uid];\n\t}\n    }\n    \n    onEnded(){\n      //Делаем текущей контекст не активный\n\tthis.videoContext.className.active = false;\n\t//Проверяем количество активных контекстов\n\tthis.webRtcService.checkVideoContexts(this.videoContext);\n    }\n    \n}\n","import {Component, Inject, Input, OnInit, PLATFORM_ID} from '@angular/core';\nimport {WebRtcContext} from \"../../../../Classes/Classes\";\n\n@Component({\n  selector: 'app-web-rtc-context',\n  templateUrl: './web-rtc-context.component.html',\n  styleUrls: ['./web-rtc-context.component.css']\n})\nexport class WebRtcContextComponent implements OnInit {\n\n    public mediaRecorders = {};\n    public localToolbar = false;\n    @Input() public context : WebRtcContext;\n    \n    constructor(@Inject(PLATFORM_ID) private platformId: Object) { }\n\n  ngOnInit() {\n\n  }\n\n  handleView(type){\n       this.context.videoCollection.find(view => view.local).className.closed = this.localToolbar = type;\n  }\n  \n  \n}\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nimport * as i0 from \"./video-channel.component.css.shim.ngstyle\";\nimport * as i1 from \"@angular/core\";\nimport * as i2 from \"../../../../../../node_modules/@angular/material/button/typings/index.ngfactory\";\nimport * as i3 from \"@angular/material/button\";\nimport * as i4 from \"@angular/cdk/a11y\";\nimport * as i5 from \"@angular/platform-browser/animations\";\nimport * as i6 from \"../../../../../../node_modules/@angular/material/icon/typings/index.ngfactory\";\nimport * as i7 from \"@angular/material/icon\";\nimport * as i8 from \"@angular/material/badge\";\nimport * as i9 from \"@angular/common\";\nimport * as i10 from \"../../../../../../node_modules/@angular/material/toolbar/typings/index.ngfactory\";\nimport * as i11 from \"@angular/material/toolbar\";\nimport * as i12 from \"@angular/cdk/platform\";\nimport * as i13 from \"../../../general/contact/contact.component.ngfactory\";\nimport * as i14 from \"../../../general/contact/contact.component\";\nimport * as i15 from \"../../../../services/app-context.service\";\nimport * as i16 from \"../../../../services/database.service\";\nimport * as i17 from \"../../../../../../node_modules/@angular/material/progress-spinner/typings/index.ngfactory\";\nimport * as i18 from \"@angular/material/progress-spinner\";\nimport * as i19 from \"./video-channel.component\";\nimport * as i20 from \"../../../../services/web-rtc.service\";\nimport * as i21 from \"../../../../services/status-colors.service\";\nimport * as i22 from \"../../../../services/stream-recorder.service\";\nimport * as i23 from \"../web-rtc-context/web-rtc-context.component\";\nvar styles_VideoChannelComponent = [i0.styles];\nvar RenderType_VideoChannelComponent = i1.ɵcrt({ encapsulation: 0, styles: styles_VideoChannelComponent, data: {} });\nexport { RenderType_VideoChannelComponent as RenderType_VideoChannelComponent };\nfunction View_VideoChannelComponent_3(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 3, \"button\", [[\"class\", \"close-view\"], [\"mat-mini-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.onCloseView($event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i2.View_MatButton_0, i2.RenderType_MatButton)), i1.ɵdid(1, 180224, null, 0, i3.MatButton, [i1.ElementRef, i4.FocusMonitor, [2, i5.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(2, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"mat-icon notranslate\"], [\"role\", \"img\"], [\"svgIcon\", \"close-view\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(3, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null)], function (_ck, _v) { var currVal_4 = \"close-view\"; _ck(_v, 3, 0, currVal_4); }, function (_ck, _v) { var currVal_0 = (i1.ɵnov(_v, 1).disabled || null); var currVal_1 = (i1.ɵnov(_v, 1)._animationMode === \"NoopAnimations\"); _ck(_v, 0, 0, currVal_0, currVal_1); var currVal_2 = i1.ɵnov(_v, 3).inline; var currVal_3 = (((i1.ɵnov(_v, 3).color !== \"primary\") && (i1.ɵnov(_v, 3).color !== \"accent\")) && (i1.ɵnov(_v, 3).color !== \"warn\")); _ck(_v, 2, 0, currVal_2, currVal_3); }); }\nfunction View_VideoChannelComponent_2(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 5, null, null, null, null, null, null, null)), (_l()(), i1.ɵeld(1, 0, null, null, 2, \"mat-icon\", [[\"class\", \"mat-icon notranslate mat-badge\"], [\"matBadgeSize\", \"small\"], [\"role\", \"img\"], [\"svgIcon\", \"notifications\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null], [2, \"mat-badge-overlap\", null], [2, \"mat-badge-above\", null], [2, \"mat-badge-below\", null], [2, \"mat-badge-before\", null], [2, \"mat-badge-after\", null], [2, \"mat-badge-small\", null], [2, \"mat-badge-medium\", null], [2, \"mat-badge-large\", null], [2, \"mat-badge-hidden\", null], [2, \"mat-badge-disabled\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(2, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null), i1.ɵdid(3, 671744, null, 0, i8.MatBadge, [i1.NgZone, i1.ElementRef, i4.AriaDescriber, i1.Renderer2, [2, i5.ANIMATION_MODULE_TYPE]], { color: [0, \"color\"], content: [1, \"content\"], size: [2, \"size\"] }, null), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_VideoChannelComponent_3)), i1.ɵdid(5, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵand(0, null, null, 0))], function (_ck, _v) { var _co = _v.component; var currVal_12 = \"notifications\"; _ck(_v, 2, 0, currVal_12); var currVal_13 = \"accent\"; var currVal_14 = _co.localBadge; var currVal_15 = \"small\"; _ck(_v, 3, 0, currVal_13, currVal_14, currVal_15); var currVal_16 = _co.videoContext.className.fixed; _ck(_v, 5, 0, currVal_16); }, function (_ck, _v) { var currVal_0 = i1.ɵnov(_v, 2).inline; var currVal_1 = (((i1.ɵnov(_v, 2).color !== \"primary\") && (i1.ɵnov(_v, 2).color !== \"accent\")) && (i1.ɵnov(_v, 2).color !== \"warn\")); var currVal_2 = i1.ɵnov(_v, 3).overlap; var currVal_3 = i1.ɵnov(_v, 3).isAbove(); var currVal_4 = !i1.ɵnov(_v, 3).isAbove(); var currVal_5 = !i1.ɵnov(_v, 3).isAfter(); var currVal_6 = i1.ɵnov(_v, 3).isAfter(); var currVal_7 = (i1.ɵnov(_v, 3).size === \"small\"); var currVal_8 = (i1.ɵnov(_v, 3).size === \"medium\"); var currVal_9 = (i1.ɵnov(_v, 3).size === \"large\"); var currVal_10 = (i1.ɵnov(_v, 3).hidden || !i1.ɵnov(_v, 3)._hasContent); var currVal_11 = i1.ɵnov(_v, 3).disabled; _ck(_v, 1, 1, [currVal_0, currVal_1, currVal_2, currVal_3, currVal_4, currVal_5, currVal_6, currVal_7, currVal_8, currVal_9, currVal_10, currVal_11]); }); }\nfunction View_VideoChannelComponent_4(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 4, null, null, null, null, null, null, null)), (_l()(), i1.ɵeld(1, 0, null, null, 1, \"mat-icon\", [[\"class\", \"video-peer-img mat-icon notranslate\"], [\"role\", \"img\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(2, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null), (_l()(), i1.ɵeld(3, 0, null, null, 1, \"mat-icon\", [[\"class\", \"microphone-peer-img mat-icon notranslate\"], [\"role\", \"img\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(4, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_2 = _co.buttons[0][_co.videoContext.settings.video]; _ck(_v, 2, 0, currVal_2); var currVal_5 = _co.buttons[1][_co.videoContext.settings.audio]; _ck(_v, 4, 0, currVal_5); }, function (_ck, _v) { var currVal_0 = i1.ɵnov(_v, 2).inline; var currVal_1 = (((i1.ɵnov(_v, 2).color !== \"primary\") && (i1.ɵnov(_v, 2).color !== \"accent\")) && (i1.ɵnov(_v, 2).color !== \"warn\")); _ck(_v, 1, 0, currVal_0, currVal_1); var currVal_3 = i1.ɵnov(_v, 4).inline; var currVal_4 = (((i1.ɵnov(_v, 4).color !== \"primary\") && (i1.ɵnov(_v, 4).color !== \"accent\")) && (i1.ɵnov(_v, 4).color !== \"warn\")); _ck(_v, 3, 0, currVal_3, currVal_4); }); }\nfunction View_VideoChannelComponent_1(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 10, \"mat-toolbar\", [[\"class\", \"top-toolbar mat-toolbar\"]], [[2, \"mat-toolbar-multiple-rows\", null], [2, \"mat-toolbar-single-row\", null]], null, null, i10.View_MatToolbar_0, i10.RenderType_MatToolbar)), i1.ɵdid(1, 4243456, null, 1, i11.MatToolbar, [i1.ElementRef, i12.Platform, i9.DOCUMENT], null, null), i1.ɵqud(603979776, 1, { _toolbarRows: 1 }), (_l()(), i1.ɵeld(3, 0, null, 0, 2, \"app-contact\", [], null, null, null, i13.View_ContactComponent_0, i13.RenderType_ContactComponent)), i1.ɵdid(4, 114688, null, 0, i14.ContactComponent, [i1.ChangeDetectorRef, i15.AppContextService, i16.DatabaseService, i1.PLATFORM_ID], { context: [0, \"context\"] }, null), i1.ɵpid(131072, i9.AsyncPipe, [i1.ChangeDetectorRef]), (_l()(), i1.ɵeld(6, 0, null, 0, 0, \"div\", [[\"class\", \"example-spacer\"]], null, null, null, null, null)), (_l()(), i1.ɵand(16777216, null, 0, 1, null, View_VideoChannelComponent_2)), i1.ɵdid(8, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵand(16777216, null, 0, 1, null, View_VideoChannelComponent_4)), i1.ɵdid(10, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_2 = i1.ɵunv(_v, 4, 0, i1.ɵnov(_v, 5).transform(_co.videoContext.contact)); _ck(_v, 4, 0, currVal_2); var currVal_3 = _co.videoContext.local; _ck(_v, 8, 0, currVal_3); var currVal_4 = !_co.videoContext.local; _ck(_v, 10, 0, currVal_4); }, function (_ck, _v) { var currVal_0 = (i1.ɵnov(_v, 1)._toolbarRows.length > 0); var currVal_1 = (i1.ɵnov(_v, 1)._toolbarRows.length === 0); _ck(_v, 0, 0, currVal_0, currVal_1); }); }\nfunction View_VideoChannelComponent_5(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"mat-spinner\", [[\"class\", \"mat-spinner mat-progress-spinner\"], [\"mode\", \"indeterminate\"], [\"role\", \"progressbar\"]], [[2, \"_mat-animation-noopable\", null], [4, \"width\", \"px\"], [4, \"height\", \"px\"]], null, null, i17.View_MatSpinner_0, i17.RenderType_MatSpinner)), i1.ɵdid(1, 114688, null, 0, i18.MatSpinner, [i1.ElementRef, i12.Platform, [2, i9.DOCUMENT], [2, i5.ANIMATION_MODULE_TYPE], i18.MAT_PROGRESS_SPINNER_DEFAULT_OPTIONS], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, function (_ck, _v) { var currVal_0 = i1.ɵnov(_v, 1)._noopAnimations; var currVal_1 = i1.ɵnov(_v, 1).diameter; var currVal_2 = i1.ɵnov(_v, 1).diameter; _ck(_v, 0, 0, currVal_0, currVal_1, currVal_2); }); }\nfunction View_VideoChannelComponent_7(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 4, \"div\", [[\"class\", \"bottom-peer-block\"]], null, null, null, null, null)), (_l()(), i1.ɵeld(1, 0, null, null, 3, \"button\", [[\"class\", \"phone-hangup\"], [\"mat-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.clickIcon(2, $event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i2.View_MatButton_0, i2.RenderType_MatButton)), i1.ɵdid(2, 180224, null, 0, i3.MatButton, [i1.ElementRef, i4.FocusMonitor, [2, i5.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(3, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"mat-icon notranslate\"], [\"role\", \"img\"], [\"svgIcon\", \"phone-hangup\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(4, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null)], function (_ck, _v) { var currVal_4 = \"phone-hangup\"; _ck(_v, 4, 0, currVal_4); }, function (_ck, _v) { var currVal_0 = (i1.ɵnov(_v, 2).disabled || null); var currVal_1 = (i1.ɵnov(_v, 2)._animationMode === \"NoopAnimations\"); _ck(_v, 1, 0, currVal_0, currVal_1); var currVal_2 = i1.ɵnov(_v, 4).inline; var currVal_3 = (((i1.ɵnov(_v, 4).color !== \"primary\") && (i1.ɵnov(_v, 4).color !== \"accent\")) && (i1.ɵnov(_v, 4).color !== \"warn\")); _ck(_v, 3, 0, currVal_2, currVal_3); }); }\nfunction View_VideoChannelComponent_9(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 0, \"img\", [[\"class\", \"img-pulse\"], [\"src\", \"/assets/app-shell/Radio-1s-200px.svg\"]], null, null, null, null, null))], null, null); }\nfunction View_VideoChannelComponent_8(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 14, \"div\", [[\"class\", \"bottom-local-block\"]], null, null, null, null, null)), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_VideoChannelComponent_9)), i1.ɵdid(2, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵeld(3, 0, null, null, 3, \"button\", [[\"class\", \"bottom-peer-video\"], [\"mat-mini-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.clickIcon(0, $event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i2.View_MatButton_0, i2.RenderType_MatButton)), i1.ɵdid(4, 180224, null, 0, i3.MatButton, [i1.ElementRef, i4.FocusMonitor, [2, i5.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(5, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"video-img mat-icon notranslate\"], [\"role\", \"img\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(6, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null), (_l()(), i1.ɵeld(7, 0, null, null, 3, \"button\", [[\"class\", \"phone-hangup\"], [\"mat-mini-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.clickIcon(2, $event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i2.View_MatButton_0, i2.RenderType_MatButton)), i1.ɵdid(8, 180224, null, 0, i3.MatButton, [i1.ElementRef, i4.FocusMonitor, [2, i5.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(9, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"mat-icon notranslate\"], [\"role\", \"img\"], [\"svgIcon\", \"phone-hangup\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(10, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null), (_l()(), i1.ɵeld(11, 0, null, null, 3, \"button\", [[\"class\", \"bottom-peer-audio\"], [\"mat-mini-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.clickIcon(1, $event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i2.View_MatButton_0, i2.RenderType_MatButton)), i1.ɵdid(12, 180224, null, 0, i3.MatButton, [i1.ElementRef, i4.FocusMonitor, [2, i5.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(13, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"microphone-img mat-icon notranslate\"], [\"role\", \"img\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i6.View_MatIcon_0, i6.RenderType_MatIcon)), i1.ɵdid(14, 9158656, null, 0, i7.MatIcon, [i1.ElementRef, i7.MatIconRegistry, [8, null], [2, i7.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_0 = _co.videoContext.className.pulse; _ck(_v, 2, 0, currVal_0); var currVal_5 = _co.buttons[0][_co.videoContext.settings.video]; _ck(_v, 6, 0, currVal_5); var currVal_10 = \"phone-hangup\"; _ck(_v, 10, 0, currVal_10); var currVal_15 = _co.buttons[1][_co.videoContext.settings.audio]; _ck(_v, 14, 0, currVal_15); }, function (_ck, _v) { var currVal_1 = (i1.ɵnov(_v, 4).disabled || null); var currVal_2 = (i1.ɵnov(_v, 4)._animationMode === \"NoopAnimations\"); _ck(_v, 3, 0, currVal_1, currVal_2); var currVal_3 = i1.ɵnov(_v, 6).inline; var currVal_4 = (((i1.ɵnov(_v, 6).color !== \"primary\") && (i1.ɵnov(_v, 6).color !== \"accent\")) && (i1.ɵnov(_v, 6).color !== \"warn\")); _ck(_v, 5, 0, currVal_3, currVal_4); var currVal_6 = (i1.ɵnov(_v, 8).disabled || null); var currVal_7 = (i1.ɵnov(_v, 8)._animationMode === \"NoopAnimations\"); _ck(_v, 7, 0, currVal_6, currVal_7); var currVal_8 = i1.ɵnov(_v, 10).inline; var currVal_9 = (((i1.ɵnov(_v, 10).color !== \"primary\") && (i1.ɵnov(_v, 10).color !== \"accent\")) && (i1.ɵnov(_v, 10).color !== \"warn\")); _ck(_v, 9, 0, currVal_8, currVal_9); var currVal_11 = (i1.ɵnov(_v, 12).disabled || null); var currVal_12 = (i1.ɵnov(_v, 12)._animationMode === \"NoopAnimations\"); _ck(_v, 11, 0, currVal_11, currVal_12); var currVal_13 = i1.ɵnov(_v, 14).inline; var currVal_14 = (((i1.ɵnov(_v, 14).color !== \"primary\") && (i1.ɵnov(_v, 14).color !== \"accent\")) && (i1.ɵnov(_v, 14).color !== \"warn\")); _ck(_v, 13, 0, currVal_13, currVal_14); }); }\nfunction View_VideoChannelComponent_6(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 8, \"mat-toolbar\", [[\"class\", \"bottom-toolbar mat-toolbar\"]], [[2, \"mat-toolbar-multiple-rows\", null], [2, \"mat-toolbar-single-row\", null]], null, null, i10.View_MatToolbar_0, i10.RenderType_MatToolbar)), i1.ɵprd(512, null, i9.ɵNgClassImpl, i9.ɵNgClassR2Impl, [i1.IterableDiffers, i1.KeyValueDiffers, i1.ElementRef, i1.Renderer2]), i1.ɵdid(2, 278528, null, 0, i9.NgClass, [i9.ɵNgClassImpl], { klass: [0, \"klass\"], ngClass: [1, \"ngClass\"] }, null), i1.ɵdid(3, 4243456, null, 1, i11.MatToolbar, [i1.ElementRef, i12.Platform, i9.DOCUMENT], null, null), i1.ɵqud(603979776, 2, { _toolbarRows: 1 }), (_l()(), i1.ɵand(16777216, null, 0, 1, null, View_VideoChannelComponent_7)), i1.ɵdid(6, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵand(16777216, null, 0, 1, null, View_VideoChannelComponent_8)), i1.ɵdid(8, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_2 = \"bottom-toolbar\"; var currVal_3 = _co.videoContext.className; _ck(_v, 2, 0, currVal_2, currVal_3); var currVal_4 = !_co.videoContext.local; _ck(_v, 6, 0, currVal_4); var currVal_5 = _co.videoContext.local; _ck(_v, 8, 0, currVal_5); }, function (_ck, _v) { var currVal_0 = (i1.ɵnov(_v, 3)._toolbarRows.length > 0); var currVal_1 = (i1.ɵnov(_v, 3)._toolbarRows.length === 0); _ck(_v, 0, 0, currVal_0, currVal_1); }); }\nexport function View_VideoChannelComponent_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 13, \"div\", [[\"class\", \"video-container\"]], null, [[null, \"mousemove\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"mousemove\" === en)) {\n        var pd_0 = (_co.onMoveElementVideo($event) !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, null, null)), i1.ɵprd(512, null, i9.ɵNgClassImpl, i9.ɵNgClassR2Impl, [i1.IterableDiffers, i1.KeyValueDiffers, i1.ElementRef, i1.Renderer2]), i1.ɵdid(2, 278528, null, 0, i9.NgClass, [i9.ɵNgClassImpl], { klass: [0, \"klass\"], ngClass: [1, \"ngClass\"] }, null), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_VideoChannelComponent_1)), i1.ɵdid(4, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵeld(5, 0, null, null, 6, \"div\", [[\"class\", \"main-video-container\"]], null, null, null, null, null)), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_VideoChannelComponent_5)), i1.ɵdid(7, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵeld(8, 0, [[\"videoElement\", 1]], null, 3, \"video\", [[\"autoplay\", \"\"], [\"class\", \"video-element\"], [\"playsinline\", \"\"]], [[8, \"srcObject\", 0], [8, \"muted\", 0]], [[null, \"loadeddata\"], [null, \"ended\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"loadeddata\" === en)) {\n        var pd_0 = (_co.onLoadedData(i1.ɵnov(_v, 8)) !== false);\n        ad = (pd_0 && ad);\n    } if ((\"ended\" === en)) {\n        var pd_1 = (_co.onEnded() !== false);\n        ad = (pd_1 && ad);\n    } return ad; }, null, null)), i1.ɵprd(512, null, i9.ɵNgClassImpl, i9.ɵNgClassR2Impl, [i1.IterableDiffers, i1.KeyValueDiffers, i1.ElementRef, i1.Renderer2]), i1.ɵdid(10, 278528, null, 0, i9.NgClass, [i9.ɵNgClassImpl], { klass: [0, \"klass\"], ngClass: [1, \"ngClass\"] }, null), i1.ɵpid(131072, i9.AsyncPipe, [i1.ChangeDetectorRef]), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_VideoChannelComponent_6)), i1.ɵdid(13, 16384, null, 0, i9.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_0 = \"video-container\"; var currVal_1 = _co.videoContext.className; _ck(_v, 2, 0, currVal_0, currVal_1); var currVal_2 = _co.toolbarVisibility; _ck(_v, 4, 0, currVal_2); var currVal_3 = !_co.videoContext.className.active; _ck(_v, 7, 0, currVal_3); var currVal_6 = \"video-element\"; var currVal_7 = _co.videoContext.className; _ck(_v, 10, 0, currVal_6, currVal_7); var currVal_8 = _co.toolbarVisibility; _ck(_v, 13, 0, currVal_8); }, function (_ck, _v) { var _co = _v.component; var currVal_4 = i1.ɵunv(_v, 8, 0, i1.ɵnov(_v, 11).transform(_co.videoContext.stream)); var currVal_5 = _co.videoContext.local; _ck(_v, 8, 0, currVal_4, currVal_5); }); }\nexport function View_VideoChannelComponent_Host_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-video-channel\", [], null, null, null, View_VideoChannelComponent_0, RenderType_VideoChannelComponent)), i1.ɵdid(1, 245760, null, 0, i19.VideoChannelComponent, [i15.AppContextService, i20.WebRtcService, i21.StatusColorsService, i16.DatabaseService, i1.ChangeDetectorRef, i22.StreamRecorderService, i23.WebRtcContextComponent], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, null); }\nvar VideoChannelComponentNgFactory = i1.ɵccf(\"app-video-channel\", i19.VideoChannelComponent, View_VideoChannelComponent_Host_0, { videoContext: \"videoContext\" }, {}, []);\nexport { VideoChannelComponentNgFactory as VideoChannelComponentNgFactory };\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nvar styles = [\".video-container[_ngcontent-%COMP%]{position:relative;flex:1 1 0;height:100%;display:flex;justify-content:center;align-items:center;overflow:hidden}.main-video-container[_ngcontent-%COMP%]{top:0;position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}.top-toolbar[_ngcontent-%COMP%]{position:absolute;top:0;background:0 0;display:flex;align-items:center;justify-content:center;z-index:2}.bottom-local-block[_ngcontent-%COMP%]{width:160px;display:flex;justify-content:space-between;align-items:center}.bottom-peer-audio[_ngcontent-%COMP%], .bottom-peer-video[_ngcontent-%COMP%], .close-view[_ngcontent-%COMP%]{background-color:transparent!important}video.video-element[_ngcontent-%COMP%]{position:absolute;z-index:0;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:50% 50%;object-position:50% 50%;border:0 solid #cecece}.phone-hangup[_ngcontent-%COMP%]{background-color:#c60000!important}mat-icon[_ngcontent-%COMP%]{color:#fff!important}.bottom-toolbar.local[_ngcontent-%COMP%]{background:0 0;position:absolute;display:flex;justify-content:center;bottom:0}.bottom-toolbar.remote[_ngcontent-%COMP%]{position:absolute;background:0 0;display:flex;justify-content:center}.img-pulse[_ngcontent-%COMP%]{position:absolute;transform:scale(.9) rotate(-45deg);transform-origin:13px 88px;display:none}div.video-container.active.pulse[_ngcontent-%COMP%]   .img-pulse[_ngcontent-%COMP%]{display:initial}div.video-container.local.active[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;z-index:4;transition:.5s}div.video-container.local.active.fixed[_ngcontent-%COMP%]{bottom:0;left:0;width:200px;height:200px;top:unset}div.video-container.local.active.fixed.closed[_ngcontent-%COMP%]{width:0;height:0}\"];\nexport { styles as styles };\n","<div class=\"video-container\" [ngClass]=\"videoContext.className\"  (mousemove)=\"onMoveElementVideo($event)\">\n\t<mat-toolbar class=\"top-toolbar\" *ngIf=\"this.toolbarVisibility\">\n\t\t<app-contact [context]=\"videoContext.contact | async\"></app-contact>\n\t\t<div class=\"example-spacer\"></div>\n\t\t<ng-container *ngIf=\"videoContext.local\">\n\t\t\t<mat-icon svgIcon=\"notifications\" [matBadge]=\"this.localBadge\" [matBadgeColor]=\"'accent'\" matBadgeSize=\"small\"></mat-icon>\n\t\t\t<button mat-mini-fab class=\"close-view\" *ngIf=\"videoContext.className.fixed\" (click)=\"onCloseView($event)\" >\n\t\t\t\t<mat-icon svgIcon=\"close-view\" ></mat-icon>\n\t\t\t</button>\n\t\t</ng-container>\n\t\t<ng-container class=\"top-peer-block\" *ngIf=\"!videoContext.local\">\n\t\t\t<mat-icon  [svgIcon]=\"this.buttons[0][this.videoContext.settings.video]\" class=\"video-peer-img\" ></mat-icon>\n\t\t\t<mat-icon [svgIcon]=\"this.buttons[1][this.videoContext.settings.audio]\" class=\"microphone-peer-img\" ></mat-icon>\n\t\t</ng-container>\n\t</mat-toolbar>\n\t<div class=\"main-video-container\">\n\t\t<mat-spinner *ngIf=\"!this.videoContext.className.active\"></mat-spinner>\n\t\t<video #videoElement class=\"video-element\" (loadeddata)=\"onLoadedData(videoElement)\" [ngClass]=\"videoContext.className\" (ended)=\"onEnded()\" [srcObject]=\"videoContext.stream | async\"  autoplay playsinline [muted]=\"videoContext.local\"></video>\n\t</div>\n\t<mat-toolbar class=\"bottom-toolbar\" [ngClass]=\"videoContext.className\" *ngIf=\"this.toolbarVisibility\">\n\t\t<div class=\"bottom-peer-block\" *ngIf=\"!videoContext.local\">\n\t\t\t<button mat-fab class=\"phone-hangup\"  (click)=\"clickIcon(2, $event)\" >\n\t\t\t\t<mat-icon svgIcon=\"phone-hangup\"></mat-icon>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class=\"bottom-local-block\" *ngIf=\"videoContext.local\">\n\t\t\t<img *ngIf=\"videoContext.className.pulse\" class=\"img-pulse\" src=\"/assets/app-shell/Radio-1s-200px.svg\">\n\t\t\t<button mat-mini-fab class=\"bottom-peer-video\" (click)=\"clickIcon(0, $event)\">\n\t\t\t\t<mat-icon  [svgIcon]=\"this.buttons[0][this.videoContext.settings.video]\" class=\"video-img\" ></mat-icon>\n\t\t\t</button>\n\t\t\t<button mat-mini-fab class=\"phone-hangup\" (click)=\"clickIcon(2, $event)\">\n\t\t\t\t<mat-icon  svgIcon=\"phone-hangup\"></mat-icon>\n\t\t\t</button>\n\t\t\t<button mat-mini-fab class=\"bottom-peer-audio\" (click)=\"clickIcon(1, $event)\">\n\t\t\t\t<mat-icon [svgIcon]=\"this.buttons[1][this.videoContext.settings.audio]\" class=\"microphone-img\" ></mat-icon>\n\t\t\t</button>\n\t\t</div>\n\t</mat-toolbar>\n</div>\n","import {Component,  OnInit} from '@angular/core';\nimport {AppContextService} from \"../../../services/app-context.service\";\nimport {WebRtcContextComponent} from \"../../application/web-rtc/web-rtc-context/web-rtc-context.component\";\n\n@Component({\n  selector: 'app-outer-toolbar',\n  templateUrl: './outer-toolbar.component.html',\n  styleUrls: ['./outer-toolbar.component.css']\n})\nexport class OuterToolbarComponent implements OnInit {\n\n    public localBadge = '';\n    public subscriptions = [];\n  constructor(public appContext : AppContextService,\n\t      public webRtcContext : WebRtcContextComponent) { }\n\n  ngOnInit() {\n      \n      //Подписка на получение уведомлений и отображение их количества в бейждике\n     this.subscriptions.push(this.appContext.announcements.subscribe(announcements => {\n\t  let length = announcements.filter(ann => ann.active).length;\n\t  this.localBadge = length == 0 ? '' : length + '' ;\n      })) ;\n  }\n    onOpenView(){\n        this.webRtcContext.handleView(false);\n    }\n  \n}\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nimport * as i0 from \"./outer-toolbar.component.css.shim.ngstyle\";\nimport * as i1 from \"@angular/core\";\nimport * as i2 from \"../contact/contact.component.ngfactory\";\nimport * as i3 from \"../contact/contact.component\";\nimport * as i4 from \"../../../services/app-context.service\";\nimport * as i5 from \"../../../services/database.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../../../../../node_modules/@angular/material/button/typings/index.ngfactory\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/cdk/a11y\";\nimport * as i10 from \"@angular/platform-browser/animations\";\nimport * as i11 from \"../../../../../node_modules/@angular/material/icon/typings/index.ngfactory\";\nimport * as i12 from \"@angular/material/icon\";\nimport * as i13 from \"./outer-toolbar.component\";\nimport * as i14 from \"../../application/web-rtc/web-rtc-context/web-rtc-context.component\";\nvar styles_OuterToolbarComponent = [i0.styles];\nvar RenderType_OuterToolbarComponent = i1.ɵcrt({ encapsulation: 0, styles: styles_OuterToolbarComponent, data: {} });\nexport { RenderType_OuterToolbarComponent as RenderType_OuterToolbarComponent };\nexport function View_OuterToolbarComponent_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 9, \"div\", [[\"class\", \"outer-toolbar-block\"]], null, null, null, null, null)), (_l()(), i1.ɵeld(1, 0, null, null, 8, \"div\", [[\"class\", \"main-block\"]], null, null, null, null, null)), (_l()(), i1.ɵeld(2, 0, null, null, 2, \"app-contact\", [], null, null, null, i2.View_ContactComponent_0, i2.RenderType_ContactComponent)), i1.ɵdid(3, 114688, null, 0, i3.ContactComponent, [i1.ChangeDetectorRef, i4.AppContextService, i5.DatabaseService, i1.PLATFORM_ID], { context: [0, \"context\"] }, null), i1.ɵpid(131072, i6.AsyncPipe, [i1.ChangeDetectorRef]), (_l()(), i1.ɵeld(5, 0, null, null, 0, \"span\", [[\"class\", \"example-spacer\"]], null, null, null, null, null)), (_l()(), i1.ɵeld(6, 0, null, null, 3, \"button\", [[\"class\", \"close-view\"], [\"mat-mini-fab\", \"\"]], [[1, \"disabled\", 0], [2, \"_mat-animation-noopable\", null]], [[null, \"click\"]], function (_v, en, $event) { var ad = true; var _co = _v.component; if ((\"click\" === en)) {\n        var pd_0 = (_co.onOpenView() !== false);\n        ad = (pd_0 && ad);\n    } return ad; }, i7.View_MatButton_0, i7.RenderType_MatButton)), i1.ɵdid(7, 180224, null, 0, i8.MatButton, [i1.ElementRef, i9.FocusMonitor, [2, i10.ANIMATION_MODULE_TYPE]], null, null), (_l()(), i1.ɵeld(8, 0, null, 0, 1, \"mat-icon\", [[\"class\", \"mat-icon notranslate\"], [\"role\", \"img\"], [\"svgIcon\", \"close-view\"]], [[2, \"mat-icon-inline\", null], [2, \"mat-icon-no-color\", null]], null, null, i11.View_MatIcon_0, i11.RenderType_MatIcon)), i1.ɵdid(9, 9158656, null, 0, i12.MatIcon, [i1.ElementRef, i12.MatIconRegistry, [8, null], [2, i12.MAT_ICON_LOCATION], [2, i1.ErrorHandler]], { svgIcon: [0, \"svgIcon\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_0 = i1.ɵunv(_v, 3, 0, i1.ɵnov(_v, 4).transform(_co.appContext.user)); _ck(_v, 3, 0, currVal_0); var currVal_5 = \"close-view\"; _ck(_v, 9, 0, currVal_5); }, function (_ck, _v) { var currVal_1 = (i1.ɵnov(_v, 7).disabled || null); var currVal_2 = (i1.ɵnov(_v, 7)._animationMode === \"NoopAnimations\"); _ck(_v, 6, 0, currVal_1, currVal_2); var currVal_3 = i1.ɵnov(_v, 9).inline; var currVal_4 = (((i1.ɵnov(_v, 9).color !== \"primary\") && (i1.ɵnov(_v, 9).color !== \"accent\")) && (i1.ɵnov(_v, 9).color !== \"warn\")); _ck(_v, 8, 0, currVal_3, currVal_4); }); }\nexport function View_OuterToolbarComponent_Host_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-outer-toolbar\", [], null, null, null, View_OuterToolbarComponent_0, RenderType_OuterToolbarComponent)), i1.ɵdid(1, 114688, null, 0, i13.OuterToolbarComponent, [i4.AppContextService, i14.WebRtcContextComponent], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, null); }\nvar OuterToolbarComponentNgFactory = i1.ɵccf(\"app-outer-toolbar\", i13.OuterToolbarComponent, View_OuterToolbarComponent_Host_0, {}, {}, []);\nexport { OuterToolbarComponentNgFactory as OuterToolbarComponentNgFactory };\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nvar styles = [\"[_nghost-%COMP%]{position:absolute;z-index:8;left:10px;bottom:10px}.main-block[_ngcontent-%COMP%]{width:80px;display:flex;justify-content:center;align-items:center}button[_ngcontent-%COMP%]{background-color:transparent!important;color:#fff!important}\"];\nexport { styles as styles };\n","<div class=\"outer-toolbar-block\">\n\t<div class=\"main-block\">\n\t\t<app-contact [context]=\"this.appContext.user | async\"></app-contact>\n\t\t<span class=\"example-spacer\"></span>\n\t\t<button mat-mini-fab class=\"close-view\"  (click)=\"onOpenView()\" >\n\t\t\t<mat-icon svgIcon=\"close-view\" ></mat-icon>\n\t\t</button>\n\t</div>\n<!--\t<mat-icon svgIcon=\"notifications\" [matBadge]=\"this.localBadge\" [matBadgeColor]=\"'accent'\" matBadgeSize=\"small\"></mat-icon>-->\n\n</div>\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nimport * as i0 from \"./web-rtc-context.component.css.shim.ngstyle\";\nimport * as i1 from \"@angular/core\";\nimport * as i2 from \"../video-channel/video-channel.component.ngfactory\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../video-channel/video-channel.component\";\nimport * as i5 from \"../../../../services/app-context.service\";\nimport * as i6 from \"../../../../services/web-rtc.service\";\nimport * as i7 from \"../../../../services/status-colors.service\";\nimport * as i8 from \"../../../../services/database.service\";\nimport * as i9 from \"../../../../services/stream-recorder.service\";\nimport * as i10 from \"./web-rtc-context.component\";\nimport * as i11 from \"../../../general/outer-toolbar/outer-toolbar.component.ngfactory\";\nimport * as i12 from \"../../../general/outer-toolbar/outer-toolbar.component\";\nvar styles_WebRtcContextComponent = [i0.styles];\nvar RenderType_WebRtcContextComponent = i1.ɵcrt({ encapsulation: 0, styles: styles_WebRtcContextComponent, data: {} });\nexport { RenderType_WebRtcContextComponent as RenderType_WebRtcContextComponent };\nfunction View_WebRtcContextComponent_1(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 3, \"app-video-channel\", [], null, null, null, i2.View_VideoChannelComponent_0, i2.RenderType_VideoChannelComponent)), i1.ɵprd(512, null, i3.ɵNgClassImpl, i3.ɵNgClassR2Impl, [i1.IterableDiffers, i1.KeyValueDiffers, i1.ElementRef, i1.Renderer2]), i1.ɵdid(2, 278528, null, 0, i3.NgClass, [i3.ɵNgClassImpl], { ngClass: [0, \"ngClass\"] }, null), i1.ɵdid(3, 245760, null, 0, i4.VideoChannelComponent, [i5.AppContextService, i6.WebRtcService, i7.StatusColorsService, i8.DatabaseService, i1.ChangeDetectorRef, i9.StreamRecorderService, i10.WebRtcContextComponent], { videoContext: [0, \"videoContext\"] }, null)], function (_ck, _v) { var currVal_0 = _v.context.$implicit.channelClass; _ck(_v, 2, 0, currVal_0); var currVal_1 = _v.context.$implicit; _ck(_v, 3, 0, currVal_1); }, null); }\nfunction View_WebRtcContextComponent_2(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-outer-toolbar\", [], null, null, null, i11.View_OuterToolbarComponent_0, i11.RenderType_OuterToolbarComponent)), i1.ɵdid(1, 114688, null, 0, i12.OuterToolbarComponent, [i5.AppContextService, i10.WebRtcContextComponent], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, null); }\nexport function View_WebRtcContextComponent_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 2, \"div\", [[\"class\", \"web-rtc-context-container\"]], null, null, null, null, null)), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_WebRtcContextComponent_1)), i1.ɵdid(2, 278528, null, 0, i3.NgForOf, [i1.ViewContainerRef, i1.TemplateRef, i1.IterableDiffers], { ngForOf: [0, \"ngForOf\"] }, null), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_WebRtcContextComponent_2)), i1.ɵdid(4, 16384, null, 0, i3.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_0 = _co.context.videoCollection; _ck(_v, 2, 0, currVal_0); var currVal_1 = _co.localToolbar; _ck(_v, 4, 0, currVal_1); }, null); }\nexport function View_WebRtcContextComponent_Host_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-web-rtc-context\", [], null, null, null, View_WebRtcContextComponent_0, RenderType_WebRtcContextComponent)), i1.ɵdid(1, 114688, null, 0, i10.WebRtcContextComponent, [i1.PLATFORM_ID], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, null); }\nvar WebRtcContextComponentNgFactory = i1.ɵccf(\"app-web-rtc-context\", i10.WebRtcContextComponent, View_WebRtcContextComponent_Host_0, { context: \"context\" }, {}, []);\nexport { WebRtcContextComponentNgFactory as WebRtcContextComponentNgFactory };\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nvar styles = [\".web-rtc-context-container[_ngcontent-%COMP%]{height:100%;display:flex;justify-content:stretch;align-items:stretch}app-video-channel[_ngcontent-%COMP%]{flex:1 1 0}app-video-channel.local[_ngcontent-%COMP%]{flex:0 0 0}@media (orientation:landscape){.web-rtc-context-container[_ngcontent-%COMP%]{flex-direction:row}}@media (orientation:portrait){.web-rtc-context-container[_ngcontent-%COMP%]{flex-direction:column}}\"];\nexport { styles as styles };\n","<div class=\"web-rtc-context-container\">\n\t<app-video-channel *ngFor=\"let video of context.videoCollection\" [ngClass]=\"video.channelClass\" [videoContext]=\"video\"></app-video-channel>\n</div>\n<app-outer-toolbar *ngIf=\"localToolbar\"></app-outer-toolbar>\n","import {AfterViewInit, Component, OnDestroy, OnInit} from '@angular/core';\nimport {AppContextService} from \"../../../services/app-context.service\";\nimport {NavigationStart, Router, RouterEvent} from \"@angular/router\";\nimport {filter} from \"rxjs/operators\";\nimport {Answer, Candidate, Offer, VideoContext, WebRtcConnectionContext} from \"../../../Classes/Classes\";\nimport {BehaviorSubject, Subject} from \"rxjs\";\nimport {WebRtcService} from \"../../../services/web-rtc.service\";\nimport {DatabaseService} from \"../../../services/database.service\";\nimport {StatusColorsService} from \"../../../services/status-colors.service\";\ndeclare var SimplePeer: import('simple-peer').SimplePeer;\n\n@Component({\n  selector: 'app-web-rtc',\n  templateUrl: './web-rtc.component.html',\n  styleUrls: ['./web-rtc.component.css']\n})\nexport class WebRtcComponent implements OnInit, OnDestroy, AfterViewInit {\n    \n    public progress = true;\n    public subscriptions = [];\n    //Адреса пиров, которым посылаем явные предложения, для того, что бы при завершении вызова снять обработчики событий\n    public offerChangedUrls = [];\n    //Получение настроек\n    public duplicateCall = JSON.parse(window.localStorage.getItem('duplicateCall'));\n    public optimizeCall =  JSON.parse(window.localStorage.getItem('optimizeCall'));\n    public video = JSON.parse(window.localStorage.getItem('videoinput'));\n    public micro = JSON.parse(window.localStorage.getItem('audioinput'));\n    public audio = JSON.parse(window.localStorage.getItem('audiooutput'));\n    public flexDirection = 'column';\n    //Установка ограничений\n    public constraints = {\n\taudio: {deviceId: (this.audio && this.audio.deviceId ? this.audio.deviceId : false) , echoCancellation : true, autoGainControl : true, noiseSuppression: true},\n\tvideo: {deviceId: (this.video && this.video.deviceId  ? this.video.deviceId : false)}\n    };\n\n  constructor(\n      public router : Router,\n      public webRtcService : WebRtcService,\n      public appContext : AppContextService,\n      public database : DatabaseService,\n      public statusColor : StatusColorsService,\n      ) { }\n\n  ngOnInit() {\n      //Подписка на события запуска нового маршрута для определения повторного запуска\n      //компонента и создания компонента контекста\n      this.router.events.pipe(filter((event: RouterEvent) => event instanceof NavigationStart)).subscribe((event) => {\n\t  //анализирование  event.url\n      });\n      this.startConnections();\n  }\n  \n  ngAfterViewInit(): void {\n      this.progress = false;\n  }\n    \n    ngOnDestroy(): void {\n      this.subscriptions.forEach(sub => sub.unsubscribe());\n      this.offerChangedUrls.forEach(url => this.database.getRef(url).off());\n  }\n    \n    //Обработчик ответов и неявных предложений\n  handleDescriptor(webRtcConnectionContext, snap){\n      let desc = snap.val();\n      desc.type.indexOf('answers') > -1 && this.setDescriptor(webRtcConnectionContext.pcConnection, desc);\n      desc.type.indexOf('offers') > -1 && this.startConnections(desc);\n  }\n\n  dispatchDescriptor(webRtcConnectionContext){\n      let that = this,\n\t  desc = webRtcConnectionContext.descriptor,\n\t  cans = webRtcConnectionContext.candidates;\n      if(desc.optimize && cans.length){\n\t  desc.candidates = this.setCandidates(desc, cans);\n\t  sendAnswerOffer(desc);\n      }else if(!desc.optimize){\n\t  sendAnswerOffer(desc);\n\t  if(cans.length){\n\t      this.setCandidates(desc, cans).forEach(candidate => {\n\t\t  this.database.sendDescriptor(candidate).catch(this.onError)\n\t      })\n\t  }\n      }\n     function sendAnswerOffer(desc){\n\t \n          if(/answers|offers\\/implicit/.test(desc.type)){\n\t     that.database.sendDescriptor(desc);\n\t }else {\n\t     that.webRtcService.sendOffer(webRtcConnectionContext).then(res => {\n\t\t //Установка обработчиков изменение статуса приема предложения.\n\t\t //Если статус приема предложения изменился, значит удаленный пир с ним контактировал различным образом\n\t\t //(принял/отклонил/пропустил). Это обработчик нам сигнализирует об этом, что поможет в определении нетронутых\n\t\t //предложений при отказе инициатора от вызова, в момент, когда удаленный пир еще не поднял трубку.\n\t\t // Обработчик срабатывает при контакте удаленного пира с предложением, что не требует проверки этого явно.\n\t\t //Результат проверяется сразу при необходимости.\n\t\t that.setOfferContactListener(webRtcConnectionContext);\n\t     });\n\t }\n\t \n          if(desc.type.indexOf('offers') > -1){\n              //Установка обработчиков получения ответов\n\t     that.setAnswerListener(webRtcConnectionContext);\n\t }\n     }\n  }\n  \n    setCandidates(descriptor, candidates){\n         let newCandidates = [];\n         candidates.forEach(cand => {\n\t     newCandidates.push( new Candidate({\n\t\t wid : descriptor.wid,\n\t\t contact : descriptor.contact,\n\t\t date : Date.now(),\n\t\t sender : this.appContext.user.value,\n\t\t descId : descriptor.messId,\n\t\t type: 'candidates',\n\t\t desc: cand,\n\t\t active : true,\n\t\t optimize : descriptor.optimize,\n\t\t uid : descriptor.uid,\n\t     }));\n\t }) ;\n\treturn newCandidates;\n    }\n    \n    setOfferContactListener(webRtcConnectionContext){\n        let url = '/web-rtc/offers/explicit/'+ webRtcConnectionContext.uid;\n        this.offerChangedUrls.push(url);\n\tthis.database.getRef(url).orderByChild('messId').equalTo(webRtcConnectionContext.descriptor.messId).on('value', function(webRtcConnectionContext, snap){\n\t    let val = snap.val();\n\t    val && (webRtcConnectionContext.webRtcContext.extra['actions'] = {[webRtcConnectionContext.uid] : {action : (Object.values(val)[0] as Offer).action , url : url + '/' + webRtcConnectionContext.descriptor.messId}});\n\t}.bind(this, webRtcConnectionContext));\n    }\n    \n    setAnswerListener(webRtcConnectionContext){\n\tthis.database.getRef('/web-rtc/answers/'+ this.appContext.appUser.uid).orderByChild(\"descId\").equalTo(webRtcConnectionContext.descriptor.messId).once('child_added', this.handleDescriptor.bind(this, webRtcConnectionContext));\n    }\n    \n    setImplicitListener(id){\n\tthis.database.getRef('/web-rtc/offers/implicit/'+ this.appContext.appUser.uid).orderByChild(\"descId\").equalTo(id).once('child_added', this.handleDescriptor.bind(this, id));\n    }\n    \n  async startConnections(desc?){\n    \n      let webRtcContext = this.appContext.webRtcContexts.getContext(this.appContext.contextId);\n      if(!webRtcContext) return ;\n      webRtcContext.localStream || (webRtcContext.localStream = await navigator.mediaDevices.getUserMedia(this.constraints));\n      let sender = desc ? desc.sender : webRtcContext.sender,\n\t  receivers = webRtcContext.receivers.value,\n\t  messageContacts = desc ? [sender] : [sender].concat(receivers);\n      if(messageContacts){\n\t  //Находим индекс локального пользователя\n\t  let localIndex = messageContacts.findIndex(contact => contact.uid === this.appContext.user.value.uid);\n\t  //Запуск всех потоков для каждого контакта\n\t  messageContacts.forEach((contact, contactIndex)=> {\n\t      let webRtcConnectionContext : WebRtcConnectionContext ,\n\t\t  local = this.appContext.appUser.uid === contact.uid,\n\t\t  initiator = desc ? false : ((webRtcContext.uid === this.appContext.appUser.uid ) || localIndex < contactIndex);\n\t      if(localIndex <= contactIndex || (!initiator && contactIndex == 0)) {\n\t\t  webRtcConnectionContext = webRtcContext.webRtcConnections[contact.uid] = new WebRtcConnectionContext({uid: contact.uid});\n\t\t  webRtcConnectionContext.webRtcContext = webRtcContext;\n\t\t  webRtcConnectionContext.uid = contact.uid;\n\t\t  //Видеоконтекст для каждого контакта\n\t\t  webRtcConnectionContext.videoContext = new VideoContext({\n\t\t      wid: webRtcContext.wid,\n\t\t      contact: new BehaviorSubject(local ? this.appContext.appUser : contact),\n\t\t      channelClass : local ? 'local' : \"remote\",\n\t\t      messageUrl : webRtcContext.desc.messageUrl,\n\t\t      className: local ? {\n\t\t\t  [contact.uid + ' local video-context']: true,\n\t\t\t  active: false,\n\t\t\t  fixed: false,\n\t\t\t  closed : false,\n\t\t\t  pulse: initiator\n\t\t      } : {[contact.uid + ' remote video-context']: true, active: false},\n\t\t      stream: new BehaviorSubject(local ? webRtcContext.localStream : undefined),\n\t\t      local: local,\n\t\t      settings: {type: 'settings', video: 1, audio: 1},\n\t\t      dataChannel: {data: new Subject(), channel: undefined},\n\t\t  });\n\t\t  local && webRtcContext.videoCollection.push(webRtcConnectionContext.videoContext);\n\t      }\n\t  //Если выполняется не локальный пользователь или индекс локального пользователя меньше индекса текущего\n\t      if(localIndex < contactIndex || (!initiator && contactIndex == 0)) {\n\t      //Запуск соединения\n\t\t    webRtcConnectionContext.pcConnection = new SimplePeer({\n\t\t      //контакт имеет индекс больше индекса локального пользователя в коллекции контактов или обрабатывается инициатор вызова, тогда ставиться признак инициатора для генерирования предложения\n\t\t      initiator : initiator,\n\t\t      channelName : contact.uid,\n\t\t      //Если соединение формируется для явного предложения, тогда свойство берется из настроек, иначе - из явного предложения\n\t\t      config : this.appContext.stunTurnConfig[ initiator ? window.localStorage.getItem('stunTurn') : webRtcContext.desc.stun ],\n\t\t      stream : webRtcContext.localStream,\n\t\t  });\n\t\t    webRtcConnectionContext.pcConnection._debug = console.log ;\n\t\t  //Установка ссылки на функцию отправки сообщений, чтобы контекст мог их отправлять, если пользователь инициатор сообщения\n\t\t  //Неинициатор устанавливает свой канал связи в событии connect()\n\t\t    initiator && (webRtcConnectionContext.videoContext.dataChannel.channel = webRtcConnectionContext.pcConnection._channel);\n\t\t  //Вызывается при генерации предложений, ответов, кандидатов\n\t\t    webRtcConnectionContext.pcConnection.on('signal', async (data)=> {\n\t\t      //Проанализировать настройку оптимизации соединения,\n\t\t      //предложение или ответ ждет формирование кандидатов и отправляются на сервер в одной упаковке\n\t\t      if(data.type){\n\t\t\t  if(data.type === 'offer') {\n\t\t\t      webRtcConnectionContext.descriptor = new Offer({\n\t\t\t\t  type: (webRtcContext.uid === this.appContext.appUser.uid ? 'offers/explicit' : 'offers/implicit'),\n\t\t\t\t  action: 'offered',\n\t\t\t\t  contact: contact,\n\t\t\t\t  uid: this.appContext.appUser.uid,\n\t\t\t\t  wid: webRtcContext.wid,\n\t\t\t\t  messageUrl : (webRtcContext.uid === this.appContext.appUser.uid ? '/messages/'+ contact.uid +'/'+ webRtcContext.wid : ''),\n\t\t\t\t  receivers: initiator ? webRtcContext.receivers.value : [contact],\n\t\t\t\t  sender: this.appContext.appUser,\n\t\t\t\t  stun: initiator ? window.localStorage.getItem('stunTurn') : webRtcContext.desc.stun,\n\t\t\t\t  desc: data,\n\t\t\t\t  descId : webRtcContext.wid + this.appContext.appUser.uid,\n\t\t\t\t  optimize: initiator ? JSON.parse(window.localStorage.getItem('optimizeCall')) : webRtcContext.desc.optimize,\n\t\t\t\t  candidates : JSON.parse(window.localStorage.getItem('optimizeCall')) ? []: false,\n\t\t\t      }) ;\n\t\t\t  }\n\t\t\t  else if(data.type === 'answer'){\n\t\t\t\n\t\t\t      webRtcConnectionContext.descriptor = new Answer({\n\t\t\t\t  type : 'answers',\n\t\t\t\t  active : true,\n\t\t\t\t  contact : contact,\n\t\t\t\t  uid :  webRtcContext.desc.uid,\n\t\t\t\t  descId : desc ? desc.messId : webRtcContext.desc.messId,\n\t\t\t\t  wid : webRtcContext.wid,\n\t\t\t\t  receivers : [ desc ? desc.sender : webRtcContext.sender],\n\t\t\t\t  sender : this.appContext.appUser,\n\t\t\t\t  desc : data,\n\t\t\t\t  optimize :  webRtcContext.desc.optimize,\n\t\t\t\t  candidates : webRtcContext.desc.optimize ? []: false,\n\t\t\t      });\n\t\t\t  }\n\t\t      //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n\t\t      this.dispatchDescriptor(webRtcConnectionContext);\n\t\t      \n\t\t      }else if(data.candidate){\n\t\t\t  //Сборка кандидатов\n\t\t\t  let descriptor = webRtcConnectionContext.descriptor;\n\t\t\t  //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n\t\t\t   if(descriptor){\n\t\t\t      let candidate = new Candidate({\n\t\t\t\t   wid : descriptor.wid,\n\t\t\t\t   contact :  contact ,\n\t\t\t\t   date : Date.now(),\n\t\t\t\t   sender : this.appContext.user.value,\n\t\t\t\t   descId : descriptor.messId,\n\t\t\t\t   type: 'candidates',\n\t\t\t\t   desc: data.candidate,\n\t\t\t\t   active : true,\n\t\t\t\t   optimize : descriptor.optimize,\n\t\t\t\t   uid : descriptor.uid,\n\t\t\t       });\n\t\t\t       //Проверка на опитимизацию соединения\n\t\t\t       if(descriptor.optimize) descriptor.candidates.push(candidate) ;\n\t\t\t       else this.database.sendDescriptor(candidate).catch(this.onError);\n\t\t\t   }else{\n\t\t\t       webRtcConnectionContext.candidates.push(data.candidate) ;\n\t\t\t   }\n\t\t      }\n\t\t  });\n\t\t  //Установка обработчика на изменения статуса сборки кандидатов\n\t\t  webRtcConnectionContext.pcConnection._pc.addEventListener('icegatheringstatechange', (event: any)=>{\n\t\t      //Завершилась сборка кандидатов\n\t\t      if(event.target.iceGatheringState === 'complete'){\n\t\t\t  //Сборка завершена\n\t\t\t  let desc : Offer | Answer =  webRtcConnectionContext.descriptor;\n\t\t\t  //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n\t\t\t  if(desc && desc.optimize){\n\t\t\t      if(desc.candidates.length){\n\t\t\t\t  //Отправка дескриптора (offer/answer) на сервер\n\t\t\t\t  /answers|offers\\/implicit/.test(desc.type) && this.database.sendDescriptor(desc).then(()=> {\n\t\t\t\t      console.log('Сборка кандидатов завершена. Кандидаты отправлены.') ;\n\t\t\t\t  }).catch(this.onError);\n\t\t\t\t  //Отправка явного дескриптора\n\t\t\t\t  /offers\\/explicit/.test(desc.type) && this.webRtcService.sendOffer(webRtcConnectionContext);\n\t\t\t\t  //Установка обработчика приема ответа, если отправлен дескриптор предложения\n\t\t\t\t  desc.type.indexOf('offers') > -1 && this.setAnswerListener(webRtcConnectionContext);\n\t\t\t      }else{\n\t\t\t\t  this.onError('Сбой отправки кандидатов в событии icegatheringstatechange.');\n\t\t\t\t  //TODO определить отображение сбоев несовместимости браузеров пользователю.\n\t\t\t\t  this.setAnnouncement({type : 'incompatibilityFailure'  , desc : {text : 'Сбой несовместимости.'}});\n\t\t\t      }\n\t\t\t  }else if(!desc){\n\t\t\t  \n\t\t\t  }\n\t\t      }\n\t\t  }) ;\n\t\t  //Установка обработчика на изменение статуса соединения для установки пользовательской индикации\n\t\t  webRtcConnectionContext.pcConnection._pc.addEventListener('connectionstatechange', (event: any)=>{\n\t\t      let contact = webRtcConnectionContext.videoContext.contact.value;\n\t\t      contact.statusColor = this.statusColor.statusColors.webrtc.perConnectionStates[event.target.connectionState];\n\t\t      webRtcConnectionContext.videoContext.contact.next(contact);\n\t\t  }) ;\n\t\t  //обработчик установки готовности соединения передачи данных по каналу данных\n\t\t  webRtcConnectionContext.pcConnection.on('connect', () => {\n\t\t      initiator || (webRtcConnectionContext.videoContext.dataChannel.channel = webRtcConnectionContext.pcConnection._channel) ;\n\t\t      //Передать информацию о включенных аппаратных средствах\n\t\t      webRtcConnectionContext.pcConnection.send(JSON.stringify(this.appContext.localVideoAudio));\n\t\t  });\n\t\t  //Обработчик получения данных по канаду данных\n\t\t  webRtcConnectionContext.pcConnection.on('data', (data : any) => {\n\t\t      //Обработка данных активности , закрытие соединения и пр. удаленного пира\n\t\t      webRtcConnectionContext.videoContext.dataChannel.data.next(JSON.parse(data));\n\t\t  });\n\t\t  //Обработка получения удаленного потока\n\t\t  webRtcConnectionContext.pcConnection.on('stream', stream => {\n\t\t      webRtcConnectionContext.videoContext.stream.next(stream);\n\t\t      //добавление видеоконтекста в коллекцию видеоконтекстов\n\t\t      webRtcContext.videoCollection.push(webRtcConnectionContext.videoContext);\n\t\t      //обновление интерфейса\n\t\t      this.appContext.appChangeRef.markForCheck();\n\t\t  });\n\t\t  //Закрыто текущее соединение\n\t\t  webRtcConnectionContext.pcConnection.on('close', (event) => {}) ;\n\t\t  //Ошибка в соединениии\n\t\t  webRtcConnectionContext.pcConnection.on('error', (err) => {\n\t\t      this.onError(err);\n\t\t      return true;\n\t\t  });\n\t\t  //Установка удаленного дескриптора - явного предложения\n\t\t  if(!initiator && contactIndex === 0){\n\t\t      let d = desc || webRtcContext.desc ;\n\t\t      this.setDescriptor(webRtcConnectionContext.pcConnection, d);\n\t\t  }\n\t      }else if(localIndex > contactIndex){\n\t\t  this.setImplicitListener(webRtcContext.wid + contact.uid);\n\t      }\n\t  })\n      }\n      this.appContext.appChangeRef.markForCheck();\n  }\n  \n    setDescriptor(pcConnection, desc){\n      let that = this;\n      //Установить предложение / ответ\n      pcConnection.signal(desc.desc);\n      if(/answers/.test(desc.type)){\n\t  //Удаление принятого ответа из базы после его получения\n\t  deleteDesc(desc);\n      }else{\n          //Снятие признака активности принятого предложения\n\t  this.database.setDescriptorOptions({descriptor: desc, data : {active: false, action: 'accepted'}}).then(res =>{\n\t      //Удаление из базы принятого дескриптора. Такой подход нужен для того, чтобы первая запись меняла статус действия и снимала активность, для согласования внутренних отслеживаний принятий удаленных дескрипторов. Вторая фаза - это удаление уже помеченного дескриптора.\n\t      deleteDesc(desc);\n\t  }).catch(err => this.onError(err));\n\t  //Если принимается явное предложение, создаем сообщение в области входящих сообщений\n\t  if(desc.type === 'offers/explicit'){\n\t      //Изменение входящего сообщения\n\t      [  //Изменение сообщения, предназначенного для текущего пользователя\n\t\t  {path : '/messages/'+ this.appContext.appUser.uid +'/'+ desc.wid + '/actions' , data : {[desc.contact.uid] : 'accepted'}},\n\t\t  //Изменение сообщения инициализатора\n\t\t  {path : '/messages/'+ desc.sender.uid +'/'+ desc.wid + '/actions' , data : {[desc.contact.uid] : 'accepted'}}\n\t          ].forEach(mess => {\n\t      //Пользователь  принял предложение - записываем это в область исходящих сообщений\n\t      this.database.changeMessage(mess.path, mess.data);\n\t      })\n\t  }\n      }\n      \n      (async ()=> {\n\t  //Проверить кандидаты\n\t  //todo Обязательно! В этом месте, т.е. после установления удаленного дескриптора, и после\n\t  // установки локального потока, нужно установить СИНХРОННО удаленные кандидаты\n\t  //Установка/проверка кандидатов\n\t  await this.checkCandidates(desc, pcConnection);\n      })();\n      \n      function deleteDesc(desc){\n\t  that.database.deleteDescriptor({descriptor : desc}).then(()=>{}).catch(err =>  that.onError(err));\n      }\n  }\n  \n  //Запос кандидатов с сервера\n    async requestCandidates(desc){\n\treturn this.database.database.ref(`/web-rtc/candidates/${this.appContext.user.value.uid}`).orderByChild('descId').equalTo(desc.messId).once('value');\n    }\n  \n    //Обработчик установки или запроса с установкой кандидатов, в зависимости от настроек оптимизации\n    checkCandidates(desc, pcConnection) {\n      let that = this;\n\treturn  new Promise((res, rej)=> {\n\t    if(desc.optimize){\n\t\tsetCandidates.bind(this, desc.candidates, res)() ;\n\t    }else {\n\t\tthis.requestCandidates(desc).then(r => {\n\t\t    let val = r.val();\n\t\t    val && setCandidates.bind(this, Object.values(val),res)()\n\t\t}).catch(this.onError);\n\t    }\n\t});\n\tfunction setCandidates(candidates, res){\n\t    candidates.forEach(candidate => {\n\t\tpcConnection.signal({candidate : candidate.desc});\n\t\t//Удаление кандидата из базы после его получения\n\t\tthat.database.deleteDescriptor({descriptor : candidate}).then(()=>{}).catch(err =>  that.onError(err));\n\n\t    }) ;\n\t    res();\n\t}\n    }\n    \n    //Установка уведомления на страницу Announcement.component\n    setAnnouncement(popup){\n\t//Коллекция элементов на странице уведомлений\n\tthis.appContext.announcements.next([popup].concat(this.appContext.announcements.value)) ;\n\tthis.appContext.appChangeRef.markForCheck();\n    }\n    \n    onError(error){\n\tconsole.log(error);\n    }\n  \n}\n","import * as tslib_1 from \"tslib\";\nimport { AfterViewInit, OnDestroy, OnInit } from '@angular/core';\nimport { NavigationStart } from \"@angular/router\";\nimport { filter } from \"rxjs/operators\";\nimport { Answer, Candidate, Offer, VideoContext, WebRtcConnectionContext } from \"../../../Classes/Classes\";\nimport { BehaviorSubject, Subject } from \"rxjs\";\nexport class WebRtcComponent {\n    constructor(router, webRtcService, appContext, database, statusColor) {\n        this.router = router;\n        this.webRtcService = webRtcService;\n        this.appContext = appContext;\n        this.database = database;\n        this.statusColor = statusColor;\n        this.progress = true;\n        this.subscriptions = [];\n        //Адреса пиров, которым посылаем явные предложения, для того, что бы при завершении вызова снять обработчики событий\n        this.offerChangedUrls = [];\n        //Получение настроек\n        this.duplicateCall = JSON.parse(window.localStorage.getItem('duplicateCall'));\n        this.optimizeCall = JSON.parse(window.localStorage.getItem('optimizeCall'));\n        this.video = JSON.parse(window.localStorage.getItem('videoinput'));\n        this.micro = JSON.parse(window.localStorage.getItem('audioinput'));\n        this.audio = JSON.parse(window.localStorage.getItem('audiooutput'));\n        this.flexDirection = 'column';\n        //Установка ограничений\n        this.constraints = {\n            audio: { deviceId: (this.audio && this.audio.deviceId ? this.audio.deviceId : false), echoCancellation: true, autoGainControl: true, noiseSuppression: true },\n            video: { deviceId: (this.video && this.video.deviceId ? this.video.deviceId : false) }\n        };\n    }\n    ngOnInit() {\n        //Подписка на события запуска нового маршрута для определения повторного запуска\n        //компонента и создания компонента контекста\n        this.router.events.pipe(filter((event) => event instanceof NavigationStart)).subscribe((event) => {\n            //анализирование  event.url\n        });\n        this.startConnections();\n    }\n    ngAfterViewInit() {\n        this.progress = false;\n    }\n    ngOnDestroy() {\n        this.subscriptions.forEach(sub => sub.unsubscribe());\n        this.offerChangedUrls.forEach(url => this.database.getRef(url).off());\n    }\n    //Обработчик ответов и неявных предложений\n    handleDescriptor(webRtcConnectionContext, snap) {\n        let desc = snap.val();\n        desc.type.indexOf('answers') > -1 && this.setDescriptor(webRtcConnectionContext.pcConnection, desc);\n        desc.type.indexOf('offers') > -1 && this.startConnections(desc);\n    }\n    dispatchDescriptor(webRtcConnectionContext) {\n        let that = this, desc = webRtcConnectionContext.descriptor, cans = webRtcConnectionContext.candidates;\n        if (desc.optimize && cans.length) {\n            desc.candidates = this.setCandidates(desc, cans);\n            sendAnswerOffer(desc);\n        }\n        else if (!desc.optimize) {\n            sendAnswerOffer(desc);\n            if (cans.length) {\n                this.setCandidates(desc, cans).forEach(candidate => {\n                    this.database.sendDescriptor(candidate).catch(this.onError);\n                });\n            }\n        }\n        function sendAnswerOffer(desc) {\n            if (/answers|offers\\/implicit/.test(desc.type)) {\n                that.database.sendDescriptor(desc);\n            }\n            else {\n                that.webRtcService.sendOffer(webRtcConnectionContext).then(res => {\n                    //Установка обработчиков изменение статуса приема предложения.\n                    //Если статус приема предложения изменился, значит удаленный пир с ним контактировал различным образом\n                    //(принял/отклонил/пропустил). Это обработчик нам сигнализирует об этом, что поможет в определении нетронутых\n                    //предложений при отказе инициатора от вызова, в момент, когда удаленный пир еще не поднял трубку.\n                    // Обработчик срабатывает при контакте удаленного пира с предложением, что не требует проверки этого явно.\n                    //Результат проверяется сразу при необходимости.\n                    that.setOfferContactListener(webRtcConnectionContext);\n                });\n            }\n            if (desc.type.indexOf('offers') > -1) {\n                //Установка обработчиков получения ответов\n                that.setAnswerListener(webRtcConnectionContext);\n            }\n        }\n    }\n    setCandidates(descriptor, candidates) {\n        let newCandidates = [];\n        candidates.forEach(cand => {\n            newCandidates.push(new Candidate({\n                wid: descriptor.wid,\n                contact: descriptor.contact,\n                date: Date.now(),\n                sender: this.appContext.user.value,\n                descId: descriptor.messId,\n                type: 'candidates',\n                desc: cand,\n                active: true,\n                optimize: descriptor.optimize,\n                uid: descriptor.uid,\n            }));\n        });\n        return newCandidates;\n    }\n    setOfferContactListener(webRtcConnectionContext) {\n        let url = '/web-rtc/offers/explicit/' + webRtcConnectionContext.uid;\n        this.offerChangedUrls.push(url);\n        this.database.getRef(url).orderByChild('messId').equalTo(webRtcConnectionContext.descriptor.messId).on('value', function (webRtcConnectionContext, snap) {\n            let val = snap.val();\n            val && (webRtcConnectionContext.webRtcContext.extra['actions'] = { [webRtcConnectionContext.uid]: { action: Object.values(val)[0].action, url: url + '/' + webRtcConnectionContext.descriptor.messId } });\n        }.bind(this, webRtcConnectionContext));\n    }\n    setAnswerListener(webRtcConnectionContext) {\n        this.database.getRef('/web-rtc/answers/' + this.appContext.appUser.uid).orderByChild(\"descId\").equalTo(webRtcConnectionContext.descriptor.messId).once('child_added', this.handleDescriptor.bind(this, webRtcConnectionContext));\n    }\n    setImplicitListener(id) {\n        this.database.getRef('/web-rtc/offers/implicit/' + this.appContext.appUser.uid).orderByChild(\"descId\").equalTo(id).once('child_added', this.handleDescriptor.bind(this, id));\n    }\n    startConnections(desc) {\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\n            let webRtcContext = this.appContext.webRtcContexts.getContext(this.appContext.contextId);\n            if (!webRtcContext)\n                return;\n            webRtcContext.localStream || (webRtcContext.localStream = yield navigator.mediaDevices.getUserMedia(this.constraints));\n            let sender = desc ? desc.sender : webRtcContext.sender, receivers = webRtcContext.receivers.value, messageContacts = desc ? [sender] : [sender].concat(receivers);\n            if (messageContacts) {\n                //Находим индекс локального пользователя\n                let localIndex = messageContacts.findIndex(contact => contact.uid === this.appContext.user.value.uid);\n                //Запуск всех потоков для каждого контакта\n                messageContacts.forEach((contact, contactIndex) => {\n                    let webRtcConnectionContext, local = this.appContext.appUser.uid === contact.uid, initiator = desc ? false : ((webRtcContext.uid === this.appContext.appUser.uid) || localIndex < contactIndex);\n                    if (localIndex <= contactIndex || (!initiator && contactIndex == 0)) {\n                        webRtcConnectionContext = webRtcContext.webRtcConnections[contact.uid] = new WebRtcConnectionContext({ uid: contact.uid });\n                        webRtcConnectionContext.webRtcContext = webRtcContext;\n                        webRtcConnectionContext.uid = contact.uid;\n                        //Видеоконтекст для каждого контакта\n                        webRtcConnectionContext.videoContext = new VideoContext({\n                            wid: webRtcContext.wid,\n                            contact: new BehaviorSubject(local ? this.appContext.appUser : contact),\n                            channelClass: local ? 'local' : \"remote\",\n                            messageUrl: webRtcContext.desc.messageUrl,\n                            className: local ? {\n                                [contact.uid + ' local video-context']: true,\n                                active: false,\n                                fixed: false,\n                                closed: false,\n                                pulse: initiator\n                            } : { [contact.uid + ' remote video-context']: true, active: false },\n                            stream: new BehaviorSubject(local ? webRtcContext.localStream : undefined),\n                            local: local,\n                            settings: { type: 'settings', video: 1, audio: 1 },\n                            dataChannel: { data: new Subject(), channel: undefined },\n                        });\n                        local && webRtcContext.videoCollection.push(webRtcConnectionContext.videoContext);\n                    }\n                    //Если выполняется не локальный пользователь или индекс локального пользователя меньше индекса текущего\n                    if (localIndex < contactIndex || (!initiator && contactIndex == 0)) {\n                        //Запуск соединения\n                        webRtcConnectionContext.pcConnection = new SimplePeer({\n                            //контакт имеет индекс больше индекса локального пользователя в коллекции контактов или обрабатывается инициатор вызова, тогда ставиться признак инициатора для генерирования предложения\n                            initiator: initiator,\n                            channelName: contact.uid,\n                            //Если соединение формируется для явного предложения, тогда свойство берется из настроек, иначе - из явного предложения\n                            config: this.appContext.stunTurnConfig[initiator ? window.localStorage.getItem('stunTurn') : webRtcContext.desc.stun],\n                            stream: webRtcContext.localStream,\n                        });\n                        webRtcConnectionContext.pcConnection._debug = console.log;\n                        //Установка ссылки на функцию отправки сообщений, чтобы контекст мог их отправлять, если пользователь инициатор сообщения\n                        //Неинициатор устанавливает свой канал связи в событии connect()\n                        initiator && (webRtcConnectionContext.videoContext.dataChannel.channel = webRtcConnectionContext.pcConnection._channel);\n                        //Вызывается при генерации предложений, ответов, кандидатов\n                        webRtcConnectionContext.pcConnection.on('signal', (data) => tslib_1.__awaiter(this, void 0, void 0, function* () {\n                            //Проанализировать настройку оптимизации соединения,\n                            //предложение или ответ ждет формирование кандидатов и отправляются на сервер в одной упаковке\n                            if (data.type) {\n                                if (data.type === 'offer') {\n                                    webRtcConnectionContext.descriptor = new Offer({\n                                        type: (webRtcContext.uid === this.appContext.appUser.uid ? 'offers/explicit' : 'offers/implicit'),\n                                        action: 'offered',\n                                        contact: contact,\n                                        uid: this.appContext.appUser.uid,\n                                        wid: webRtcContext.wid,\n                                        messageUrl: (webRtcContext.uid === this.appContext.appUser.uid ? '/messages/' + contact.uid + '/' + webRtcContext.wid : ''),\n                                        receivers: initiator ? webRtcContext.receivers.value : [contact],\n                                        sender: this.appContext.appUser,\n                                        stun: initiator ? window.localStorage.getItem('stunTurn') : webRtcContext.desc.stun,\n                                        desc: data,\n                                        descId: webRtcContext.wid + this.appContext.appUser.uid,\n                                        optimize: initiator ? JSON.parse(window.localStorage.getItem('optimizeCall')) : webRtcContext.desc.optimize,\n                                        candidates: JSON.parse(window.localStorage.getItem('optimizeCall')) ? [] : false,\n                                    });\n                                }\n                                else if (data.type === 'answer') {\n                                    webRtcConnectionContext.descriptor = new Answer({\n                                        type: 'answers',\n                                        active: true,\n                                        contact: contact,\n                                        uid: webRtcContext.desc.uid,\n                                        descId: desc ? desc.messId : webRtcContext.desc.messId,\n                                        wid: webRtcContext.wid,\n                                        receivers: [desc ? desc.sender : webRtcContext.sender],\n                                        sender: this.appContext.appUser,\n                                        desc: data,\n                                        optimize: webRtcContext.desc.optimize,\n                                        candidates: webRtcContext.desc.optimize ? [] : false,\n                                    });\n                                }\n                                //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n                                this.dispatchDescriptor(webRtcConnectionContext);\n                            }\n                            else if (data.candidate) {\n                                //Сборка кандидатов\n                                let descriptor = webRtcConnectionContext.descriptor;\n                                //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n                                if (descriptor) {\n                                    let candidate = new Candidate({\n                                        wid: descriptor.wid,\n                                        contact: contact,\n                                        date: Date.now(),\n                                        sender: this.appContext.user.value,\n                                        descId: descriptor.messId,\n                                        type: 'candidates',\n                                        desc: data.candidate,\n                                        active: true,\n                                        optimize: descriptor.optimize,\n                                        uid: descriptor.uid,\n                                    });\n                                    //Проверка на опитимизацию соединения\n                                    if (descriptor.optimize)\n                                        descriptor.candidates.push(candidate);\n                                    else\n                                        this.database.sendDescriptor(candidate).catch(this.onError);\n                                }\n                                else {\n                                    webRtcConnectionContext.candidates.push(data.candidate);\n                                }\n                            }\n                        }));\n                        //Установка обработчика на изменения статуса сборки кандидатов\n                        webRtcConnectionContext.pcConnection._pc.addEventListener('icegatheringstatechange', (event) => {\n                            //Завершилась сборка кандидатов\n                            if (event.target.iceGatheringState === 'complete') {\n                                //Сборка завершена\n                                let desc = webRtcConnectionContext.descriptor;\n                                //Сложный вариант отправки дескрипторов обусловлен не постоянной очередностью выдачи предложений-ответов и кандидатов\n                                if (desc && desc.optimize) {\n                                    if (desc.candidates.length) {\n                                        //Отправка дескриптора (offer/answer) на сервер\n                                        /answers|offers\\/implicit/.test(desc.type) && this.database.sendDescriptor(desc).then(() => {\n                                            console.log('Сборка кандидатов завершена. Кандидаты отправлены.');\n                                        }).catch(this.onError);\n                                        //Отправка явного дескриптора\n                                        /offers\\/explicit/.test(desc.type) && this.webRtcService.sendOffer(webRtcConnectionContext);\n                                        //Установка обработчика приема ответа, если отправлен дескриптор предложения\n                                        desc.type.indexOf('offers') > -1 && this.setAnswerListener(webRtcConnectionContext);\n                                    }\n                                    else {\n                                        this.onError('Сбой отправки кандидатов в событии icegatheringstatechange.');\n                                        //TODO определить отображение сбоев несовместимости браузеров пользователю.\n                                        this.setAnnouncement({ type: 'incompatibilityFailure', desc: { text: 'Сбой несовместимости.' } });\n                                    }\n                                }\n                                else if (!desc) {\n                                }\n                            }\n                        });\n                        //Установка обработчика на изменение статуса соединения для установки пользовательской индикации\n                        webRtcConnectionContext.pcConnection._pc.addEventListener('connectionstatechange', (event) => {\n                            let contact = webRtcConnectionContext.videoContext.contact.value;\n                            contact.statusColor = this.statusColor.statusColors.webrtc.perConnectionStates[event.target.connectionState];\n                            webRtcConnectionContext.videoContext.contact.next(contact);\n                        });\n                        //обработчик установки готовности соединения передачи данных по каналу данных\n                        webRtcConnectionContext.pcConnection.on('connect', () => {\n                            initiator || (webRtcConnectionContext.videoContext.dataChannel.channel = webRtcConnectionContext.pcConnection._channel);\n                            //Передать информацию о включенных аппаратных средствах\n                            webRtcConnectionContext.pcConnection.send(JSON.stringify(this.appContext.localVideoAudio));\n                        });\n                        //Обработчик получения данных по канаду данных\n                        webRtcConnectionContext.pcConnection.on('data', (data) => {\n                            //Обработка данных активности , закрытие соединения и пр. удаленного пира\n                            webRtcConnectionContext.videoContext.dataChannel.data.next(JSON.parse(data));\n                        });\n                        //Обработка получения удаленного потока\n                        webRtcConnectionContext.pcConnection.on('stream', stream => {\n                            webRtcConnectionContext.videoContext.stream.next(stream);\n                            //добавление видеоконтекста в коллекцию видеоконтекстов\n                            webRtcContext.videoCollection.push(webRtcConnectionContext.videoContext);\n                            //обновление интерфейса\n                            this.appContext.appChangeRef.markForCheck();\n                        });\n                        //Закрыто текущее соединение\n                        webRtcConnectionContext.pcConnection.on('close', (event) => { });\n                        //Ошибка в соединениии\n                        webRtcConnectionContext.pcConnection.on('error', (err) => {\n                            this.onError(err);\n                            return true;\n                        });\n                        //Установка удаленного дескриптора - явного предложения\n                        if (!initiator && contactIndex === 0) {\n                            let d = desc || webRtcContext.desc;\n                            this.setDescriptor(webRtcConnectionContext.pcConnection, d);\n                        }\n                    }\n                    else if (localIndex > contactIndex) {\n                        this.setImplicitListener(webRtcContext.wid + contact.uid);\n                    }\n                });\n            }\n            this.appContext.appChangeRef.markForCheck();\n        });\n    }\n    setDescriptor(pcConnection, desc) {\n        let that = this;\n        //Установить предложение / ответ\n        pcConnection.signal(desc.desc);\n        if (/answers/.test(desc.type)) {\n            //Удаление принятого ответа из базы после его получения\n            deleteDesc(desc);\n        }\n        else {\n            //Снятие признака активности принятого предложения\n            this.database.setDescriptorOptions({ descriptor: desc, data: { active: false, action: 'accepted' } }).then(res => {\n                //Удаление из базы принятого дескриптора. Такой подход нужен для того, чтобы первая запись меняла статус действия и снимала активность, для согласования внутренних отслеживаний принятий удаленных дескрипторов. Вторая фаза - это удаление уже помеченного дескриптора.\n                deleteDesc(desc);\n            }).catch(err => this.onError(err));\n            //Если принимается явное предложение, создаем сообщение в области входящих сообщений\n            if (desc.type === 'offers/explicit') {\n                //Изменение входящего сообщения\n                [\n                    { path: '/messages/' + this.appContext.appUser.uid + '/' + desc.wid + '/actions', data: { [desc.contact.uid]: 'accepted' } },\n                    //Изменение сообщения инициализатора\n                    { path: '/messages/' + desc.sender.uid + '/' + desc.wid + '/actions', data: { [desc.contact.uid]: 'accepted' } }\n                ].forEach(mess => {\n                    //Пользователь  принял предложение - записываем это в область исходящих сообщений\n                    this.database.changeMessage(mess.path, mess.data);\n                });\n            }\n        }\n        (() => tslib_1.__awaiter(this, void 0, void 0, function* () {\n            //Проверить кандидаты\n            //todo Обязательно! В этом месте, т.е. после установления удаленного дескриптора, и после\n            // установки локального потока, нужно установить СИНХРОННО удаленные кандидаты\n            //Установка/проверка кандидатов\n            yield this.checkCandidates(desc, pcConnection);\n        }))();\n        function deleteDesc(desc) {\n            that.database.deleteDescriptor({ descriptor: desc }).then(() => { }).catch(err => that.onError(err));\n        }\n    }\n    //Запос кандидатов с сервера\n    requestCandidates(desc) {\n        return tslib_1.__awaiter(this, void 0, void 0, function* () {\n            return this.database.database.ref(`/web-rtc/candidates/${this.appContext.user.value.uid}`).orderByChild('descId').equalTo(desc.messId).once('value');\n        });\n    }\n    //Обработчик установки или запроса с установкой кандидатов, в зависимости от настроек оптимизации\n    checkCandidates(desc, pcConnection) {\n        let that = this;\n        return new Promise((res, rej) => {\n            if (desc.optimize) {\n                setCandidates.bind(this, desc.candidates, res)();\n            }\n            else {\n                this.requestCandidates(desc).then(r => {\n                    let val = r.val();\n                    val && setCandidates.bind(this, Object.values(val), res)();\n                }).catch(this.onError);\n            }\n        });\n        function setCandidates(candidates, res) {\n            candidates.forEach(candidate => {\n                pcConnection.signal({ candidate: candidate.desc });\n                //Удаление кандидата из базы после его получения\n                that.database.deleteDescriptor({ descriptor: candidate }).then(() => { }).catch(err => that.onError(err));\n            });\n            res();\n        }\n    }\n    //Установка уведомления на страницу Announcement.component\n    setAnnouncement(popup) {\n        //Коллекция элементов на странице уведомлений\n        this.appContext.announcements.next([popup].concat(this.appContext.announcements.value));\n        this.appContext.appChangeRef.markForCheck();\n    }\n    onError(error) {\n        console.log(error);\n    }\n}\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nimport * as i0 from \"./web-rtc.component.css.shim.ngstyle\";\nimport * as i1 from \"@angular/core\";\nimport * as i2 from \"../../../../../node_modules/@angular/material/progress-spinner/typings/index.ngfactory\";\nimport * as i3 from \"@angular/material/progress-spinner\";\nimport * as i4 from \"@angular/cdk/platform\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/platform-browser/animations\";\nimport * as i7 from \"./web-rtc-context/web-rtc-context.component.ngfactory\";\nimport * as i8 from \"./web-rtc-context/web-rtc-context.component\";\nimport * as i9 from \"./web-rtc.component\";\nimport * as i10 from \"@angular/router\";\nimport * as i11 from \"../../../services/web-rtc.service\";\nimport * as i12 from \"../../../services/app-context.service\";\nimport * as i13 from \"../../../services/database.service\";\nimport * as i14 from \"../../../services/status-colors.service\";\nvar styles_WebRtcComponent = [i0.styles];\nvar RenderType_WebRtcComponent = i1.ɵcrt({ encapsulation: 0, styles: styles_WebRtcComponent, data: {} });\nexport { RenderType_WebRtcComponent as RenderType_WebRtcComponent };\nfunction View_WebRtcComponent_1(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 2, \"div\", [[\"class\", \"startScreen\"]], null, null, null, null, null)), (_l()(), i1.ɵeld(1, 0, null, null, 1, \"mat-progress-spinner\", [[\"class\", \"mat-progress-spinner\"], [\"color\", \"primary\"], [\"mode\", \"indeterminate\"], [\"role\", \"progressbar\"]], [[2, \"_mat-animation-noopable\", null], [4, \"width\", \"px\"], [4, \"height\", \"px\"], [1, \"aria-valuemin\", 0], [1, \"aria-valuemax\", 0], [1, \"aria-valuenow\", 0], [1, \"mode\", 0]], null, null, i2.View_MatProgressSpinner_0, i2.RenderType_MatProgressSpinner)), i1.ɵdid(2, 114688, null, 0, i3.MatProgressSpinner, [i1.ElementRef, i4.Platform, [2, i5.DOCUMENT], [2, i6.ANIMATION_MODULE_TYPE], i3.MAT_PROGRESS_SPINNER_DEFAULT_OPTIONS], { color: [0, \"color\"], mode: [1, \"mode\"] }, null)], function (_ck, _v) { var currVal_7 = \"primary\"; var currVal_8 = \"indeterminate\"; _ck(_v, 2, 0, currVal_7, currVal_8); }, function (_ck, _v) { var currVal_0 = i1.ɵnov(_v, 2)._noopAnimations; var currVal_1 = i1.ɵnov(_v, 2).diameter; var currVal_2 = i1.ɵnov(_v, 2).diameter; var currVal_3 = ((i1.ɵnov(_v, 2).mode === \"determinate\") ? 0 : null); var currVal_4 = ((i1.ɵnov(_v, 2).mode === \"determinate\") ? 100 : null); var currVal_5 = ((i1.ɵnov(_v, 2).mode === \"determinate\") ? i1.ɵnov(_v, 2).value : null); var currVal_6 = i1.ɵnov(_v, 2).mode; _ck(_v, 1, 0, currVal_0, currVal_1, currVal_2, currVal_3, currVal_4, currVal_5, currVal_6); }); }\nfunction View_WebRtcComponent_3(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-web-rtc-context\", [], null, null, null, i7.View_WebRtcContextComponent_0, i7.RenderType_WebRtcContextComponent)), i1.ɵdid(1, 114688, null, 0, i8.WebRtcContextComponent, [i1.PLATFORM_ID], { context: [0, \"context\"] }, null)], function (_ck, _v) { var currVal_0 = _v.context.$implicit; _ck(_v, 1, 0, currVal_0); }, null); }\nfunction View_WebRtcComponent_2(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 6, \"div\", [[\"class\", \"web-rtc-component-container\"]], null, null, null, null, null)), i1.ɵprd(512, null, i5.ɵNgStyleImpl, i5.ɵNgStyleR2Impl, [i1.ElementRef, i1.KeyValueDiffers, i1.Renderer2]), i1.ɵdid(2, 278528, null, 0, i5.NgStyle, [i5.ɵNgStyleImpl], { ngStyle: [0, \"ngStyle\"] }, null), i1.ɵpod(3, { \"flex-direction\": 0 }), (_l()(), i1.ɵand(16777216, null, null, 2, null, View_WebRtcComponent_3)), i1.ɵdid(5, 278528, null, 0, i5.NgForOf, [i1.ViewContainerRef, i1.TemplateRef, i1.IterableDiffers], { ngForOf: [0, \"ngForOf\"] }, null), i1.ɵpid(131072, i5.AsyncPipe, [i1.ChangeDetectorRef])], function (_ck, _v) { var _co = _v.component; var currVal_0 = _ck(_v, 3, 0, _co.flexDirection); _ck(_v, 2, 0, currVal_0); var currVal_1 = i1.ɵunv(_v, 5, 0, i1.ɵnov(_v, 6).transform(_co.appContext.webRtcContexts.contexts)); _ck(_v, 5, 0, currVal_1); }, null); }\nexport function View_WebRtcComponent_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵand(16777216, null, null, 1, null, View_WebRtcComponent_1)), i1.ɵdid(1, 16384, null, 0, i5.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null), (_l()(), i1.ɵand(16777216, null, null, 1, null, View_WebRtcComponent_2)), i1.ɵdid(3, 16384, null, 0, i5.NgIf, [i1.ViewContainerRef, i1.TemplateRef], { ngIf: [0, \"ngIf\"] }, null)], function (_ck, _v) { var _co = _v.component; var currVal_0 = _co.progress; _ck(_v, 1, 0, currVal_0); var currVal_1 = !_co.progress; _ck(_v, 3, 0, currVal_1); }, null); }\nexport function View_WebRtcComponent_Host_0(_l) { return i1.ɵvid(0, [(_l()(), i1.ɵeld(0, 0, null, null, 1, \"app-web-rtc\", [], null, null, null, View_WebRtcComponent_0, RenderType_WebRtcComponent)), i1.ɵdid(1, 4440064, null, 0, i9.WebRtcComponent, [i10.Router, i11.WebRtcService, i12.AppContextService, i13.DatabaseService, i14.StatusColorsService], null, null)], function (_ck, _v) { _ck(_v, 1, 0); }, null); }\nvar WebRtcComponentNgFactory = i1.ɵccf(\"app-web-rtc\", i9.WebRtcComponent, View_WebRtcComponent_Host_0, {}, {}, []);\nexport { WebRtcComponentNgFactory as WebRtcComponentNgFactory };\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nvar styles = [\".web-rtc-component-container[_ngcontent-%COMP%]{height:100%}.startScreen[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;display:flex;justify-content:center;align-items:center}\"];\nexport { styles as styles };\n","<div class=\"startScreen\" *ngIf=\"progress\">\n\t<mat-progress-spinner color=\"primary\" mode=\"indeterminate\"></mat-progress-spinner>\n</div>\n<div class=\"web-rtc-component-container\" *ngIf=\"!this.progress\"  [ngStyle]=\"{'flex-direction': this.flexDirection}\">\n\t<app-web-rtc-context *ngFor=\"let webRtcContext of this.appContext.webRtcContexts.contexts | async\" [context]=\"webRtcContext\"></app-web-rtc-context>\n</div>\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport {WebRtcComponent} from \"./web-rtc.component\";\n\n\nconst routes: Routes = [\n    {path : '', component : WebRtcComponent}\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class WebRtcRoutingModule { }\n","/**\n * @fileoverview This file was generated by the Angular template compiler. Do not edit.\n *\n * @suppress {suspiciousCode,uselessCode,missingProperties,missingOverride,checkTypes}\n * tslint:disable\n */ \nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./web-rtc.module\";\nimport * as i2 from \"../../../../../node_modules/@angular/router/router.ngfactory\";\nimport * as i3 from \"./web-rtc.component.ngfactory\";\nimport * as i4 from \"../../../../../node_modules/@angular/material/tooltip/typings/index.ngfactory\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/cdk/observers\";\nimport * as i7 from \"@angular/cdk/overlay\";\nimport * as i8 from \"@angular/cdk/bidi\";\nimport * as i9 from \"@angular/material/select\";\nimport * as i10 from \"@angular/material/tooltip\";\nimport * as i11 from \"@angular/platform-browser\";\nimport * as i12 from \"@angular/material/core\";\nimport * as i13 from \"@angular/material/menu\";\nimport * as i14 from \"@angular/material/autocomplete\";\nimport * as i15 from \"@angular/forms\";\nimport * as i16 from \"@angular/flex-layout/core\";\nimport * as i17 from \"@angular/router\";\nimport * as i18 from \"./web-rtc-routing.module\";\nimport * as i19 from \"@angular/material/toolbar\";\nimport * as i20 from \"@angular/material/icon\";\nimport * as i21 from \"@angular/material/card\";\nimport * as i22 from \"@angular/material/form-field\";\nimport * as i23 from \"@angular/cdk/portal\";\nimport * as i24 from \"@angular/cdk/platform\";\nimport * as i25 from \"@angular/cdk/scrolling\";\nimport * as i26 from \"@angular/cdk/a11y\";\nimport * as i27 from \"@angular/material/button\";\nimport * as i28 from \"@angular/cdk/text-field\";\nimport * as i29 from \"@angular/material/input\";\nimport * as i30 from \"@angular/material/progress-bar\";\nimport * as i31 from \"@angular/material/progress-spinner\";\nimport * as i32 from \"@angular/material/radio\";\nimport * as i33 from \"@angular/material/tabs\";\nimport * as i34 from \"@angular/material/badge\";\nimport * as i35 from \"@angular/material/button-toggle\";\nimport * as i36 from \"@angular/material/slide-toggle\";\nimport * as i37 from \"@angular/material/slider\";\nimport * as i38 from \"../../material/material.module\";\nimport * as i39 from \"@angular/flex-layout/flex\";\nimport * as i40 from \"@angular/flex-layout/extended\";\nimport * as i41 from \"@angular/flex-layout/grid\";\nimport * as i42 from \"@angular/flex-layout\";\nimport * as i43 from \"../../general/general.module\";\nimport * as i44 from \"./web-rtc.component\";\nvar WebRtcModuleNgFactory = i0.ɵcmf(i1.WebRtcModule, [], function (_l) { return i0.ɵmod([i0.ɵmpd(512, i0.ComponentFactoryResolver, i0.ɵCodegenComponentFactoryResolver, [[8, [i2.ɵangular_packages_router_router_lNgFactory, i3.WebRtcComponentNgFactory, i4.TooltipComponentNgFactory]], [3, i0.ComponentFactoryResolver], i0.NgModuleRef]), i0.ɵmpd(4608, i5.NgLocalization, i5.NgLocaleLocalization, [i0.LOCALE_ID, [2, i5.ɵangular_packages_common_common_a]]), i0.ɵmpd(4608, i6.MutationObserverFactory, i6.MutationObserverFactory, []), i0.ɵmpd(4608, i7.Overlay, i7.Overlay, [i7.ScrollStrategyOptions, i7.OverlayContainer, i0.ComponentFactoryResolver, i7.OverlayPositionBuilder, i7.OverlayKeyboardDispatcher, i0.Injector, i0.NgZone, i5.DOCUMENT, i8.Directionality, [2, i5.Location]]), i0.ɵmpd(5120, i7.ɵc, i7.ɵd, [i7.Overlay]), i0.ɵmpd(5120, i9.MAT_SELECT_SCROLL_STRATEGY, i9.MAT_SELECT_SCROLL_STRATEGY_PROVIDER_FACTORY, [i7.Overlay]), i0.ɵmpd(5120, i10.MAT_TOOLTIP_SCROLL_STRATEGY, i10.MAT_TOOLTIP_SCROLL_STRATEGY_FACTORY, [i7.Overlay]), i0.ɵmpd(4608, i11.HAMMER_GESTURE_CONFIG, i12.GestureConfig, [[2, i12.MAT_HAMMER_OPTIONS], [2, i12.MatCommonModule]]), i0.ɵmpd(4608, i12.ErrorStateMatcher, i12.ErrorStateMatcher, []), i0.ɵmpd(5120, i13.MAT_MENU_SCROLL_STRATEGY, i13.ɵb22, [i7.Overlay]), i0.ɵmpd(5120, i14.MAT_AUTOCOMPLETE_SCROLL_STRATEGY, i14.MAT_AUTOCOMPLETE_SCROLL_STRATEGY_FACTORY, [i7.Overlay]), i0.ɵmpd(4608, i15.FormBuilder, i15.FormBuilder, []), i0.ɵmpd(4608, i15.ɵangular_packages_forms_forms_o, i15.ɵangular_packages_forms_forms_o, []), i0.ɵmpd(5120, i0.APP_BOOTSTRAP_LISTENER, function (p0_0, p0_1) { return [i16.removeStyles(p0_0, p0_1)]; }, [i5.DOCUMENT, i0.PLATFORM_ID]), i0.ɵmpd(1073742336, i5.CommonModule, i5.CommonModule, []), i0.ɵmpd(1073742336, i17.RouterModule, i17.RouterModule, [[2, i17.ɵangular_packages_router_router_a], [2, i17.Router]]), i0.ɵmpd(1073742336, i18.WebRtcRoutingModule, i18.WebRtcRoutingModule, []), i0.ɵmpd(1073742336, i8.BidiModule, i8.BidiModule, []), i0.ɵmpd(1073742336, i12.MatCommonModule, i12.MatCommonModule, [[2, i12.MATERIAL_SANITY_CHECKS], [2, i11.HAMMER_LOADER]]), i0.ɵmpd(1073742336, i19.MatToolbarModule, i19.MatToolbarModule, []), i0.ɵmpd(1073742336, i20.MatIconModule, i20.MatIconModule, []), i0.ɵmpd(1073742336, i21.MatCardModule, i21.MatCardModule, []), i0.ɵmpd(1073742336, i6.ObserversModule, i6.ObserversModule, []), i0.ɵmpd(1073742336, i22.MatFormFieldModule, i22.MatFormFieldModule, []), i0.ɵmpd(1073742336, i23.PortalModule, i23.PortalModule, []), i0.ɵmpd(1073742336, i24.PlatformModule, i24.PlatformModule, []), i0.ɵmpd(1073742336, i25.ScrollingModule, i25.ScrollingModule, []), i0.ɵmpd(1073742336, i7.OverlayModule, i7.OverlayModule, []), i0.ɵmpd(1073742336, i12.MatRippleModule, i12.MatRippleModule, []), i0.ɵmpd(1073742336, i12.MatPseudoCheckboxModule, i12.MatPseudoCheckboxModule, []), i0.ɵmpd(1073742336, i12.MatOptionModule, i12.MatOptionModule, []), i0.ɵmpd(1073742336, i9.MatSelectModule, i9.MatSelectModule, []), i0.ɵmpd(1073742336, i26.A11yModule, i26.A11yModule, []), i0.ɵmpd(1073742336, i10.MatTooltipModule, i10.MatTooltipModule, []), i0.ɵmpd(1073742336, i27.MatButtonModule, i27.MatButtonModule, []), i0.ɵmpd(1073742336, i28.TextFieldModule, i28.TextFieldModule, []), i0.ɵmpd(1073742336, i29.MatInputModule, i29.MatInputModule, []), i0.ɵmpd(1073742336, i30.MatProgressBarModule, i30.MatProgressBarModule, []), i0.ɵmpd(1073742336, i31.MatProgressSpinnerModule, i31.MatProgressSpinnerModule, []), i0.ɵmpd(1073742336, i32.MatRadioModule, i32.MatRadioModule, []), i0.ɵmpd(1073742336, i33.MatTabsModule, i33.MatTabsModule, []), i0.ɵmpd(1073742336, i34.MatBadgeModule, i34.MatBadgeModule, []), i0.ɵmpd(1073742336, i13._MatMenuDirectivesModule, i13._MatMenuDirectivesModule, []), i0.ɵmpd(1073742336, i13.MatMenuModule, i13.MatMenuModule, []), i0.ɵmpd(1073742336, i14.MatAutocompleteModule, i14.MatAutocompleteModule, []), i0.ɵmpd(1073742336, i35.MatButtonToggleModule, i35.MatButtonToggleModule, []), i0.ɵmpd(1073742336, i36._MatSlideToggleRequiredValidatorModule, i36._MatSlideToggleRequiredValidatorModule, []), i0.ɵmpd(1073742336, i36.MatSlideToggleModule, i36.MatSlideToggleModule, []), i0.ɵmpd(1073742336, i37.MatSliderModule, i37.MatSliderModule, []), i0.ɵmpd(1073742336, i38.MaterialModule, i38.MaterialModule, []), i0.ɵmpd(1073742336, i15.ɵangular_packages_forms_forms_d, i15.ɵangular_packages_forms_forms_d, []), i0.ɵmpd(1073742336, i15.ReactiveFormsModule, i15.ReactiveFormsModule, []), i0.ɵmpd(1073742336, i16.CoreModule, i16.CoreModule, []), i0.ɵmpd(1073742336, i39.FlexModule, i39.FlexModule, []), i0.ɵmpd(1073742336, i40.ExtendedModule, i40.ExtendedModule, []), i0.ɵmpd(1073742336, i41.GridModule, i41.GridModule, []), i0.ɵmpd(1073742336, i42.FlexLayoutModule, i42.FlexLayoutModule, [[2, i16.SERVER_TOKEN], i0.PLATFORM_ID]), i0.ɵmpd(1073742336, i43.GeneralModule, i43.GeneralModule, []), i0.ɵmpd(1073742336, i1.WebRtcModule, i1.WebRtcModule, []), i0.ɵmpd(1024, i17.ROUTES, function () { return [[{ path: \"\", component: i44.WebRtcComponent }]]; }, [])]); });\nexport { WebRtcModuleNgFactory as WebRtcModuleNgFactory };\n"]}